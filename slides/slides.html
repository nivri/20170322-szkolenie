<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="author" content="Jakub Marchwicki"><title>Spring Framework</title><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport"><link href="reveal.js/css/reveal.css" rel="stylesheet"><link rel="stylesheet" href="css/custom_serif.css" id="theme"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css"><style>/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}</style><link href="reveal.js/lib/css/zenburn.css" rel="stylesheet"><script>document.write( '<link rel="stylesheet" href="reveal.js/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );</script></head><body><div class="reveal"><div class="slides"><section class="title"><h1>Spring Framework</h1><p class="author"><small>Jakub Marchwicki</small></p></section><section id="slide_zakres"><h2>Zakres</h2><div class="ulist"><ul><li><p>Spring</p><div class="ulist"><ul><li><p>Kontener (XML, adnotacje)</p></li><li><p>Zależności, fabryki, prototypy</p></li><li><p>Aspekty, Walidacja</p></li><li><p>Test integracyjne aplikacji z wykorzystaniem Frameworka</p></li></ul></div></li><li><p>Baza danych na różne sposoby (JDBC, ORM, JPA)</p></li><li><p>Spring Web</p><div class="ulist"><ul><li><p>Spring Web vs Spring WebMVC</p></li><li><p>Bezpieczeństwo aplikacji webowych i sposoby uwierzytelniania</p></li><li><p>Usługi REST</p></li></ul></div></li></ul></div></section>
<section><section id="slide_modu_1_spring_framework" data-background-image="images/background.jpg" data-background-size="cover"><h2>Moduł 1: Spring Framework</h2></section><section id="slide_spring_framework"><h2>Spring Framework</h2><div class="ulist"><ul><li><p>Koncepcja <em>POJO programming</em></p></li><li><p>Misja Spring</p></li><li><p>Elementy frameworka</p></li><li><p>Ekosystem narzędzi SpringSource</p></li><li><p>Spring Framework a EJB</p></li></ul></div></section><section id="slide_plain_old_java_objects"><h2>Plain Old Java Objects</h2><div class="ulist"><ul><li><p>Obiekty nie związane z jakimkolwiek API</p></li><li><p>Nie implementują specyficznych interfejsów platformy (jak np EJB 2.x)</p></li><li><p>Nie są związane ze środowiskiem, serwerem, frameworkiem</p></li><li><p>Tylko przechowują dane i realizują usługi (funkcjonalności) biznesowe</p></li></ul></div></section><section id="slide_pojo_programming"><h2>POJO Programming</h2><div class="ulist"><ul><li><p>Zapewnia przenaszalność kodu</p><div class="ulist"><ul><li><p>poprzez oderwanie od środowiska działania</p></li><li><p>kod może być współdzielony pomiędzy środowiskami</p></li></ul></div></li><li><p>Wspiera testowalność</p><div class="ulist"><ul><li><p>do uruchomienia nie jest wymagany kontener</p></li></ul></div></li></ul></div></section><section id="slide_misja_spring_framework"><h2>Misja Spring Framework</h2><div class="ulist"><ul><li><p>Spring nie konkuruje z istniejącymi rozwiązaniami, które dobrze się sprawdzają. Zamiast tego wspiera ich integrację.</p></li><li><p>Spring nie wymusza API. Nie ma konieczności instalowania dodatkowych serwerów aplikacji.</p></li><li><p>Spring ma być przyjemny w użyciu, podnosić efektywność programistów. Spring Framework ma po prostu działać.</p></li><li><p>Spring wspiera tworzenie wysokiej jakości, testowalnego oprogramowania.</p></li><li><p>Dobry obiektowy projekt aplikacji jest ważniejszy niż technologie</p></li></ul></div></section><section id="slide_elementy_frameworka"><h2>Elementy frameworka</h2><div class="ulist"><ul><li><p>Kontener wstrzykiwania zależności</p></li><li><p>Kontekst aplikacyjny – dostęp do zasobów zewnętrznych</p></li><li><p>Aspekty</p></li><li><p>Zarządzanie transakcjami,</p></li><li><p>Abstrakcja warstwy dostępu do danych</p></li></ul></div></section><section id="slide_elementy_frameworka_2"><h2>Elementy frameworka</h2><div class="imageblock" style=""><img src="images/1000000000000243000001BF2ABD2237.png" alt="Elementy frameworka Spring" width="800"></div></section><section id="slide_projekty_wspierajce"><h2>Projekty wspierające</h2><div class="dlist"><dl><dt class="hdlist1">Spring MVC</dt><dd><p>kontener WWW oraz integracja z istniejącymi frameworkami</p></dd><dt class="hdlist1">Spring Web Flow</dt><dd><p>rozwinięcie prostego MVC w kierunku zaawansowanych aplikacji webowych (m.in. controlled navigation)</p></dd><dt class="hdlist1">Spring Web Service</dt><dd><p>Zdalne wywołania m.in. przez SOAP, usługi contract-first</p></dd><dt class="hdlist1">Spring Security</dt><dd><p>autoryzacja i uwierzytelnianie w aplikacjach webowych</p></dd><dt class="hdlist1">Spring Integration</dt><dd><p>Narzędzia do tworzenia systemów w oparciu o Enterprise Integration Patterns</p></dd></dl></div></section><section id="slide_spring_framework_a_ejb"><h2>Spring Framework a EJB</h2><div class="ulist"><div class="title">Spring Framework</div><ul><li><p>Dowolne łączenie bibliotek i narzędzi, włączanie modułów gdy zachodzi taka potrzeba.</p></li><li><p>Intensywny rozwój, nowe funkcjonalności pojawiają się z dużą regularnością</p></li></ul></div>
<div class="ulist"><div class="title">EJB</div><ul><li><p>Monolityczna całość, funkcjonalności uruchamiane nawet gdy nie są wykorzystywane.</p></li><li><p>Specyfikacja rodzi się w bólach, przez lata. Wydania raz na kilka lat.</p></li></ul></div></section><section id="slide_spring_framework_a_ejb_2"><h2>Spring Framework a EJB</h2><div class="ulist"><div class="title">Spring Framework</div><ul><li><p>Spring jest całością samą w sobie. Kontener Spring jest pomostem pomiędzy aplikacją a serwerem (środowiskiem) – uniezależniając system od konkretnego dostawcy.</p></li></ul></div>
<div class="ulist"><div class="title">EJB</div><ul><li><p>Przenaszalność aplikacji jest fikcją. Specyfikacja nie dookreśla wielu aspektów, zmuszając programistę do wyboru konkretnej platformy (ang. vendor lock-in)</p></li></ul></div></section></section>
<section><section id="slide_modu_2_kontener_spring" data-background-image="images/background.jpg" data-background-size="cover"><h2>Moduł 2: Kontener Spring</h2></section><section id="slide_kontener_spring"><h2>Kontener Spring</h2><div class="ulist"><ul><li><p>Kontener, fabryka komponentów</p></li><li><p>Tworzenie komponentów</p></li><li><p>Standard JSR-330</p></li><li><p>Konfiguracja kontekstu: adnotacje, XML, JavaConfiguration</p></li><li><p>Zakresy komponentów</p></li><li><p>Cykl życia komponentu</p></li><li><p>Zdarzenia</p></li></ul></div></section><section id="slide_smaki_odwracania_zalenoci"><h2>Smaki odwracania zależności</h2><div class="ulist"><ul><li><p>Mechanizm <em>Inversion of Control</em> (odwrócenie sterowania) to mechanizm
przeniesienia na zewnątrz komponentu odpowiedzialności za kontrolę wybranych
czynności</p></li><li><p>Rozróżniamy kilka realizacji odwrócenia sterowania</p><div class="ulist"><ul><li><p>Dependency Injection</p></li><li><p>Zdarzenia</p></li><li><p>Aspekty</p></li></ul></div></li></ul></div></section><section id="slide_wstrzykiwanie_zalenoci"><h2>Wstrzykiwanie zależności</h2><div class="ulist"><ul><li><p>Wstrzykiwanie zależności to tylko jeden z przykładów realizacji IoC</p></li><li><p><em>Dependency Injection</em> zwalania obiekt z tworzenia konkretnych instancji
obiektów w nim agregowanych</p></li><li><p>Odwracane jest sterowanie w zakresie tworzenia powiązań pomiędzy obiektami</p></li><li><p>Obiekty nie decydują o konkretnych typach obiektów zawieranych</p><div class="ulist"><ul><li><p>Minimalizuje to zależności pomiędzy klasami (ang. coupling)</p></li></ul></div></li></ul></div></section><section id="slide_zdarzenia"><h2>Zdarzenia</h2><div class="ulist"><ul><li><p>Wykorzystując zdarzenie obiekty nie wiedzą zarówno o typie obiektów współpracujących, jak i o:</p><div class="ulist"><ul><li><p>ilości obiektów współpracujących</p></li><li><p>ich typów</p></li><li><p>wyników ich pracy</p></li><li><p>kolejności wykonania</p></li><li><p>czasu, w którym wykonają pracę</p></li></ul></div></li><li><p>Zdarzenie modeluje fakt, który miał miejsce i nie ma możliwości zawetowania go</p><div class="ulist"><ul><li><p>Możliwia jest jedynie reakcja na zdarzenie (w innym miejscu systemu)</p></li></ul></div></li></ul></div></section><section id="slide_aspekty"><h2>Aspekty</h2><div class="ulist"><ul><li><p><em>Aspect Oriented Programming</em> (AOP) używamy w celu dodania dodatkowych Aspektów
do Aspektu głównego.</p><div class="ulist"><ul><li><p>W aplikacjach biznesowych aspektem głównym jest zwykle logika biznesowa</p></li><li><p>aspekty dodatkowe, to zagadnienia ortogonalne (nie przecinające się z logiką biznesową) takie jak transakcyjność,
bezpieczeństwo, audit logi</p></li></ul></div></li><li><p>Zagadnienia te są w dużym stopniu rozłączne pomiędzy sobą pod względem funkcjonalnym</p><div class="ulist"><ul><li><p>Wzajemne przenikanie się wymagań klienta opisanych przez aspeky czyni kod mniej czytelnym,
bardziej podatnym na błędy, trudniejszym w modyfikacji</p></li></ul></div></li></ul></div></section><section id="slide_wewntrzne_zalenoci"><h2>Wewnętrzne zależności</h2><div class="ulist"><ul><li><p>Kod trudny w testowaniu, rozbudowie, utrzymaniu</p></li><li><p>Kod staje się niemożliwy do przeniesienia</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ShopServlet</span> <span class="directive">extends</span> HttpServlet {
  <span class="directive">private</span> ShopDao shopDao;

  <span class="directive">public</span> ShopServlet() {
    shopDao = <span class="keyword">new</span> ShopDao();  <i class="conum" data-value="1"></i><b>(1)</b>
    PasswordVerifier.getInstance().verify(); <i class="conum" data-value="2"></i><b>(2)</b>
  }
}</code></pre></div></div></section><section id="slide_wewntrzne_zalenoci_2"><h2>Wewnętrzne zależności</h2><div class="ulist"><ul><li><p>Używanie obiektów typu POJO</p><div class="ulist"><ul><li><p>Obiekty nie związane z jakimkolwiek API</p></li><li><p>Zapewnia testowalność i przenaszalność kodu</p></li></ul></div></li><li><p>Programowanie poprzez interfejsy</p><div class="ulist"><ul><li><p>Powiązania między interfejsami czynią kod bardziej elastycznym</p></li><li><p>Nadużywanie interfejsów może być bardziej kłopotliwe niż ich brak</p></li></ul></div></li><li><p>Wstrzykiwanie zależności</p></li><li><p>Podejście aspektowe</p></li></ul></div></section><section id="slide_kontener_spring_2"><h2>Kontener Spring</h2><div class="ulist"><ul><li><p>Fabryka komponentów: dostarcza obiektów gotowych do użycia.</p></li><li><p>Rozwiązuje zależności pomiędzy komponentami; w sposób automatyczny bądź na podstawie konfiguracji</p></li><li><p>Zarządza cyklem życia obiektów</p></li><li><p>Umożliwia komunikację pomiędzy komponentami z wykorzystaniem zdarzeń</p><div class="ulist"><ul><li><p>Kontener Spring oferuje jedynie synchroniczną komunikację opratą na zdarzeniach</p></li></ul></div></li></ul></div></section><section id="slide_komponent_spring"><h2>Komponent Spring</h2><div class="ulist"><ul><li><p>Aby Spring rozpoczął zarządzanie obiektem należy umieścić go w kontenerze</p></li><li><p>Umieszczenie polega na dodaniu wpisu do deskryptora XML lub dodaniu adnotacji do klasy obiektu</p></li><li><p>Obiekt umieszczony w kontenerze staje się komponentem zarządzanym (managed bean)</p></li></ul></div></section><section id="slide_kontener"><h2>Kontener</h2><div class="ulist"><ul><li><p><code>BeanFactory</code></p><div class="ulist"><ul><li><p>Tworzy komponenty i zarządza cyklem ich życia</p></li></ul></div></li><li><p><code>ApplicationContext</code></p><div class="ulist"><ul><li><p>Dostarcza mechanizm obsługi zdarzeń</p></li><li><p>Wspiera internacjonalizację aplikacji</p></li><li><p>Wstępnie inicjalizuje komponenty</p></li><li><p>Rejestruje i uruchamia obiekty rozszerząjace cykl życia kontenera</p></li></ul></div></li></ul></div></section><section id="slide__em_beanfactory_em"><h2><em>BeanFactory</em></h2><div class="ulist"><ul><li><p><code>XmlBeanFactory</code></p><div class="ulist"><ul><li><p>Odczytuje konfigurację z pliku XML</p></li></ul></div></li><li><p><code>SimpleJndiBeanFactory</code></p><div class="ulist"><ul><li><p>Poszukuje komponentów zarejestrowanych w drzewie JNDI (na serwerze aplikacji) w przestrzeni <code>java:comp/env</code></p></li></ul></div></li></ul></div></section><section id="slide__em_applicationcontext_em"><h2><em>ApplicationContext</em></h2><div class="ulist"><ul><li><p><code>ClasspathXmlApplicationContext</code></p><div class="ulist"><ul><li><p>Pobiera konfigurację XML z plików znajdujących się w ścieżce classpath. Wykorzystane w aplikacjach standalone</p></li></ul></div></li><li><p><code>FileSystemXmlApplicationContext</code></p><div class="ulist"><ul><li><p>Pobiera konfigurację XML z plików znajdujących się w systemie plików. Wykorzystane w aplikacjach standalone</p></li></ul></div></li></ul></div></section><section id="slide__em_applicationcontext_em_2"><h2><em>ApplicationContext</em> (2)</h2><div class="ulist"><ul><li><p><code>AnnotationConfigApplicationContext</code></p><div class="ulist"><ul><li><p>Wykorzystuje konfigurację opartą o adnotację i JavaConfig. Wykorzystane w aplikacjach standalone</p></li></ul></div></li><li><p><code>*WebApplicationContext</code></p><div class="ulist"><ul><li><p>Kontekst wykorzystywany w aplikacjach webowych; konfiguracja odczytywana z katalogu WEB-INF</p></li></ul></div></li><li><p><code>Static*ApplicationContext</code></p><div class="ulist"><ul><li><p>Konfiguracja wykorzystywana w testach</p></li></ul></div></li></ul></div></section><section id="slide_uruchomienie_aplikacji"><h2>Uruchomienie aplikacji</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">App</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span>... args) {
        ApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(Cfg.class);
        Controller c = ctx.getBean(Controller.class);    <i class="conum" data-value="1"></i><b>(1)</b>
        c.run();
    }
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Komponent zdefiniowany przez nas</td></tr></table></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">App</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span>... args) {
        ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(
                <span class="string"><span class="delimiter">&quot;</span><span class="content">META-INF/spring/app-context.xml</span><span class="delimiter">&quot;</span></span>);
        Controller c = ctx.getBean(Controller.class);
        c.run();
    }
}</code></pre></div></div></section><section id="slide_tworzenie_komponentw"><h2>Tworzenie komponentów</h2><div class="listingblock"><div class="content"><pre class="CodeRay nowrap"><code class="xml language-xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="attribute-value">http:</span><span class="error">/</span><span class="error">/</span><span class="attribute-name">www.springframework.org</span><span class="error">/</span><span class="attribute-name">schema</span><span class="error">/</span><span class="attribute-name">beans</span>
  <span class="attribute-name">xmlns:xsi</span>=<span class="attribute-value">http:</span><span class="error">/</span><span class="error">/</span><span class="attribute-name">www.w3.org</span><span class="error">/</span><span class="attribute-name">2001</span><span class="error">/</span><span class="attribute-name">XMLSchema-instance</span>
  <span class="attribute-name">xmlns:context</span>=<span class="attribute-value">http:</span><span class="error">/</span><span class="error">/</span><span class="attribute-name">www.springframework.org</span><span class="error">/</span><span class="attribute-name">schema</span><span class="error">/</span><span class="attribute-name">context</span>
  <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
    <span class="content">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
 
  <span class="tag">&lt;context:annotation-config</span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;context:component-scan</span>
    <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.*</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre></div></div></section><section id="slide_tworzenie_komponentw_2"><h2>Tworzenie komponentów</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@ComponentScan</span>(basePackages = {<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.dictionary</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.helloworld</span><span class="delimiter">&quot;</span></span>},
        excludeFilters = <span class="annotation">@ComponentScan</span>.Filter(type = FilterType.REGEX, pattern = <span class="string"><span class="delimiter">&quot;</span><span class="content">.*Service</span><span class="delimiter">&quot;</span></span>))
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfiguration</span> {

}</code></pre></div></div></section><section id="slide_tworzenie_komponentw_3"><h2>Tworzenie komponentów</h2><div class="paragraph lead"><p>Włącza obsługę adnotacji konfiguracyjnych – takich, które nie definiują komponentu</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml">  <span class="tag">&lt;context:annotation-config</span> <span class="tag">/&gt;</span></code></pre></div></div>
<div class="ulist"><ul><li><p>Brak odpowiednika w konfiguracji Java - domyślne zachowanie</p></li></ul></div></section><section id="slide_tworzenie_komponentw_4"><h2>Tworzenie komponentów</h2><div class="paragraph lead"><p>Pozwala wykrywać adnotacje definiujące komponenty: <code>@Component</code>, <code>@Service</code>, <code>@Repository</code>, <code>@Controller</code></p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.spring.*</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@ComponentScan</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.dictionary</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.helloworld</span><span class="delimiter">&quot;</span></span>})</code></pre></div></div></section><section id="slide_tworzenie_komponentw_5"><h2>Tworzenie komponentów</h2><div class="paragraph"><p>Atrybuty <code>include-filter</code> oraz <code>exclude-filter</code> mogą regulować czy konkretne klasy zostaną dołączone do projektu.</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;context:component-scan</span>
  <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.spring.*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;context:exclude-filter</span>
      <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">regex</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">.*Service</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/context:component-scan&gt;</span></code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@ComponentScan</span>(basePackages = {<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.dictionary</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.helloworld</span><span class="delimiter">&quot;</span></span>},
    excludeFilters = <span class="annotation">@ComponentScan</span>.Filter(type = REGEX, pattern = <span class="string"><span class="delimiter">&quot;</span><span class="content">.*Service</span><span class="delimiter">&quot;</span></span>))</code></pre></div></div></section><section id="slide_tworzenie_komponentw_6"><h2>Tworzenie komponentów</h2><div class="ulist"><ul><li><p>Adnotacja <code>@Component</code> jest wystarczająca aby dodać nowy komponent do kontekstu</p></li><li><p>Adnotacje <code>@Service</code>, <code>@Resource</code> bądź <code>@Controller</code> dodatkowo opisują cel istnienia komponentu i umożliwiają budowę elastycznej konfiguracji</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleService</span> {
    <span class="directive">public</span> <span class="predefined-type">String</span> getMessage() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello world!</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre></div></div></section><section id="slide_nazewnictwo"><h2>Nazewnictwo</h2><div class="ulist"><ul><li><p>Komponenty w Spring Framework rozróżniane są po nazwie</p></li><li><p>Domyślna nazwa generowana jest automatycznie zgodnie z konwencją <em>JavaBeans</em></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">shopService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo.ShopService</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Component</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">myService</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ShopService</span> {
    <span class="comment">//..</span>
}</code></pre></div></div></section><section id="slide_czenie_komponentw"><h2>Łączenie komponentów</h2><div class="ulist"><ul><li><p>Adnotacją <code>@Autowired</code> można łączyć komponenty ze sobą.</p></li><li><p>Oznaczamy pole klasy, modyfikator (<em>setter</em>) lub konstruktor</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleService</span> {

    <span class="annotation">@Autowired</span> AnotherService service;

    <span class="directive">public</span> <span class="predefined-type">String</span> getMessage() {
        <span class="keyword">return</span> service.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello world!</span><span class="delimiter">&quot;</span></span>);
    }<span class="error"> </span>
}</code></pre></div></div></section><section id="slide_jsr_330"><h2>JSR 330</h2><div class="ulist"><ul><li><p>Adnotacje <code>@Named</code> i <code>@Inject</code> ustandaryzowały wstrzykiwanie zależności</p></li><li><p>Gwarantują przenaszalność kodu pomiędzy frameworkami Dependency Injection <em>(Guice, CDI)</em>.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Named</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleService</span> {

    <span class="annotation">@Inject</span>
    AnotherService service;

    <span class="comment">//.. </span>
}</code></pre></div></div></section><section id="slide_zakres_dziaania_komponentu"><h2>Zakres działania komponentu</h2><div class="ulist"><ul><li><p>W odróżnieniu od EJB – komponenty nie podlegają zarządzaniu w oparciu o pulę</p></li><li><p>Podstawowe zakresy to: <strong>singleton</strong> i <strong>prototype</strong></p><div class="ulist"><ul><li><p>Każde pobranie komponentu typu <strong>singleton</strong> zwróci referencję do tej samej instancji</p></li><li><p>Przy każdym pobraniu komponentu <strong>prototype</strong> zostanie zwrócony nowy obiekt</p></li></ul></div></li><li><p>Dodatkowe zakresy to <em>thread</em>, <em>request</em>, <em>session</em> i <em>globalSession</em>.</p></li></ul></div></section><section id="slide_cykl_ycia_komponentw"><h2>Cykl życia komponentów</h2><div class="paragraph lead"><p>Najpopularniejszą metodą połączenia komponentu ze zdarzeniami kontenera jest użycie adnotacji <code>@PostConstruct</code> i <code>@PreDestroy</code></p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleService</span> {

    <span class="annotation">@PostConstruct</span> <span class="directive">public</span> <span class="type">void</span> startup() {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Preparing the message...</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@PreDestroy</span> <span class="directive">public</span> <span class="type">void</span> shutdown() {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">...finishing.</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre></div></div></section><section id="slide_cykl_ycia_komponentw_2"><h2>Cykl życia komponentów</h2><div class="paragraph lead"><p>Implementując interfejsy <code>InitializingBean</code> oraz <code>DisposableBean</code>, wymuszana jest implementacja metod <em>afterPropertiesSet()</em> oraz <em>destroy()</em>.</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Named</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleService</span> <span class="directive">implements</span>
    InitializingBean, DisposableBean {

    <span class="directive">public</span> <span class="type">void</span> afterPropertiesSet() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Preparing the message...</span><span class="delimiter">&quot;</span></span>);
    }
    <span class="directive">public</span> <span class="type">void</span> destroy() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">...finishing.</span><span class="delimiter">&quot;</span></span>);
    }<span class="error"> </span>
}</code></pre></div></div></section><section id="slide_cykl_ycia_komponentw_3"><h2>Cykl życia komponentów</h2><div class="paragraph lead"><p>Bez konieczności implementowania specyficznych interfejsów można wymusić wywołanie poprzednich metod z poziomu konfiguracji XML</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.spring.example001.ExampleService</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">init-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">afterPropertiesSet</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">destroy-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">destroy</span><span class="delimiter">&quot;</span></span>
<span class="tag">/&gt;</span></code></pre></div></div></section></section>
<section><section id="slide_modu_3_wstrzykiwanie_zalenoci" data-background-image="images/background.jpg" data-background-size="cover"><h2>Moduł 3: Wstrzykiwanie zależności</h2></section><section id="slide_wstrzykiwanie_zalenoci_2"><h2>Wstrzykiwanie zależności</h2><div class="ulist"><ul><li><p>Łączenie komponentów</p></li><li><p>Kwalifikatory</p></li><li><p>Wstrzykiwanie zasobów</p></li><li><p>Wstrzykiwanie wielu instancji komponentu</p></li><li><p>Stan początkowy komponentu</p></li></ul></div></section><section id="slide_adnotacja_autowire"><h2>Adnotacja @Autowire</h2><div class="ulist"><ul><li><p>Spring posiada mechanizmy automatycznego odnajdywania zależności</p></li><li><p>Zmniejsza potrzebę jawnego definiowania konfiguracji</p></li><li><p>Adnotacją można oznaczyć pole, modyfikator lub konstruktor</p></li><li><p>Framework samodzielnie dopasuje i wybierze komponenty do wstrzyknięcia</p></li></ul></div></section><section id="slide_adnotacja_autowire_2"><h2>Adnotacja @Autowire</h2><div class="ulist"><ul><li><p>Zadziała poprawnie jeżeli framework dopasuje jeden (i tylko jeden) element do wstrzyknięcia</p></li><li><p>Poprzez atrybut <em>required="false"</em> można ustawić zależność jako opcjonalną</p></li><li><p>Wstrzykiwanie domyślnie odbywa się po typie komponentu, ale jest to konfigurowalne</p></li><li><p>Jeżeli w kontekście istnieje więcej niż jeden element możliwy do wstrzyknięcia, konieczne jest bardziej zaawansowane rozwiązywanie zależności</p></li></ul></div></section><section id="slide_typy_wstrzykiwania"><h2>Typy wstrzykiwania</h2><div class="listingblock"><div class="content"><pre class="CodeRay nowrap"><code class="xml language-xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">default-autowire</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">byName</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tag">/&gt;</span></code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Determinuje sposób rozwiązywania zależności</td></tr></table></div></section><section id="slide_typy_wstrzykiwania_2"><h2>Typy wstrzykiwania (2)</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:20%"><col style="width:80%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>no</strong></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Brak mechanizmu autowiring.<br>
Zależności muszą być specyfikowane jawnie</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>byName</strong></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Spring wyszukuje zależności na bazie porównywania nazw komponentów i nazw właściwości. np. <em>setGeneraror()</em> → <em>&lt;bean id="generator" /&gt;</em></p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>byType</strong></p></div></div></td><td class="tableblock halign-left valign-top"><p class="tableblock">Wyszukiwanie zależności następuje po typie, pod warunkiem, że istnieje zdefiniowany tylko jeden komponent danego typu. W przeciwnym razie zostanie zgłoszony wyjątek.</p></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>constructor</strong></p></div></div></td><td class="tableblock halign-left valign-top"><p class="tableblock">Podobnie jak byType, przy czym ogranicza się tylko i wyłącznie do konstruktorów</p></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>autodetect</strong></p></div></div></td><td class="tableblock halign-left valign-top"><p class="tableblock">Jeśli dla danej klasy istnieje konstruktor, używana jest strategia constructor, jeśli nie istnieje byType</p></td></tr></tbody></table></section><section id="slide_konfiguracja_xml"><h2>Konfiguracja XML</h2><div class="ulist"><ul><li><p>Komponenty definiujemy za pomocą tagu <code>&lt;bean /&gt;</code>. Nazwa komponentu (id) musi być unikalna.</p></li><li><p>Zależności rozwiązywane są poprzez konstruktor bądź modyfikatory (settery)</p></li></ul></div></section><section id="slide_konfiguracja_xml_2"><h2>Konfiguracja XML (2)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">taskService</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.spring.todo.TasksService</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validator</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sqlMapClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sqlMapClient</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messages</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageSource</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">taskService</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.spring.todo.TasksService</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validator</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageSource</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sqlMapClient</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre></div></div></section><section id="slide_wicej_ni_jedna_instancja"><h2>Więcej niż jedna instancja</h2><div class="ulist"><ul><li><p>Spring umożliwia automatyczne utworzenie list (tablicy) komponentów</p></li><li><p>Wstrzyknięte zostaną wszystkie komponentu pasujące do danego typu</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Autowired</span>
<span class="predefined-type">List</span>&lt;TaskPrinter&gt; printers;

<span class="directive">public</span> <span class="type">void</span> print() {
  <span class="keyword">for</span> (TaskPrinter p : printers) {
    p.printCurrentTasks();
  }
}</code></pre></div></div></section><section id="slide_wicej_ni_jedna_instancja_2"><h2>Więcej niż jedna instancja</h2><div class="ulist"><ul><li><p>Adnotacja @Autowired działa dla:</p><div class="ulist"><ul><li><p>artybutów klasy (pól)</p></li><li><p>setterów</p></li><li><p>metod</p></li><li><p>konstruktorów – tylko jeden z konstruktorów może być oznaczony jako required</p></li><li><p>kolekcji – umieszczane są wszystkie komponenty o danym typie</p></li><li><p>map – kluczem jest nazwa komponentu a wartością referencja do niego</p></li><li><p>Interfejsów kontenera – np. <code>ApplicationContext</code></p></li></ul></div></li></ul></div></section><section id="slide_adnotacja_required"><h2>Adnotacja @Required</h2><div class="ulist"><ul><li><p>Oznacza daną zależność jako wymaganą (dotyczy setterów)</p></li><li><p>Sprawdzenie następuje w momencie uruchomienia kontenera</p></li><li><p>Użycie adnotacji <code>@Required</code> jest torżsame z wykorzystaniem atrybuty required dla adnotacji <code>@Autowired</code></p></li></ul></div></section><section id="slide_adnotacja_resource"><h2>Adnotacja @Resource</h2><div class="ulist"><ul><li><p>Wstrzykiwanie zasobów (fabryki BeanFactory, ApplicationContext itp.)</p></li><li><p>Może zostać wykorzystana do wstrzykiwania komponentów</p></li><li><p>Wstrzykiwanie przy użyciu @Resource odbywa się po nazwie (<code>default-autowire="byName"</code>)</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Resource</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">prettyStringTaskPrinter</span><span class="delimiter">&quot;</span></span>)
TaskPrinter p;

<span class="directive">public</span> <span class="type">void</span> print() {
  p.printCurrentTasks();
}</code></pre></div></div></section><section id="slide_zewntrzne_pliki_properties"><h2>Zewnętrzne pliki properties</h2><div class="ulist"><ul><li><p>Spring umożliwia wczytywanie danych z zewnętrznych plików properties</p></li><li><p>Dane ładowane są w trakcie inicjalizacji aplikacji</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;context:property-placeholder</span>
  <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:META-INF/spring/dict.properties</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@PropertySource</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:META-INF/spring/dict.properties</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">JavaConfiguration</span> {

}</code></pre></div></div></section><section id="slide_stan_pocztkowy_komponentu"><h2>Stan początkowy komponentu</h2><div class="ulist"><ul><li><p>Do inicjacji komponentu używamy adnotacji <code>@Value</code></p></li><li><p>Wartość atrybutu można dowolnie zmieniać z poziomu konfiguracji</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Service</span> {
<span class="error"> </span>
  <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${urlStringTemplate}</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="predefined-type">String</span> urlStringTemplate;
<span class="error"> </span>
  <span class="comment">//..</span>

}</code></pre></div></div></section><section id="slide_wicej_ni_properties_spel"><h2>Więcej niż properties - SpEL</h2><div class="ulist"><div class="title">SpEL</div><ul><li><p>expression language</p><div class="ulist"><ul><li><p>analogicznie do OGNL, Jboss EL, etc.</p></li><li><p>dynamiczny język podobny do Groovy / Ruby</p></li></ul></div></li><li><p>wspiera odczyt i modyfikacje obiektów w <em>runtime</em></p></li><li><p>może być uzywany we wszystkich produktach z portfolio Spring</p></li><li><p>może być używane w oderwaniu od Springa (jako osobny parser)</p></li></ul></div></section><section id="slide_moliwoci_spel"><h2>Możliwości SpEL</h2><div class="ulist"><ul><li><p>expressions</p></li><li><p>accessing properties, arrays, etc.</p></li><li><p>assignment</p></li><li><p>method invocation</p></li><li><p>collection selection &amp; projection</p></li></ul></div>
<div class="paragraph"><p>Wykorzystywane zarówno w konfiguracji XML jak i adnotacjach</p></div></section><section id="slide_expressionparser"><h2>ExpressionParser</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();
<span class="predefined-type">Expression</span> exp = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">'Hello World'</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">expression = </span><span class="delimiter">&quot;</span></span> + exp.getValue());</code></pre></div></div></section><section id="slide_expressionparser_2"><h2>ExpressionParser</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();
parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">'Hello World'</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">String</span>.class);
parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">6.0221415E+23</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Double</span>.class);
parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">0x7FFFFFFF</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Integer</span>.class);
parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">'2011/01/17'</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Date</span>.class);
parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>).getValue();
parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">null</span><span class="delimiter">&quot;</span></span>).getValue();</code></pre></div></div></section><section id="slide_evaluationcontext"><h2>EvaluationContext</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, Person&gt; map = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, Person&gt;();
map.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dima</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> Person(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dima</span><span class="delimiter">&quot;</span></span>, <span class="integer">27</span>));
map.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">Anya</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> Person(<span class="string"><span class="delimiter">&quot;</span><span class="content">Anya</span><span class="delimiter">&quot;</span></span>, <span class="integer">23</span>));

ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();
StandardEvaluationContext ctx = <span class="keyword">new</span> StandardEvaluationContext();
ctx.setVariable(<span class="string"><span class="delimiter">&quot;</span><span class="content">map</span><span class="delimiter">&quot;</span></span>, map);
ctx.setVariable(<span class="string"><span class="delimiter">&quot;</span><span class="content">anya</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Anya</span><span class="delimiter">&quot;</span></span>);
parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">#map['Dima']</span><span class="delimiter">&quot;</span></span>).getValue(ctx);
parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">#map[#anya]</span><span class="delimiter">&quot;</span></span>).getValue(ctx);</code></pre></div></div></section><section id="slide_obiekty_kolekcje_metody"><h2>Obiekty, kolekcje, metody</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="error">#</span>{person.name}
<span class="error">#</span>{person.Name}
<span class="error">#</span>{person.getName()}

<span class="error">#</span>{list[<span class="integer">0</span>]}
<span class="error">#</span>{list[<span class="integer">0</span>].name}
<span class="error">#</span>{map[<span class="error">‘</span>key<span class="error">’</span>]}

<span class="error">#</span>{<span class="error">‘</span>Some Text<span class="error">’</span>.substring(<span class="integer">0</span>, <span class="integer">2</span>)}
<span class="error">#</span>{<span class="error">‘</span>Some Text<span class="error">’</span>.startsWith(<span class="error">‘</span>text<span class="error">’</span>)}
<span class="error">#</span>{<span class="error">“</span>variable.toString()<span class="error">”</span>}</code></pre></div></div></section><section id="slide_wyraenia_i_operatory"><h2>Wyrażenia i operatory</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="error">#</span>{<span class="integer">5</span> == <span class="integer">5</span>} or <span class="error">#</span>{<span class="integer">5</span> eq <span class="integer">5</span>}
<span class="error">#</span>{<span class="error">‘</span>black<span class="error">’</span> &gt; <span class="error">’</span>block<span class="error">’</span>} or <span class="error">#</span>{<span class="error">‘</span>black<span class="error">’</span> gt <span class="error">‘</span>block<span class="error">’</span>}

<span class="error">#</span>{<span class="error">‘</span>text<span class="error">’</span> <span class="keyword">instanceof</span> T(<span class="type">int</span>)}
<span class="error">#</span>{<span class="string"><span class="delimiter">'</span><span class="content">5.00</span><span class="delimiter">'</span></span> matches <span class="string"><span class="delimiter">'</span><span class="content">^-?</span><span class="char">\\</span><span class="content">d+(</span><span class="char">\\</span><span class="content">.</span><span class="char">\\</span><span class="content">d{2})?$</span><span class="delimiter">'</span></span>}

<span class="error">#</span>{<span class="integer">5</span> + <span class="integer">5</span>}
<span class="error">#</span>{(<span class="integer">5</span> + <span class="integer">5</span>) * <span class="integer">2</span>}
<span class="error">#</span>{<span class="integer">17</span> / <span class="integer">5</span> % <span class="integer">3</span>}
<span class="error">#</span>{<span class="error">‘</span>Hello<span class="error">’</span> + <span class="error">‘</span> <span class="error">‘</span> + <span class="error">‘</span>world<span class="error">’</span>}

<span class="error">#</span>{<span class="predefined-constant">true</span> or <span class="predefined-constant">false</span>}
<span class="error">#</span>{!<span class="predefined-constant">true</span>}
<span class="error">#</span>{not isUserInGroup(<span class="error">‘</span>admin<span class="error">’</span>)}</code></pre></div></div></section><section id="slide_klasy"><h2>Klasy</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="error">#</span>{T(java.util.Date)}
<span class="error">#</span>{T(<span class="predefined-type">String</span>)}
<span class="error">#</span>{T(<span class="type">int</span>)}

<span class="error">#</span>{T(<span class="predefined-type">Math</span>).PI}
<span class="error">#</span>{T(<span class="predefined-type">Math</span>).random()}

<span class="error">#</span>{<span class="keyword">new</span> org.training.spel.Person(<span class="error">‘</span>Misha<span class="error">’</span>, <span class="integer">28</span>)}
<span class="error">#</span>{list.add(<span class="keyword">new</span> org.training.spel.Person())}</code></pre></div></div></section><section id="slide_if_then_else"><h2>If-then-else</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="error">#</span>{person.age&gt;<span class="integer">50</span> ? <span class="error">‘</span>Old<span class="error">’</span> : <span class="error">‘</span>Young<span class="error">’</span>}

<span class="comment">//Elvis operator</span>
<span class="error">#</span>{person.name ? : <span class="error">‘</span>N/A<span class="error">’</span>}

<span class="comment">//Safe navigation</span>
<span class="error">#</span>{address.city?.name}
<span class="error">#</span>{person.name?.length()}</code></pre></div></div></section><section id="slide_kolekcje"><h2>Kolekcje</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="comment">//select all</span>
<span class="error">#</span>{list.?[age&gt;<span class="integer">20</span>]}
<span class="error">#</span>{list.?[name.startsWith(<span class="error">‘</span>D<span class="error">’</span>)]}

<span class="comment">//select first</span>
<span class="error">#</span>{list.^[age&gt;<span class="integer">20</span>]}

<span class="comment">//select last</span>
<span class="error">#</span>{list.<span class="error">$</span>[getAge()&gt;<span class="integer">20</span>]}

<span class="comment">//select the names of all elements</span>
<span class="error">#</span>{list.![name]}

<span class="comment">//select the names length of all elements</span>
<span class="error">#</span>{list.![name.length()]}</code></pre></div></div></section><section id="slide_przykady"><h2>Przykłady</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">systemConfig</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.training.spel.SystemConfig</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">operatingSystem</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{systemProperties['os.name']}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javaVersion</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{systemProperties['java.vm.version']}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre></div></div></section><section id="slide_przykady_2"><h2>Przykłady</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemConfig</span> {

   <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{systemProperties['java.vm.version']}</span><span class="delimiter">&quot;</span></span>)
   <span class="directive">private</span> <span class="predefined-type">String</span> operatingSystem;

   <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{systemProperties['java.vm.version']}</span><span class="delimiter">&quot;</span></span>)
   <span class="directive">private</span> <span class="predefined-type">String</span> javaVersion;
}</code></pre></div></div></section><section id="slide_przykady_3"><h2>Przykłady</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{systemProperties['locale']}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">Locale</span> locale;

<span class="comment">//default</span>
<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{systemProperties['locale']?:'PL'}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">Locale</span> locale;

<span class="comment">//selective</span>
<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{systemProperties['level']&gt;2 ? gold : default}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> AccountRepository repository;</code></pre></div></div></section><section id="slide_spel_kiedy_uywa"><h2>SpEL - kiedy używać</h2><div class="ulist"><ul><li><p>Uproszczona praca z <code>java.reflection</code> API</p><div class="ulist"><ul><li><p>Wymaga znacząco mniej kodu</p></li></ul></div></li><li><p>Wygodne spłaszczenie istniejącej struktury obiektów do par klucz-wartość</p><div class="ulist"><ul><li><p>Np. na potrzeby cache, indeksacji</p></li></ul></div></li><li><p>Możliwość definiowanie dynamicznych akcji z poziomu 'administracji'</p></li></ul></div></section><section id="slide_adnotacja_qualifier"><h2>Adnotacja @Qualifier</h2><div class="ulist"><ul><li><p>Jeśli komponent posiada więcej niż definicję poprzez adnotację <code>@Qualifier</code> można odwołać się do konkretnej instancji komponentu</p></li><li><p>W XML analogiczny efekt uzyskujemy atrybutem <code>&lt;qualifier /&gt;</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Autowired</span>(required=<span class="predefined-constant">true</span>)
<span class="directive">public</span> ReportGenerator(
  <span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">repService</span><span class="delimiter">&quot;</span></span>) ReportingService repService) {
  <span class="local-variable">this</span>.reportingService = reportingService;
}</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reportingService</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.springtraining.domain.ReportingService</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;qualifier</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">repService</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre></div></div></section><section id="slide_cykl_ycia_komponentu"><h2>Cykl życia komponentu</h2><div class="ulist"><ul><li><p>Kontener odnajduje definicje komponentów będących singletonami</p></li><li><p>Następuje inicjacja singletonów</p></li><li><p>Dla każdego komponentu</p><div class="ulist"><ul><li><p>Następuje wstrzykiwanie zależności</p></li><li><p>Następuje wywołanie metody interfejsu <code>BeanNameAware</code></p></li><li><p>Następuje wywołanie metody interfejsu <code>ApplicationContextAware</code></p></li><li><p>Następuje wywołanie metody <code>@PostConstruct</code></p></li><li><p>Następuje wywołanie metody z interfejsu <code>InitializingBean</code></p></li><li><p>Następuje wywołanie metody skonfigurowanej z użyciem <code>init-method</code></p></li><li><p>Następuje wywołanie metody interfejsu <code>BeanPostProcessor</code></p></li></ul></div></li></ul></div></section><section id="slide_cykl_ycia_komponentu_2"><h2>Cykl życia komponentu (2)</h2><div class="ulist"><ul><li><p>Używanie komponentu</p></li><li><p>Następuje wywołanie metody <code>@PreDestroy</code></p></li><li><p>Następuje wywołanie metody z interfejsu <code>DisposableBean</code></p></li><li><p>Następuje wywołanie metody skonfigurowanej z użyciem <code>destroy-method</code></p></li></ul></div></section><section id="slide_zdarzenia_applicationcontext"><h2>Zdarzenia ApplicationContext</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ReportGenerator</span> <span class="directive">implements</span> ApplicationContextAware {
  <span class="directive">public</span> <span class="type">void</span> runReport() {
    ReportEvent reportEvent = <span class="keyword">new</span> ReportEvent(appCtx);
    appCtx.publishEvent(reportEvent);
  }
}</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ReportGenerator</span> {

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> <span class="directive">final</span> ApplicationEventPublisher publisher;

    <span class="directive">public</span> <span class="type">void</span> runReport() {
      ReportEvent reportEvent = <span class="keyword">new</span> ReportEvent();
      publisher.publishEvent(reportEvent);
    }
}</code></pre></div></div></section><section id="slide_zdarzenia_applicationcontext_2"><h2>Zdarzenia ApplicationContext</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CompanyDao</span>
  <span class="directive">implements</span> ApplicationListener&lt;ReportEvent&gt; {

  <span class="directive">public</span> <span class="type">void</span> onApplicationEvent(ReportEvent event) {
    <span class="comment">// ...</span>
  }
}</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CompanyDao</span> {

    <span class="annotation">@EventListener</span>
    <span class="directive">public</span> <span class="type">void</span> handleReportEvent(ReportEvent event) {
        <span class="comment">// ...</span>
    }
}</code></pre></div></div></section><section id="slide_standardowe_zdarzenia"><h2>Standardowe zdarzenia</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:40%"><col style="width:60%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>ContextRefreshEvent</strong></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Obiekt <code>ApplicationContext</code> jest inicjowany lub odświeżany (metodą <code>refresh()</code>)</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>ContextStartedEvent</strong></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Obiekt <code>ApplicationContext</code> został uruchomiony (metoda <code>start()</code>)</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>ContextStoppedEvent</strong></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Obiekt <code>ApplicationContext</code> został zatrzymany (metoda <code>stop()</code>)</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>ContexClosedEvent</strong></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Obiekt <code>ApplicationContext</code> został zakmnięty (metoda <code>close()</code>); wszystkie singletony zostały zniszczone</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>RequestHandleEvent</strong></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Zdarzenie generowane tuż po obsłużeniu żądania HTTP, w przypadku używania dostarczanego przez Spring <code>DispatcherServlet</code></p></div></div></td></tr></tbody></table></section><section id="slide_bean_validation_jsr_303"><h2>Bean Validation – JSR 303</h2><div class="ulist"><ul><li><p>Standard opisu poprawności modelu oraz API do walidacji</p></li><li><p>Zestaw meta adnotacji opisujących poprawność danych (<code>@NotNull</code>, <code>@Size</code>, <code>@Min</code>, <code>@Max</code> itd.)</p></li><li><p>Referencyjna implementacja to Hibernate Validator</p></li><li><p>Spring może korzystać z referencyjnego walidatora, jak też z dostarczanego przez siebie adaptera (implementującego ten sam interfejs)</p></li></ul></div></section><section id="slide_bean_validation_jsr_303_2"><h2>Bean Validation – JSR 303 (2)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {

  <span class="annotation">@NotNull</span>
  <span class="annotation">@Size</span>(min = <span class="integer">5</span>)
  <span class="directive">private</span> <span class="predefined-type">String</span> name;

  <span class="annotation">@NotNull</span>
  <span class="annotation">@Size</span>(min = <span class="integer">10</span>)
  <span class="directive">private</span> <span class="predefined-type">String</span> address;

  <span class="annotation">@Past</span>
  <span class="directive">private</span> <span class="predefined-type">Date</span> birthdate;

  <span class="comment">//..</span>
}</code></pre></div></div></section><section id="slide_bean_validation_jsr_303_3"><h2>Bean Validation – JSR 303 (3)</h2><div class="ulist"><ul><li><p>Dostęp do walidatora odbywa się przez <code>ValidationFactory</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java">Employee employee = <span class="keyword">new</span> Employee();
employee.setName(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>);
employee.setAddress(<span class="string"><span class="delimiter">&quot;</span><span class="content">Lodz</span><span class="delimiter">&quot;</span></span>);

ValidatorFactory validationFactory =
  Validation.buildDefaultValidatorFactory();
<span class="predefined-type">Validator</span> validator = validationFactory.getValidator();

<span class="predefined-type">Set</span>&lt;ConstraintViolation&lt;Employee&gt;&gt; constraints =
  validator.validate(employee); <i class="conum" data-value="1"></i><b>(1)</b></code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Lista błędów walidacji</td></tr></table></div></section><section id="slide_bean_validation_jsr_303_4"><h2>Bean Validation – JSR 303 (4)</h2><div class="ulist"><ul><li><p>Metoda <code>validate()</code> sprawdza poprawność klasy</p><div class="ulist"><ul><li><p><em>object</em> – obiekt do walidacji</p></li><li><p><em>groups</em> – grupa (lub lista grup) walidacyjnych</p></li></ul></div></li><li><p>Grupa walidacyjna pozwala zawęzić zakres walidacji, tylko do pewnego podzbioru ograniczeń</p><div class="ulist"><ul><li><p>Jest to pusty interfejs</p></li><li><p>Domyślna grupa walidacyjna to <code>javax.validation.groups.Default</code></p></li></ul></div></li></ul></div></section><section id="slide_bean_validation_jsr_303_5"><h2>Bean Validation – JSR 303 (5)</h2><div class="imageblock" style=""><img src="images/annotatiomania.png" alt="annotatiomania"></div></section><section id="slide_bean_validation_spring"><h2>Bean Validation - Spring</h2><div class="paragraph lead"><p>Komponent LocalValidationFactoryBean można bezpośrednio użyć w aplikacji Spring</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Bean</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">validator</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> LocalValidatorFactoryBean validator() {
  <span class="keyword">return</span> <span class="keyword">new</span> LocalValidatorFactoryBean();
}</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validator</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">o.s.v.beanvalidation.LocalValidatorFactoryBean</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre></div></div></section><section id="slide_bean_validation_spring_2"><h2>Bean Validation - Spring</h2><div class="paragraph lead"><p>Zainicjowany walidator możemy wstrzyknąć jako komponent</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> <span class="predefined-type">Validator</span> validator;

<span class="directive">public</span> <span class="predefined-type">Set</span>&lt;ConstraintViolation&lt;Param&gt;&gt; validate(Param p) {
  <span class="keyword">return</span> validator.validate(p, SearchValidationGroup.class);
}</code></pre></div></div></section><section id="slide_wasny_walidator"><h2>Własny walidator</h2><div class="ulist"><ul><li><p>Tworzymy adnotację na bazie adnotacji <code>@Constraint</code></p></li><li><p>Implementujemy interfejs <code>ConstraintValidator</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@NameFormatting</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Author</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

  <span class="comment">//...</span>

}</code></pre></div></div></section><section id="slide_wasny_walidator_2"><h2>Własny walidator</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Target</span>( { <span class="predefined-type">ElementType</span>.METHOD, <span class="predefined-type">ElementType</span>.FIELD, <span class="predefined-type">ElementType</span>.TYPE })
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Constraint</span>(validatedBy = NameFormattingValidator.class)
<span class="directive">public</span> <span class="annotation">@interface</span> NameFormatting {
  <span class="predefined-type">String</span> message() <span class="keyword">default</span> {c.e.constraints.nameFormatting};

  <span class="predefined-type">Class</span>&lt;?&gt;<span class="type">[]</span> groups() <span class="keyword">default</span> {};

  <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> Payload&gt;<span class="type">[]</span> payload() <span class="keyword">default</span> {};

}</code></pre></div></div></section><section id="slide_wasny_walidator_3"><h2>Własny walidator</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">NameFormattingValidator</span> <span class="directive">implements</span>
  ConstraintValidator&lt;NameFormatting, Author&gt; {

  <span class="directive">public</span> <span class="type">boolean</span> isValid(Author author,
    ConstraintValidatorContext context) {
    <span class="keyword">if</span> (author == <span class="predefined-constant">null</span>) <span class="keyword">return</span> <span class="predefined-constant">true</span>; <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="comment">//... dalsza logika walidacji</span>

    <span class="keyword">return</span> <span class="predefined-constant">true</span>;
  }
}</code></pre></div></div></section><section id="slide_bdy_walidacji"><h2>Błędy walidacji</h2><div class="ulist"><ul><li><p>Błędy walidacji przechowywane są w strukturze implementującej interfejs <code>ConstrainViolation</code></p></li><li><p>Zwyczajowo błędy raportowane są za pomocą klucza: [nazwa_błedu].[obiekt].[atrybut_obiektu] np.: <code>Future.task.date</code></p></li><li><p>Wartością jest domyślny opis błędu</p></li><li><p>Opisy błędu można z łatwością definiować i lokalizować wykorzystując mechanizm <code>ResourceBundles</code> i <code>MessageSource</code></p></li></ul></div></section><section id="slide_legacy_spring_validation"><h2>Legacy Spring Validation</h2><div class="paragraph lead"><p>Podstawowy interfejs <code>Validator</code> do tworzenia obiektów walidujących klasy modelu</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Validator</span> {

  <span class="directive">public</span> <span class="type">boolean</span> supports(<span class="predefined-type">Class</span>&lt;?&gt; arg0);

  <span class="directive">public</span> <span class="type">void</span> validate(<span class="predefined-type">Object</span> arg0, Errors arg1);

}</code></pre></div></div></section><section id="slide_legacy_spring_validation_2"><h2>Legacy Spring Validation</h2><div class="paragraph lead"><p>Przykładowa implementacja</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">EmployeeValidator</span> <span class="directive">implements</span> <span class="predefined-type">Validator</span> {

  <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> MAX_NAME_LENGHT = <span class="integer">30</span>;
  <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> MAX_ADDRESS_LENGHT = <span class="integer">80</span>;

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">boolean</span> supports(<span class="predefined-type">Class</span>&lt;?&gt; clazz) {
    <span class="keyword">return</span> Employee.class.equals(clazz);
  }

  <span class="comment">//...</span></code></pre></div></div></section><section id="slide_legacy_spring_validation_3"><h2>Legacy Spring Validation</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java">  <span class="comment">//...</span>

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> validate(<span class="predefined-type">Object</span> object, Errors e) {
    ValidationUtils.rejectIfEmpty(e, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name.empty</span><span class="delimiter">&quot;</span></span>);
    ValidationUtils.rejectIfEmpty(e, <span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">address.empty</span><span class="delimiter">&quot;</span></span>);

    Employee employee = (Employee) object;

    <span class="keyword">if</span> ( employee.getName().length() &gt; MAX_NAME_LENGHT ) {
      e.rejectValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name.tooLong</span><span class="delimiter">&quot;</span></span>);
    }
    <span class="comment">//...</span>
  }
}</code></pre></div></div></section><section id="slide_legacy_spring_validation_4"><h2>Legacy Spring Validation</h2><div class="paragraph lead"><p>Klasa <code>Errors</code></p></div>
<div class="ulist"><ul><li><p>Reprezentuje i przechowuje informacje na temat błędów związanych z walidacją</p></li><li><p>Umożliwia zarejestrowanie błędów dla obiektu lub pojedynczego pola</p></li><li><p>Najważniejsze metody</p><div class="ulist"><ul><li><p><em>reject(String errorCode [,String defaultMessage])</em><br>
zarejestruje błąd dla całego obiektu; errorCode oznacza klucz błędu w <code>Properties</code></p></li><li><p>_rejectValue(String field, String errorCode, [String defaultMessage])<br>
rejestruje błąd dla pojedynczego pola</p></li></ul></div></li></ul></div></section><section id="slide_legacy_spring_validation_5"><h2>Legacy Spring Validation</h2><div class="paragraph lead"><p>Klasa <code>ValidationUtils</code></p></div>
<div class="ulist"><ul><li><p>Pomocnicza klasa walidacyjna</p></li><li><p>Waliduje czy w obiekcie, pole nie jest puste</p></li><li><p>Działa na obiekcie typu Errors</p></li><li><p>Najważniejsze metody</p><div class="ulist"><ul><li><p><code>rejectIfEmpty(Errors errors, String fld, String code [,String defaultMsg])</code><br>
zarejestruje błąd dla całego obiektu, jeśli pole jest puste</p></li><li><p><code>rejectIfEmptyOrWhitespce(Errors errors, String fld, String code [,String defaultMsg])</code><br>
zarejestruje błąd dla całego obiektu, jeśli pole jest puste lub składa się tylko z białych znaków</p></li></ul></div></li></ul></div></section><section id="slide_lokalizacja_em_i18n_em"><h2>Lokalizacja – <em>i18n</em></h2><div class="ulist"><ul><li><p>Dodanie do konfiguracji komponentu MessageSource <em>informuje</em> framework o istnieniu wersji językowych</p><div class="ulist"><ul><li><p>Atrybut <code>basename</code> wskazuje lokalizację pliku z tłumaczeniami</p></li><li><p>Dla każdego kolejnego języka dodawana jest odpowiednia końcówka (<code>message_pl.properties</code>)</p></li></ul></div></li></ul></div></section><section id="slide_lokalizacja_aplikacji"><h2>Lokalizacja aplikacji</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageSource</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">o.s.c.support.ReloadableResourceBundleMessageSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basename</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:messages</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultEncoding</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Bean</span>
<span class="directive">public</span> ResourceBundleMessageSource messageSource() {
  ResourceBundleMessageSource messageSource =
          <span class="keyword">new</span> ResourceBundleMessageSource();
  messageSource.setBasename(<span class="string"><span class="delimiter">&quot;</span><span class="content">messages</span><span class="delimiter">&quot;</span></span>);
  messageSource.setDefaultEncoding(<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>);
  <span class="keyword">return</span> messageSource;
}</code></pre></div></div></section><section id="slide_lokalizacja_aplikacji_3"><h2>Lokalizacja aplikacji (3)</h2><div class="ulist"><ul><li><p>Aby skorzystać z i18n potrzebujemy dostęp do obiektu <code>ApplicationContext</code> lub <code>MessageSource</code></p></li><li><p>Wygodną metodą jest wstrzyknięcie <code>MessageSource</code> do klasy</p></li><li><p>Metoda <code>getMessage(String key, Object[] args, Locale locale)</code> służy do pobrania odpowiedniej wersji komunikatu</p></li><li><p>Mechanizm ten może być używany zarówno w walidacji i jak i całkowicie niezależnie</p></li><li><p>Używany jest w Spring MVC</p></li></ul></div></section><section id="slide_lokalizacja_aplikacji_4"><h2>Lokalizacja aplikacji (4)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ValidationService</span> {
  <span class="directive">private</span> MessageSource messageSource;

  <span class="directive">public</span> <span class="type">void</span> validate(Employee object) {
    <span class="comment">//... validate object</span>
    <span class="keyword">for</span> (ConstraintViolation&lt;Employee&gt; fieldError : errors) {
      <span class="predefined-type">String</span> field = fieldError.getPropertyPath();
      <span class="predefined-type">String</span> code = fieldError.getMessageTemplate();

      <span class="predefined-type">Locale</span> locale = <span class="keyword">new</span> <span class="predefined-type">Locale</span>( <span class="string"><span class="delimiter">&quot;</span><span class="content">pl</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">PL</span><span class="delimiter">&quot;</span></span> );
      messageSource.getMessage(code, <span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span>{}, locale);
    }
  }
}</code></pre></div></div></section></section>
<section><section id="slide_junit_4" data-background-image="images/background.jpg" data-background-size="cover"><h2>JUnit 4</h2></section><section id="slide_czym_jest_junit"><h2>Czym jest JUnit</h2><div class="ulist"><ul><li><p>Najpopularniejsze narzędzie do testowania w języku Java</p></li><li><p>Wspierane przez wiele środowisk programistycznych m. in. Eclipse, NetBeans, Idea IntelliJ</p></li><li><p>Istnieją wersję dla innych języków programistycznych np. NUnit, PHPUnit, FPCUnit</p></li><li><p>Alternatywa: TestNG (przyczyniło się do powstania wersji JUnit 4)</p></li><li><p>Nastawiony na asercje</p></li><li><p>Klasa testowa może być dowolną klasą</p></li><li><p>Metody testowe muszą być oznaczone adnotacją <code>@Test</code></p></li></ul></div></section><section id="slide_junit_4_2"><h2>JUnit 4</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="keyword">package</span> <span class="namespace">com.foo.tdd.intro</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.Assert</span>.*;
<span class="keyword">import</span> <span class="include">org.junit.Test</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">SampleTest</span> {

        <span class="annotation">@Test</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="directive">public</span> <span class="type">void</span> testToString() {
                <span class="predefined-type">String</span> string = <span class="string"><span class="delimiter">&quot;</span><span class="content">napis</span><span class="delimiter">&quot;</span></span>;
                assertEquals( <span class="string"><span class="delimiter">&quot;</span><span class="content">napis</span><span class="delimiter">&quot;</span></span>, string.toString() ); <i class="conum" data-value="2"></i><b>(2)</b>
        }

}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Adnotacja oznaczająca test</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Sprawdzenia, asercje</td></tr></table></div></section><section id="slide_adnotacja_test"><h2>Adnotacja @Test</h2><div class="paragraph"><p><code>@Test</code> - dana metoda zostanie potraktowana jako test.</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Test</span>( expected = <span class="exception">NullPointerException</span>.class ) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">void</span> testToStringWithNull() {
        <span class="predefined-type">String</span> string = <span class="predefined-constant">null</span>;
        assertEquals( <span class="string"><span class="delimiter">&quot;</span><span class="content">napis</span><span class="delimiter">&quot;</span></span>, string.toString() );
}

<span class="annotation">@Test</span>( timeout = <span class="integer">10</span> ) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="directive">public</span> <span class="type">void</span> testToString() {
        <span class="predefined-type">String</span> string = <span class="string"><span class="delimiter">&quot;</span><span class="content">napis</span><span class="delimiter">&quot;</span></span>;
        assertEquals( <span class="string"><span class="delimiter">&quot;</span><span class="content">napis</span><span class="delimiter">&quot;</span></span>, string.toString() );
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Oczekiwany wyjątek wskutek wykonania metody</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Limit czasowy na wykonanie testu</td></tr></table></div></section><section id="slide_adnotacje_before_and_after"><h2>Adnotacje @Before and @After</h2><div class="ulist"><ul><li><p><code>@Before</code> – metoda zostanie wykonana przed <strong>każdym</strong> testem.<br>
Zazwyczaj używana do inicjacji współdzielonych zmiennych (pól klasy testu).</p></li><li><p><code>@After</code> – metoda zostanie wykonana po <strong>każdym</strong> teście.<br>
Podobnie jak wyżej. Dotyczy procesu kończenia testu.</p></li></ul></div></section><section id="slide_adnotacje_before_and_after_2"><h2>Adnotacje @Before and @After (2)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">StringI18nTest</span> {

  <span class="directive">private</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; versions = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();

  <span class="annotation">@Before</span>
  <span class="directive">public</span> <span class="type">void</span> initTest() {
    versions.put( <span class="string"><span class="delimiter">&quot;</span><span class="content">pl</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Dzień dobry przyjacielu</span><span class="delimiter">&quot;</span></span> );
  }

  <span class="annotation">@Test</span>
  <span class="directive">public</span> <span class="type">void</span> differentLanguageVersions() {
    StringI18n hello = <span class="keyword">new</span> StringI18n( versions );
    assertEquals( <span class="string"><span class="delimiter">&quot;</span><span class="content">Dzień dobry przyjacielu</span><span class="delimiter">&quot;</span></span>, hello.get( <span class="string"><span class="delimiter">&quot;</span><span class="content">pl</span><span class="delimiter">&quot;</span></span> ) );
  }

  <span class="annotation">@After</span>
  <span class="directive">public</span> <span class="type">void</span> cleanup() {
          versions.clear();
  }

}</code></pre></div></div></section><section id="slide_adnotacje_beforeclass_i_afterclass"><h2>Adnotacje @BeforeClass i @AfterClass</h2><div class="ulist"><ul><li><p><code>@BeforeClass</code> – metoda zostanie wykonana przed <strong>wszystkimi</strong> testami.<br>
Zazwyczaj używana do inicjacji inicjacji zasobów (bazy danych, połączenia sieciowe, otwarcia plików itp.) Przydatna, gdy pozyskiwanie zasobów jest kosztowne,</p></li><li><p><code>@AfterClass</code> – metoda zostanie wykonana po <strong>wszystkich</strong> testach.</p></li></ul></div></section><section id="slide_adnotacje_beforeclass_i_afterclass_2"><h2>Adnotacje @BeforeClass i @AfterClass (2)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">DatabaseTest</span> {

        <span class="annotation">@BeforeClass</span>
        <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> setupBeforeClass() {
                <span class="comment">// inicjacja połączenia z bazą danych</span>
        }

        <span class="annotation">@Test</span>
        <span class="directive">public</span> <span class="type">void</span> findAll() {
                <span class="comment">// ...</span>
        }

        <span class="annotation">@AfterClass</span>
        <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> setupAfterClass() {
                <span class="comment">// zamykanie połączenia z bazą danych</span>
        }
}</code></pre></div></div></section><section id="slide_adnotacja_ignore"><h2>Adnotacja @Ignore</h2><div class="paragraph"><p><code>@Ignore</code> – test oznaczony tą adnotacją nie wykona się.</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">IgnoreTest</span> {

        <span class="annotation">@Ignore</span>( <span class="string"><span class="delimiter">&quot;</span><span class="content">Test wycofany</span><span class="delimiter">&quot;</span></span> )
        <span class="annotation">@Test</span>( timeout = <span class="integer">10</span> )
        <span class="directive">public</span> <span class="type">void</span> testToString() {
                <span class="predefined-type">String</span> string = <span class="string"><span class="delimiter">&quot;</span><span class="content">napis</span><span class="delimiter">&quot;</span></span>;
                assertEquals( <span class="string"><span class="delimiter">&quot;</span><span class="content">napis</span><span class="delimiter">&quot;</span></span>, string.toString() );
        }
}</code></pre></div></div></section><section id="slide_adnotacje_parameters_i_runwith"><h2>Adnotacje @Parameters i @RunWith</h2><div class="ulist"><ul><li><p><code>@Parameters</code> – adnotacja służąca do oznaczenia metody, która zwraca listę parametrów wejściowych, z którymi będą uruchomione testy.<br>
Przydatne, gdy test chcemy przeprowadzić dla wielu parametrów wejściowych i wyjściowych</p></li><li><p><code>@RunWith</code> – taką adnotacją należy oznaczyć klasę, która będzie korzystała z mechanizmu parametrów.</p></li></ul></div></section><section id="slide_adnotacje_parameters_i_runwith_2"><h2>Adnotacje @Parameters i @RunWith (2)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@RunWith</span>( Parameterized.class )
<span class="directive">public</span> <span class="type">class</span> <span class="class">ParametersTest</span> {

  <span class="directive">private</span> <span class="type">int</span> first, second, minimum;

  <span class="directive">public</span> ParametersTest(<span class="type">int</span> first, <span class="type">int</span> second, <span class="type">int</span> minimum) {
    <span class="local-variable">this</span>.first = first;
    <span class="local-variable">this</span>.second = second;
    <span class="local-variable">this</span>.minimum = minimum;
  }

  <span class="annotation">@Parameters</span>
  <span class="directive">public</span> <span class="directive">static</span> <span class="predefined-type">Collection</span> createParameters() {
    <span class="predefined-type">Object</span> parameters <span class="type">[]</span><span class="type">[]</span> = <span class="keyword">new</span> <span class="predefined-type">Object</span> <span class="type">[]</span><span class="type">[]</span> {
      {<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">1</span>}, {-<span class="integer">1</span>, <span class="integer">0</span>, -<span class="integer">1</span>}, {<span class="integer">100</span>, <span class="integer">1000</span>, <span class="integer">100</span> }
    };
    <span class="keyword">return</span> <span class="predefined-type">Arrays</span>.asList( parameters );
  }

  <span class="annotation">@Test</span>
  <span class="directive">public</span> <span class="type">void</span> minimum() {
    assertEquals(
      minimum, <span class="predefined-type">Math</span>.min( first, second ) );
  }
}</code></pre></div></div></section><section id="slide_junit_rules"><h2>JUnit Rules</h2><div class="ulist"><ul><li><p>JUnit Rules to dodatek umożliwiający zdefiniowanie dodatkowego zachowania do każdej metody testowej</p><div class="ulist"><ul><li><p>Dodatkowego zachowania lub zmianę istniejącego</p></li></ul></div></li><li><p>Reguły można stworzyć samodzielnie lub wykorzystać istniejące</p></li><li><p>Najpopularniejsze reguły to</p><div class="ulist"><ul><li><p><code>TemporaryFolder</code> rule</p></li><li><p><code>ExternalResource</code> rule</p></li><li><p><code>ExpectedException</code> rule</p></li><li><p><code>Timeout</code> rule</p></li></ul></div></li></ul></div></section><section id="slide_temporaryfolder"><h2>TemporaryFolder</h2><div class="ulist"><ul><li><p>Reguła <code>TemporaryFolder</code> umożliwia</p><div class="ulist"><ul><li><p>tworzenie plików</p></li><li><p>tworzenie folderów</p></li><li><p>usuwanie ich kiedy metoda testowa zakończy działania</p></li></ul></div></li><li><p>Pliki tworzone są w lokalizacji <code>/tmp</code> systemu operacyjnego</p><div class="ulist"><ul><li><p>Reguła nie weryfikuje czy usunięcie się powiodło</p></li><li><p>Nie ma konieczności obsługi wyjątków związanych (blok <code>finally</code>)</p></li></ul></div></li></ul></div></section><section id="slide_temporaryfolder_2"><h2>TemporaryFolder (2)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">TestTemporaryFolderRule</span> {
    <span class="annotation">@Rule</span>
    <span class="directive">public</span> TemporaryFolder testFolder = <span class="keyword">new</span> TemporaryFolder();

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> testInTempFolder() <span class="directive">throws</span> <span class="exception">IOException</span> {
        <span class="predefined-type">File</span> tempFile = testFolder.newFile(<span class="string"><span class="delimiter">&quot;</span><span class="content">file.txt</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="predefined-type">File</span> tempFolder = testFolder.newFolder(<span class="string"><span class="delimiter">&quot;</span><span class="content">folder</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Test folder: </span><span class="delimiter">&quot;</span></span> + testFolder.getRoot());
        <span class="comment">// test...</span>
    }
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Plik i folder zostaną usunięte po zakończeniu działania testu</td></tr></table></div></section><section id="slide_expectedexception"><h2>ExpectedException</h2><div class="paragraph"><p>Reguła umożliwia weryfikację że żaden wyjątek nie został wyrzucony podczas testów.</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleExpectedExceptionTest</span> {
    <span class="annotation">@Rule</span>
    <span class="directive">public</span> ExpectedException thrown = ExpectedException.none();

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> throwsNothing() {
        <span class="comment">// no exception expected, none thrown: passes.</span>
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> throwsExceptionWithSpecificType() {
        thrown.expect(<span class="exception">NullPointerException</span>.class);
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">NullPointerException</span>();
    }
}</code></pre></div></div></section><section id="slide_timeout"><h2>Timeout</h2><div class="ulist"><ul><li><p>Reguła ustawia globalny <em>timeout</em> dla wszystkich metod testowych w klasie</p><div class="ulist"><ul><li><p>Atrybut <code>@Test(timeout=100)</code> działa w obrębie pojedynczej metody</p></li></ul></div></li><li><p>Jako że każda metoda działa w osobnym wątku, wątek jest przerywany po upłynięciu czasu zdefiniowanego jako <em>timeout</em></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">HasGlobalLongTimeout</span> {

  <span class="annotation">@Rule</span>
  <span class="directive">public</span> Timeout globalTimeout = <span class="keyword">new</span> Timeout(<span class="integer">20</span>);

  <span class="annotation">@Test</span>
  <span class="directive">public</span> <span class="type">void</span> infiniteLoop() {
      <span class="keyword">while</span> (<span class="predefined-constant">true</span>) {} <span class="comment">//lub Thread.sleep(100);</span>
  }
}</code></pre></div></div></section><section id="slide_asercje"><h2>Asercje</h2><div class="paragraph"><p><strong>assertEquals([komunikat,] oczekiwana, aktualna)</strong></p></div>
<div class="ulist"><ul><li><p>Należy zachowywać kolejność oczekiwana – aktualna, gdyż tylko wtedy komunikaty generowane przez JUnit będą w sposób prawidłowy informowały o przebiegu procesu testowania</p></li><li><p>Komunikat jest opcjonalny, warto dodać, aby informacja o błędzie była jednoznaczna</p></li></ul></div></section><section id="slide_asercje_2"><h2>Asercje (2)</h2><div class="paragraph"><p><strong>assertNull( [komunikat] , obiekt)</strong>
<strong>assertNotNull( [komunikat] , obiekt)</strong></p></div>
<div class="ulist"><ul><li><p>Sprawdza czy podana referencja to null lub nie null</p></li></ul></div>
<div class="paragraph"><p><strong>assertSame( [komunikat] , oczekiwana, aktualna)</strong>
<strong>assertNotSame( [komunikat] , oczekiwana, aktualna)</strong></p></div>
<div class="ulist"><ul><li><p>Sprawdza czy podane referencje wskazują (lub nie) na ten sam obiekt</p></li></ul></div></section><section id="slide_asercje_3"><h2>Asercje (3)</h2><div class="paragraph"><p><strong>assertTrue( [komunikat] , warunek)</strong>
<strong>assertFalse( [komunikat] , warunek)</strong></p></div>
<div class="ulist"><ul><li><p>Sprawdza czy podany warunek jest prawdziwy lub fałszywy</p></li></ul></div>
<div class="paragraph"><p><strong>fail( [komunikat] )</strong></p></div>
<div class="ulist"><ul><li><p>Powoduje, że test, którego sterowanie dochodzi do tego miejsca, nie przechodzi + Najczęściej używane do zaawansowanego testowania wyjątków</p></li></ul></div></section><section id="slide_hamcrest_matchers"><h2>Hamcrest Matchers</h2><div class="paragraph"><p>According to the project homepage, <em>Hamcrest</em> provides a library of matcher objects (also known as constraints or predicates) allowing match rules to be defined declaratively, to be used in other frameworks. Typical scenarios include testing frameworks, mocking libraries and UI validation rules.</p></div>
<div class="paragraph"><p>Hamcrest is not a testing library: it just happens that matchers are very useful for testing.</p></div></section><section id="slide_hamcrest_w_przykadzie"><h2>Hamcrest - w przykładzie</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java">assertEquals([komunikat,] oczekiwana, aktualna);</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java">assertThat(aktualna,
        is(equalTo(oczekiwana));</code></pre></div></div></section><section id="slide_hamcrest_w_przykadzie_2"><h2>Hamcrest - w przykładzie (2)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java">assertEquals(someKittens, cat.getKittens().iterator().next()); <i class="conum" data-value="1"></i><b>(1)</b></code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="type">boolean</span> found = <span class="predefined-constant">false</span>;

<span class="keyword">for</span> (Kitten kitten: cat.getKittens()) {
        <span class="keyword">if</span> (kitten.equals(someKitten)) found = <span class="predefined-constant">true</span>;  <i class="conum" data-value="1"></i><b>(1)</b>
}

assertTrue(found);</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java">assertThat(cat.getKittens(), hasItem(someKitten));</code></pre></div></div></section></section>
<section><section id="slide_modu_4_testowanie_aplikacji_spring" data-background-image="images/background.jpg" data-background-size="cover"><h2>Moduł 4: Testowanie aplikacji Spring</h2></section><section id="slide_wsparcie_dla_testw"><h2>Wsparcie dla testów</h2><div class="ulist"><ul><li><p>Wsparcie dla testów jest od zawsze obecne we frameworku (leżało u jego podstaw)</p></li><li><p>Zastosowanie wzorca <em>Inversion of Control</em> umożliwia łatwe i wygodne testowanie jednostkowe – wszystkie zależności mogą być rozwiązane ręcznie i nie ma potrzeby implementowania interfejsów</p></li><li><p>Testowanie od najwcześniejszych etapów wspiera elastyczną architekturę</p></li></ul></div></section><section id="slide_testy_jednostkowe"><h2>Testy jednostkowe</h2><div class="paragraph"><p>Poprawne użycie wzorca <em>Dependency Injection</em> uwalnia nas od zależności od kontenera (serwera). Komponenty <em>POJO</em> możemy testować wykorzystując operator <code>new</code></p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> should_stop_running() {
    ExitCommand command = <span class="keyword">new</span> ExitCommand(<span class="keyword">new</span> TranslationProcess());

    TranslationProcess process = command.execute();

    assertThat(process.isRunning(), is(equalTo(<span class="predefined-constant">false</span>)));
}</code></pre></div></div></section><section id="slide_wykorzystanie_mock_objects"><h2>Wykorzystanie mock objects</h2><div class="paragraph"><p>Analogicznie można wykorzystać <em>mock objects</em></p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@RunWith</span>(MockitoJUnitRunner.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ExitCommandMockedTest</span> {

    <span class="annotation">@Mock</span> TranslationProcess process;
    <span class="annotation">@InjectMocks</span> ExitCommand command;

    <span class="annotation">@Test</span> <span class="directive">public</span> <span class="type">void</span> should_stop_running() {
        TranslationProcess process = command.execute();

        assertThat(process.isRunning(), is(equalTo(<span class="predefined-constant">false</span>)));
        Mockito.verify(process).setRunning(<span class="predefined-constant">false</span>);
    }
}</code></pre></div></div></section><section id="slide_testy_integracyjne"><h2>Testy integracyjne</h2><div class="ulist"><ul><li><p>Dotychczasowe testy uruchamiane były w oderwaniu od frameworka</p><div class="ulist"><ul><li><p>Nie inicjowały kontenera / kontekstu</p></li></ul></div></li><li><p>Spring Framework dostarcza mechanizmów testowania integracyjnego (z wykorzystaniem frameworka i jego komponentów)</p></li><li><p>Testy integracyjne wykorzystujemy do</p><div class="ulist"><ul><li><p>Weryfikacji konfiguracji kontenera IoC</p></li><li><p>Weryfikacji działania dostępu do danych (JDBC / ORM)</p></li><li><p>Sprawdzenie poprawności zarządzania transakcjami w aplikacji</p></li></ul></div></li></ul></div></section><section id="slide_testy_integracyjne_przykad"><h2>Testy integracyjne - przykład</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@RunWith</span>(SpringJUnit4ClassRunner.class) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@ContextConfiguration</span>(classes = JavaConfig.class) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TranslationCommandValidationTest</span> {

  <span class="annotation">@Test</span>
  <span class="directive">public</span> <span class="type">void</span> noAttributesCommand() {
    <span class="comment">//... test method body</span>
  }
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Inicjalizacja kontekstu <em>Spring</em></td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Lista klas używanych w teście (w tym także klasa konfiguracyjna <code>@Configuration</code>)</td></tr></table></div></section><section id="slide_testy_integracyjne_przykad_2"><h2>Testy integracyjne - przykład</h2><div class="ulist"><ul><li><p>Adnotacja <code>@RunWith(SpringJUnit4ClassRunner.class)</code> powoduje że test staje się komponentem zarządzanym przez kontener (możliwe jest m.in. wstrzykiwanie zależności)</p></li><li><p><code>@ContextConfiguration</code> umożliwia wywołanie istniejących konfiguracji (XML, JavaConfig)</p><div class="ulist"><ul><li><p><code>@ContextConfiguration.classes</code> określa lokalizację klas konfiguracyjnych</p></li><li><p><code>@ContextConfiguration.locations</code> określa lokalizację konfiguracyjnych plików XML. Domyślnie</p></li><li><p><code>@ContextConfiguration.initializers</code> określa klasy inicjalizujące kontekst (np. dodające nowe zmienne środowiskowe)</p></li></ul></div></li></ul></div></section><section id="slide_testy_integracyjne_przykad_3"><h2>Testy integracyjne - przykład</h2><div class="ulist"><div class="title">Konwencje konfiguracji testów</div><ul><li><p><code>@ContextConfiguration.classes</code></p><div class="ulist"><ul><li><p>Domyślna klasa konfiguracyjna to wewnętrzna klasa oznaczona adnotacją <code>@Configuration</code></p></li></ul></div></li><li><p><code>@ContextConfiguration.locations</code></p><div class="ulist"><ul><li><p>Domyślny plik konfiguracyjny dla klasy <code>com.example.FooTest</code> to <code>classpath:com/example/FooTest-context.xml</code></p></li></ul></div></li></ul></div></section><section id="slide_testy_integracyjne_mocks"><h2>Testy integracyjne - mocks</h2><div class="ulist"><ul><li><p>Spring Framework dostarcza kilku klas wspomagających testy integracyjne</p><div class="ulist"><ul><li><p><code>MockPropertySource</code> i <code>MockEnvironment</code> są przydatne przy symulowaniu zmiennych środowiskowych i zawartości plików <em>properties</em></p></li><li><p>Pakiet <code>org.springframework.mock.web</code> zawiera zestaw obiektów do pracy z aplikacjami WWW. Obiekty są lepiej przystosowane do natury frameworku niż generyczne <em>mocki</em> z <em>Mockito</em> lub <em>EasyMock</em></p></li></ul></div></li></ul></div></section><section id="slide_profile_konfiguracyjne"><h2>Profile konfiguracyjne</h2><div class="ulist"><ul><li><p>Spring umożliwia jednoczesne zarządzanie kilkoma konfiguracjami i wykorzystanie tylko jednej z nich</p></li><li><p>W zależności od środowiska (<em>dev</em>, <em>test</em>, <em>production</em>) - tworzone są tylko wybrane komponenty</p></li><li><p>Profil deklarowany jest poprzez adnotację <code>@Profile("&lt;nazwa&gt;")</code> i uruchamiany adnotacją <code>@ActiveProfiles</code></p><div class="ulist"><ul><li><p>Można aktywować więcej niż jeden profile - należy jednak stosować się do powszechnych reguł frameworka (np. brak komponentów o tej samej nazwie)</p></li></ul></div></li></ul></div></section><section id="slide_profile_konfiguracyjne_2"><h2>Profile konfiguracyjne</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@Profile</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">dev</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">StandaloneDataConfig</span> {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> <span class="predefined-type">DataSource</span> dataSource() {
        <span class="keyword">return</span> <span class="keyword">new</span> EmbeddedDatabaseBuilder()
            .setType(EmbeddedDatabaseType.HSQL)
            .addScript(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/bank/config/sql/schema.sql</span><span class="delimiter">&quot;</span></span>)
            .addScript(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/bank/config/sql/test-data.sql</span><span class="delimiter">&quot;</span></span>)
            .build();
    }
}</code></pre></div></div></section><section id="slide_profile_konfiguracyjne_3"><h2>Profile konfiguracyjne</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@Profile</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">production</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">JndiDataConfig</span> {

    <span class="annotation">@Bean</span>(destroyMethod=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">DataSource</span> dataSource() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">Context</span> ctx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
        <span class="keyword">return</span> (<span class="predefined-type">DataSource</span>) ctx
            .lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/jdbc/datasource</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre></div></div></section><section id="slide_profile_konfiguracyjne_4"><h2>Profile konfiguracyjne</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TransferServiceConfig</span> {

    <span class="annotation">@Autowired</span> <span class="predefined-type">DataSource</span> dataSource;

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> TransferService transferService(AccountRepository rep) {
        <span class="keyword">return</span> <span class="keyword">new</span> DefaultTransferService(rep);
    }

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> AccountRepository accountRepository() {
        <span class="keyword">return</span> <span class="keyword">new</span> JdbcAccountRepository(dataSource);
    }

}</code></pre></div></div></section><section id="slide_profile_konfiguracyjne_5"><h2>Profile konfiguracyjne</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@RunWith</span>(SpringJUnit4ClassRunner.class)
<span class="annotation">@ContextConfiguration</span>(classes = {
        TransferServiceConfig.class,
        StandaloneDataConfig.class,
        JndiDataConfig.class})
<span class="annotation">@ActiveProfiles</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">dev</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TransferServiceTest</span> {

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> TransferService transferService;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> testTransferService() {
        <span class="comment">// test the transferService</span>
    }
}</code></pre></div></div></section><section id="slide_spring_mockito"><h2>Spring + Mockito</h2><div class="ulist"><ul><li><p>Spring i Mockito bardzo dobrze współdziałają.</p></li><li><p>Wykorzystując zarówno konfigurację <code>XML</code> jak i <code>JavaConfig</code> możemy tworzyć komponenty Spring będące obiektami typu <em>mock</em> / <em>stub</em></p><div class="ulist"><ul><li><p>Warunkiem jest obecność mockito <code>org.mockito:mockito-all:&lt;version&gt;</code> w classpath</p></li></ul></div></li></ul></div></section><section id="slide_spring_mockito_2"><h2>Spring + Mockito</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Bean</span>
<span class="directive">public</span> PlatformTransactionManager txManager() {
    <span class="keyword">return</span> Mockito.mock(PlatformTransactionManager.class);
}</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">txManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.mockito.Mockito</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">factory-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mock</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;constructor-arg</span>
        <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">o.s.transaction.PlatformTransactionManager</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre></div></div></section></section>
<section><section id="slide_modu_5_programowanie_aspektowe" data-background-image="images/background.jpg" data-background-size="cover"><h2>Moduł 5: Programowanie aspektowe</h2></section><section id="slide_aspekty_2"><h2>Aspekty</h2><div class="ulist"><ul><li><p>Czym są aspekty?</p></li><li><p>Sposób działania oraz typy aspektów</p></li><li><p>Dołączenie aspektów do aplikacji</p></li><li><p>Przygotowanie i konfiguracja porady</p></li><li><p>Definiowanie punktów przecięcia</p></li></ul></div></section><section id="slide_czym_s_aspekty"><h2>Czym są aspekty?</h2><div class="ulist"><ul><li><p>Aspekt umożliwia dekorowanie klasy dodatkowymi funkcjami, bez ingerencji w samą metodę.</p></li><li><p>Pewnym specyficznym użyciem takiej architektury są filtry w aplikacjach webowych.</p></li><li><p>Jest to architektura szczególnie przydatna podczas implementacji wymagań, które wykraczają poza jedną warstwę systemu.</p></li></ul></div></section><section id="slide_czym_s_aspekty_2"><h2>Czym są aspekty? (2)</h2><div class="ulist"><ul><li><p>Object-Oriented Desing – aplikacje złożone są z różnych hierarchii współpracujących ze sobą obiektów</p></li><li><p>Aspect-Oriented Desing – wyróżnia w systemie aspekty, które w razie potrzeby mogą być włączane lub wyłączane</p></li></ul></div></section><section id="slide_czym_s_aspekty_3"><h2>Czym są aspekty? (3)</h2><div class="ulist"><ul><li><p>Aspekt jest zaimplementowany w oddzielnym module / klasie</p></li><li><p>Pozwala programiście skoncentrować się na implementowaniu logiki biznesowej</p></li><li><p>Aspekt można wywoływać pomiędzy komponentami</p></li></ul></div></section><section id="slide_czym_s_aspekty_4"><h2>Czym są aspekty? (4)</h2><div class="imageblock" style=""><img src="images/aspects.png" alt="aspects"></div></section><section id="slide_aspekty_pojcia"><h2>Aspekty - pojęcia</h2><div class="ulist"><ul><li><p><strong>Advice (porada)</strong>: akcja, która jest wykonywana w ramach aspektu.</p></li><li><p><strong>Join point (czyli punkt złączenia)</strong>: moment, w którym uruchamiana jest porada.</p></li><li><p><strong>Pointcut (punkt przecięcia)</strong>: predykat, który musi zostać spełniony, aby nastąpiło przecięcie.</p></li><li><p><strong>Aspekt</strong>: jest to byt łączący wszystkie trzy pojęcia w całość.</p></li></ul></div>
<div class="admonitionblock tip"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Aspekt definiuje kod, który zostanie uruchomiany w momencie zaistnienia zdarzenia, określonego w punkcie przecięcia dla metod (lub obiektów) określonych w punkcie złączenia.</td></tr></table></div></section><section id="slide_rodzaje_porad"><h2>Rodzaje porad</h2><div class="dlist"><dl><dt class="hdlist1">Before advice</dt><dd><p>porada uruchamiana jest przed akcją określoną w punkcie złączenia, nie mająca możliwości jej zablokowania.</p></dd><dt class="hdlist1">After returning advice</dt><dd><p>porada uruchamiana jest w momencie poprawnego zakończenia operacji (metody nie zwróciła wyjątku).</p></dd><dt class="hdlist1">After throwing advice</dt><dd><p>analogicznie do poprzedniego przypadku, z tą różnicą że akcja wywoływana jest w momencie zwrócenia wyjątku.</p></dd></dl></div></section><section id="slide_rodzaje_porad_2"><h2>Rodzaje porad</h2><div class="dlist"><dl><dt class="hdlist1">After advice</dt><dd><p>porada wykonywana zawsze po wywołaniu metody opisanej w punkcie złączenia</p></dd><dt class="hdlist1">Around advice</dt><dd><p>najpotężniejszy typ porad, uruchamiany przed wywołaniem akcji określonej w punkcie złączenia, mogący zablokować wywołanie metody lub dodatkowo zinterpretować zwrócony wynik.</p></dd></dl></div></section><section id="slide_rne_implementacje"><h2>Różne implementacje</h2><div class="ulist"><ul><li><p>W trakcie kompilacji – kod aplikacji jest modyfikowany w trakcie kompilowania</p></li><li><p>W trakcie ładowania klasy – aspekty dołączane są klas w momencie ich ładowania przez maszynę wirtualną</p></li><li><p>W trakcie wykonywania – obiekty są dynamicznie zastępowane (wzorzec proxy) przez środowisko AOP</p></li></ul></div></section><section id="slide_aspekty_na_niskim_poziomie"><h2>Aspekty na niskim poziomie</h2><div class="ulist"><ul><li><p>Bez użycia aspektów klient komunikuje się bezpośrednio z komponentem</p></li></ul></div>
<div class="imageblock" style=""><img src="images/aspects-no-proxy.png" alt="aspects no proxy"></div></section><section id="slide_aspekty_na_niskim_poziomie_2"><h2>Aspekty na niskim poziomie</h2><div class="ulist"><ul><li><p>Aspekt wymusza komunikację z obiektem przez proxy</p></li><li><p>Metody przestają być wywoływane bezpośrednio dlatego istnieje możliwość wstrzyknięcia dodatkowej funkcjonalności</p></li></ul></div>
<div class="imageblock" style=""><img src="images/aspects-proxy.png" alt="aspects proxy"></div></section><section id="slide_implementacja"><h2>Implementacja</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;beans&gt;</span>
        <span class="tag">&lt;aop:aspectj-autoproxy</span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableAspectJAutoProxy</span>
<span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">AppConfiguration</span> {
        <span class="comment">//..</span>
}</code></pre></div></div></section><section id="slide_implementacja_2"><h2>Implementacja (2)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Component</span>
<span class="annotation">@Aspect</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AuditLoggingAspect</span> {

  <span class="annotation">@Before</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* com.example.service.Clazz.method(*))
           &amp;&amp; args(params,..)</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">public</span> <span class="type">void</span> logWebServiceCall(CommandParameters params) {
          <span class="comment">//..</span>
  }

}</code></pre></div></div></section><section id="slide_rodzaje_porad_adnotacje"><h2>Rodzaje porad - adnotacje</h2><div class="ulist"><ul><li><p><strong>@Before</strong></p><div class="ulist"><ul><li><p>Before advice jest uruchamiana przed wywołaniem metody określonej przez pointcut</p></li></ul></div></li><li><p><strong>@After</strong></p><div class="ulist"><ul><li><p>Jest uruchamiana po wywołaniu metody określonej przez pointcut</p></li><li><p>Uruchomienie nastąpi również, gdy metoda zostanie zakończona błędem</p></li></ul></div></li></ul></div></section><section id="slide_rodzaje_porad_adnotacje_2"><h2>Rodzaje porad – adnotacje (2)</h2><div class="ulist"><ul><li><p><strong>@AfterReturning</strong></p><div class="ulist"><ul><li><p>Jest uruchamiana po poprawnym wywołaniu metody określonej przez pointcut</p></li><li><p>Wiążąc parametr result adnotacji z nazwą parametru funkcji, można przechwycić rezultat wykonania metody obiektu docelowego</p></li></ul></div></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@AfterReturning</span>( value=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean(*)</span><span class="delimiter">&quot;</span></span>, returning=<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> )
<span class="directive">public</span> <span class="type">void</span> afterReturning( <span class="predefined-type">Object</span> result ) {
  <span class="comment">//..</span>
}</code></pre></div></div></section><section id="slide_rodzaje_porad_adnotacje_3"><h2>Rodzaje porad – adnotacje (3)</h2><div class="ulist"><ul><li><p><strong>@AfterThrowing</strong></p><div class="ulist"><ul><li><p>Jest uruchamiana po wyrzuceniu wyjątku przez metodę określoną w pointcut</p></li><li><p>Dostęp do rzuconego wyjątku odbywa się poprzez powiązanie parametru metody z parametrem adnotacji @AfterThrowing</p></li></ul></div></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@AfterThrowing</span>(value=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean(*)</span><span class="delimiter">&quot;</span></span>, throwing=<span class="string"><span class="delimiter">&quot;</span><span class="content">ex</span><span class="delimiter">&quot;</span></span> )
<span class="directive">public</span> <span class="type">void</span> after( MyException ex ) {
  <span class="comment">//..</span>
}</code></pre></div></div></section><section id="slide_rodzaje_porad_adnotacje_4"><h2>Rodzaje porad – adnotacje (4)</h2><div class="ulist"><ul><li><p><strong>@Around</strong></p><div class="ulist"><ul><li><p>Around advice przechwytuje wykonanie metody</p></li><li><p>Pierwszym parametrem metody musi być referencja typu ProcedingJoinPoint reprezentujący aktualny joinpoint</p></li></ul></div></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Around</span>( <span class="string"><span class="delimiter">&quot;</span><span class="content">bean(*)</span><span class="delimiter">&quot;</span></span> )
<span class="directive">public</span> <span class="predefined-type">Object</span> around( ProceedingJoinPoint p ) <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
        <span class="keyword">return</span> p.proceed();
}</code></pre></div></div></section><section id="slide_rodzaje_porad_adnotacje_5"><h2>Rodzaje porad – adnotacje (5)</h2><div class="ulist"><ul><li><p>Za pomocą wyrażenia args() można przechwycić parametry, z którymi wywoływana jest metoda obiektów docelowego</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Before</span>( value=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean(*) &amp;&amp; args(params)</span><span class="delimiter">&quot;</span></span>, argNames=<span class="string"><span class="delimiter">&quot;</span><span class="content">params</span><span class="delimiter">&quot;</span></span> )
<span class="directive">public</span> <span class="type">void</span> around( <span class="predefined-type">Object</span> params ) {
  <span class="comment">//..</span>
}</code></pre></div></div></section><section id="slide_punkty_przeci"><h2>Punkty przecięć</h2><div class="ulist"><ul><li><p>Pointcuts definiowane są za pomocą języka wyrażeń AspectJ</p></li><li><p>Ze względu na specyfikę Spring AOP najczęściej używanym wyrażeniem jest</p><div class="ulist"><ul><li><p>execution( modyfikator typ_zwracany klasa_interfejs nazwa_metody(parametry) wyjątki)</p></li></ul></div></li><li><p>Wyrażenie execution aplikowane jest do wywołania metody</p></li></ul></div></section><section id="slide_punkty_przeci_definicje"><h2>Punkty przecięć - definicje</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:66.6667%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>modyfikator</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">public, private, protected, final, *</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>typ_zwracany</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">void, java.lang.String, java.util.Map, *</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>klasa_interfejs</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Klasa/interfejs w której zadeklarowana jest metoda foo.Test, com.example..* (wraz z podpakietami)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>nazwa_metody</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Find*, *</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>parametry</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">(), ( java.util.List )* jeden parametr dowolnego typu(..) dowolna liczba parametrów</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>wyjątki</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">throws foo.ApplicationException</p></td></tr></tbody></table></section><section id="slide_punkty_przeci_definicje_2"><h2>Punkty przecięć - definicje (2)</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:20%"><col style="width:80%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">within</p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Wszystkie metody danej klasy<br>
<code>within(com.example.services.ShopService)</code></p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">args</p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Wszystkie metody posiadające wskazane parametry<br>
<code>args(java.lang.String, int)</code></p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@args</p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Wszystkie metody, których parametry oznaczone są adnotacjami<br>
<code>@args(java.lang.Override)</code></p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@within</p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Wszystkie metody klasy oznaczone daną adnotacją<br>
<code>@within(org.springframework.stereotype.Repository)</code></p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@annotation</p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Wszystkie metody oznaczone daną adnotacją<br>
<code>@annotation(java.lang.Override)</code></p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">bean</p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Specyficzna dla Springa, wskazuje określony komponent <code>bean(shopService)</code></p></div></div></td></tr></tbody></table></section><section id="slide_punkty_przeci_przykady"><h2>Punkty przecięć - przykłady</h2><div class="ulist"><ul><li><p><code>execution( * *(..) )</code></p></li><li><p><code>execution( public java.util.Set pl.sevices..find*(..) )</code></p></li><li><p><code>execution( * *(..) ) throws Exception )</code></p></li><li><p><code>@annotation( org.springframework.beans.factory.annotation.Value )</code></p></li><li><p><code>within( * )</code></p></li><li><p><code>bean( * )</code></p></li><li><p><code>bean( * Service )</code></p></li><li><p><code>within( com.example..* )</code></p></li></ul></div></section><section id="slide_introductions"><h2>Introductions</h2><div class="ulist"><ul><li><p>Wprowadzenie (introduction) polega na dodaniu do klasy funkcjonalności, której nie posiada</p></li><li><p>Wprowadzenie w Spring AOP realizowane jest poprzez dynamiczne dodanie nowych metod obiektu</p></li></ul></div></section><section id="slide_introductions_interfejsy_2"><h2>Introductions - interfejsy (2)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Named</span> {
        <span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> name);
        <span class="directive">public</span> <span class="predefined-type">String</span> getName();
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">NamedImpl</span> <span class="directive">implements</span> Named {
        <span class="directive">private</span> <span class="predefined-type">String</span> name;
        <span class="comment">//..getters and setters ommitted</span>
}</code></pre></div></div></section><section id="slide_introductions_interfejsy_3"><h2>Introductions - interfejsy (3)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ShopService</span> {
        <span class="directive">public</span> <span class="type">void</span> buy();
}

<span class="annotation">@Service</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">shopService</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">DefaultShopService</span> <span class="directive">implements</span> ShopService {
        <span class="directive">public</span> <span class="type">void</span> buy() {
                <span class="comment">//..</span>
        }
}</code></pre></div></div></section><section id="slide_introductions_aspekt_4"><h2>Introductions - aspekt (4)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Component</span>
<span class="annotation">@Aspect</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">NamedAspect</span> {
  <span class="annotation">@DeclareParents</span>(value=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.*ShopService</span><span class="delimiter">&quot;</span></span>,
                  defaultImpl=NamedImpl.class)
  <span class="directive">public</span> <span class="directive">static</span> Named feature;
    <span class="comment">//..</span>
  }
}</code></pre></div></div></section><section id="slide_introductions_wywoanie_5"><h2>Introductions - wywołanie (5)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java">ApplicationContext ctx = ...

ShopService service = ctx.getBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">shopService</span><span class="delimiter">&quot;</span></span>,
        ShopService.class);
service.buy();

Named namedService = (Named) service;
namedService.setName(<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultShopService</span><span class="delimiter">&quot;</span></span>);</code></pre></div></div></section></section>
<section><section id="slide_modu_6_warstwa_dostpu_do_danych" data-background-image="images/background.jpg" data-background-size="cover"><h2>Moduł 6: Warstwa dostępu do danych</h2></section><section id="slide_baza_danych_w_springu"><h2>Baza danych w Springu</h2><div class="ulist"><ul><li><p>Konfiguracja bazy danych</p></li><li><p>Podstawowe metody dostępu do danych</p></li><li><p>JPA</p></li><li><p>Na czym polega zarządzanie encjami</p></li><li><p>Transakcje</p></li></ul></div></section><section id="slide_szablon_jdbc"><h2>Szablon JDBC</h2><div class="imageblock" style=""><img src="images/1000000000000248000001DB0F060EDD.png" alt="1000000000000248000001DB0F060EDD"></div></section><section id="slide_szablon_jdbc_2"><h2>Szablon JDBC (2)</h2><div class="ulist"><ul><li><p>Większość operacji jest powtarzalna i stanowi pewien szablon.</p></li><li><p>Klasa JdbcTemplate stanowi tego typu szablon.</p></li><li><p>Programista zajmuje się przede wszystkim przygotowaniem zapytania i przetwarzaniem wyników.</p></li></ul></div></section><section id="slide_dostp_do_danych_w_springu"><h2>Dostęp do danych w Springu</h2><div class="ulist"><ul><li><p>Spring umożliwia konfiguracja połączenia</p><div class="ulist"><ul><li><p>bezpośrednio w pliku konfiguracyjnym</p></li><li><p>korzystając JNDI</p></li></ul></div></li><li><p>Ostatecznie w ten sposób uzyskuje się obiekty typu <code>java.sql.DataSource</code></p></li><li><p>Źródło danych wykorzystywane jest przez wybrany mechanizm persystencji</p></li></ul></div></section><section id="slide_dostp_do_danych_w_springu_2"><h2>Dostęp do danych w Springu</h2><div class="ulist"><ul><li><p>Spring dostarcza klasę <code>DriverManagerDataSource</code>, którą można skonfigurować z użyciem parametrów</p><div class="ulist"><ul><li><p>url – adres potrzebny do uzyskania połączenia</p></li><li><p>driverClassName – nazwa klasy sterownika</p></li><li><p>username, password – nazwa i hasło użytkownika</p></li></ul></div></li></ul></div></section><section id="slide_dostp_do_danych_w_springu_3"><h2>Dostęp do danych w Springu</h2><div class="ulist"><ul><li><p><code>DriverManagerDataSource</code> jest prostą implementacją interfejsu <code>DataSource</code></p></li><li><p>Każde odwołanie się do puli tworzy nowe połączenie</p></li><li><p>Możliwe jest użycie ogólnodostępnych bibliotek do konfiguracji puli połączeń (np. Apache DBCP)</p></li></ul></div></section><section id="slide_dostp_do_danych_w_springu_4"><h2>Dostęp do danych w Springu</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">o.s.jdbc.datasource.DriverManagerDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">driverClassName</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mysql.jdbc.Driver</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:mysql://localhost:3306/translations?</span>
           <span class="content">useUnicode=true</span><span class="entity">&amp;amp;</span><span class="content">characterEncoding=utf-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">root</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">root</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre></div></div></section><section id="slide_dostp_do_danych_w_springu_5"><h2>Dostęp do danych w Springu</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">o.s.jdbc.datasource.DriverManagerDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">driverClassName</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.postgresql.Driver</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:postgresql://localhost:5432/translations</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">root</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">root</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre></div></div></section><section id="slide_dostp_do_danych_w_springu_6"><h2>Dostęp do danych w Springu</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Bean</span>
<span class="directive">public</span> <span class="predefined-type">DataSource</span> dataSource() {
  DriverManagerDataSource ds = <span class="keyword">new</span> DriverManagerDataSource();
  ds.setDriverClassName(com.mysql.jdbc.Driver.class.getName());
  ds.setUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:mysql://localhost:3306/translations?
          useUnicode=true&amp;characterEncoding=utf-8</span><span class="delimiter">&quot;</span></span>);
  ds.setUsername(<span class="string"><span class="delimiter">&quot;</span><span class="content">root</span><span class="delimiter">&quot;</span></span>);
  ds.setPassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">root</span><span class="delimiter">&quot;</span></span>);
  <span class="keyword">return</span> ds;
}</code></pre></div></div></section><section id="slide_wykorzystanie_jdbctemplate"><h2>Wykorzystanie JdbcTemplate</h2><div class="ulist"><ul><li><p><code>JdbcTemplate</code> to komponent ułatwiający komunikację z bazą danych.</p></li><li><p>Ogranicza on rolę programisty do konfiguracji połączenia do bazy oraz pisania zapytań SQL</p></li><li><p>Pozostałe czynności wykonuje framework</p><div class="ulist"><ul><li><p>otwieranie połączenia do bazy danych</p></li><li><p>pobranie wyników oraz iteracja po nich (<code>ResultSet</code>)</p></li><li><p>obsługa błędów i transakcji</p></li><li><p>zamknięcie połączenia do bazy danych</p></li></ul></div></li></ul></div></section><section id="slide_waciwoci_jdbctemplate"><h2>Właściwości JdbcTemplate</h2><div class="ulist"><ul><li><p>Na klasie <code>JdbcTemplate</code> opiera się całość obsługi JDBC w Springu</p></li><li><p><code>JdbcTemplate</code> jest bezpieczny wątkowo (wystarczy konfiguracja tylko jednego komponentu)</p></li><li><p>Komponent może być współdzielony przez wiele serwisów</p></li><li><p>Umożliwia pobieranie danych, jak też ich zapis, aktualizację oraz wywoływanie procedur po stronie bazy danych</p></li></ul></div></section><section id="slide_komponenty_jdbctemplate"><h2>Komponenty JdbcTemplate</h2><div class="ulist"><ul><li><p>NamedParameterJdbcTemplate</p><div class="ulist"><ul><li><p>Wprowadza możliwość nazywania parametrów (nie tylko ich indeksowania)</p></li></ul></div></li><li><p><code>SimpleJdbcTemplate</code></p><div class="ulist"><ul><li><p>Ulepszona wersja <code>JdbcTemplate</code> oparta o Java 1.5</p></li></ul></div></li><li><p><code>SimpleJdbcInsert</code> oraz <code>SimpleJdbcCall</code></p><div class="ulist"><ul><li><p>Upraszcza konfigurację do minimum bazując na meta informacjach dostarczonych przez bazę danych</p></li></ul></div></li><li><p><code>MappingSqlQuery</code></p><div class="ulist"><ul><li><p>Umożliwia mapowanie zapytań SQL na obiekty</p></li></ul></div></li></ul></div></section><section id="slide_szablon_jdbctemplate"><h2>Szablon JdbcTemplate</h2><div class="ulist"><ul><li><p>JdbcTemplate jest obiektem bezpiecznym wątkowo</p></li><li><p>Może być współdzielony przez wiele obiektów</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">DataSourceRepository</span> {
  JdbcTemplate jdbcTemplate;

  <span class="annotation">@Autowired</span>
  <span class="directive">public</span> DataSourceRepository(<span class="predefined-type">DataSource</span> ds) {
    jdbcTemplate = <span class="keyword">new</span> JdbcTemplate(ds);
  }

  <span class="directive">public</span> <span class="type">int</span> countWords() {
    <span class="keyword">return</span> jdbcTemplate.queryForInt(<span class="string"><span class="delimiter">&quot;</span><span class="content">select count(*) from words</span><span class="delimiter">&quot;</span></span>)
  }
}</code></pre></div></div></section><section id="slide_rowmapper"><h2>RowMapper</h2><div class="ulist"><ul><li><p><code>RowMapper</code> umożliwia w ramach szablonu złożone przetwarzanie wyników.</p></li><li><p>Głównie służy do zwracania kolekcji obiektów powstałych na bazie zapytania.</p><div class="ulist"><ul><li><p>Umożliwia iterację po wynikach (<code>ResultSet</code>)</p></li><li><p>Ułatwia mapowanie wyników SQL na obiekty bez konieczności obsługi <code>SQLExceptions</code></p></li></ul></div></li></ul></div></section><section id="slide_rowmapper_2"><h2>RowMapper (2)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="predefined-type">List</span>&lt;DictionaryWord&gt; getSavedWords() {
  <span class="keyword">return</span> jdbcTemplate.query(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from words</span><span class="delimiter">&quot;</span></span>,
    <span class="keyword">new</span> <span class="predefined-type">RowMapper</span>&lt;DictionaryWord&gt;() {

      <span class="directive">public</span> DictionaryWord mapRow(<span class="predefined-type">ResultSet</span> rs, <span class="type">int</span> rowNum)
        <span class="directive">throws</span> <span class="exception">SQLException</span> {
        <span class="keyword">return</span> DictionaryWord
               .fromPolishWord(rs.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">polish_word</span><span class="delimiter">&quot;</span></span>))
               .withEnglishWord(rs.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">english_word</span><span class="delimiter">&quot;</span></span>))
               .build();
        }
    });
}</code></pre></div></div></section><section id="slide_orm"><h2>ORM</h2><div class="ulist"><ul><li><p>Mapowanie obiektowo – relacyjne (ORM) to mechanizmy udostępniające warstwę abstrakcji ułatwiające korzystanie z baz danych</p></li><li><p>Są łącznikiem między światem obiektowym (Java) i relacyjnym (SQL)</p></li><li><p>Programista korzystający ze skonfigurowanego ORM nie musi znać struktur baz danych</p></li><li><p>ORM ukrywa szczegóły implementacji związanych z konkretnymi bazami danych</p></li></ul></div></section><section id="slide_orm_w_springu"><h2>ORM w Springu</h2><div class="ulist"><ul><li><p>Spring umożliwia integrację z najpopularniejszymi narzędziami ORM (JPA, JDO, Hibernate, iBatis)</p></li><li><p>Framework dostarcza także własne podstawowe metody do pracy z obiektami (MappingSqlQuery)</p></li><li><p>Co daje użycie Spring:</p><div class="ulist"><ul><li><p>Ułatwia zarządzanie zasobami (połączenie do bazy danych, źródła danych)</p></li><li><p>Oferuje zarządzanie transakcjami na poziomie aplikacji</p></li><li><p>Ułatwia testowanie</p></li></ul></div></li></ul></div></section><section id="slide_mapowanie_na_obiekty"><h2>Mapowanie na obiekty</h2><div class="ulist"><ul><li><p><code>MappingSqlQuery</code> ułatwia mapowanie zapytań SQL na obiekty (coś na wzór Named Queries w JPA)</p></li><li><p>Łączy w sobie zapytanie i obiektową reprezentacje</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">TaskMappingQuery</span> <span class="directive">extends</span> MappingSqlQuery&lt;Task&gt; {

        <span class="directive">public</span> TaskMappingQuery(<span class="predefined-type">DataSource</span> ds) {
                <span class="local-variable">super</span>(ds, <span class="string"><span class="delimiter">&quot;</span><span class="content">select * from tasks</span><span class="delimiter">&quot;</span></span>);
                compile();
        }
        <span class="directive">protected</span> Task mapRow(<span class="predefined-type">ResultSet</span> rs, <span class="type">int</span> n)
                <span class="directive">throws</span> <span class="exception">SQLException</span> {
                <span class="comment">//build and return Task object</span>
        }
}</code></pre></div></div></section><section id="slide_mapowanie_na_obiekty_2"><h2>Mapowanie na obiekty (2)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">TaskDao</span> {

  <span class="directive">private</span> TaskMappingQuery byIdMappingQuery;

  <span class="annotation">@Autowired</span>
  <span class="directive">public</span> TaskDao(<span class="predefined-type">DataSource</span> dataSource) {
    <span class="local-variable">this</span>.byIdMappingQuery = <span class="keyword">new</span> TaskMappingQuery(dataSource);
  }

  <span class="directive">public</span> Task getTaskById(<span class="type">long</span> id) {
    <span class="keyword">return</span> byIdMappingQuery.findObject(id);
  }
}</code></pre></div></div></section></section>
<section><section id="slide_modu_7_jms" data-background-image="images/background.jpg" data-background-size="cover"><h2>Moduł 7: JMS</h2></section><section id="slide_komunikacja_asynchroniczna"><h2>Komunikacja asynchroniczna</h2><div class="ulist"><ul><li><p>W dużych systemach rozproszonych komunikacja synchroniczna pomiędzy poszczególnymi częściami aplikacji ma następujące wady</p><div class="ulist"><ul><li><p>Zużywa wiele zasobów</p></li><li><p>Jest wrażliwa na zerwanie połączenia</p></li><li><p>Wprowadza silny związek pomiędzy stronami komunikacji</p></li></ul></div></li><li><p>Wprowadzenie systemu komunikacji asnychronicznej (Message-Oriented Middleware) częściowo rozwiązuje te problemy</p></li></ul></div></section><section id="slide_java_message_service_api"><h2>Java Message Service API</h2><div class="ulist"><div class="title">Sposoby komunikacji</div><ul><li><p>Kolejka (ang. Queue) <strong>połączenie punkt-punkt</strong></p><div class="ulist"><ul><li><p>nadawca wysyła wiadomości do kolejki, odbiorca - odbiera.</p></li><li><p>każdy komunikat może zostać odebrany przez tylko przez jednego odbiorcę, który potwierdza odbiór wiadomości.</p></li></ul></div></li><li><p>Temat (ang. Topic) <strong>publikacja - subskrypcja</strong></p><div class="ulist"><ul><li><p>każda wiadomość może mieć wielu odbiorców (subskrybentów), a także wielu nadawców.</p></li><li><p>wiadomość jest usuwana dopiero gdy zostanie dostarczona do wszystkich subskrybentów.</p></li></ul></div></li></ul></div></section><section id="slide_komponenty_sterowane_komunikatami"><h2>Komponenty sterowane komunikatami</h2><div class="ulist"><ul><li><p>Kontener aplikacyjny zapewnia</p><div class="ulist"><ul><li><p>zarządzanie zasobami,</p></li><li><p>zarządzanie wątkami,</p></li><li><p>transakcyjność, potwierdzanie odbioru,</p></li><li><p>bezpieczeństwo wywołań,</p></li><li><p>równoważenie obciążenia.</p></li></ul></div></li><li><p>Programista skupia się <em>tylko</em> i wyłącznie na realizacji wymagań biznesowych</p></li></ul></div></section><section id="slide_configuration"><h2>Configuration</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> DEFAULT_BROKER_URL = <span class="string"><span class="delimiter">&quot;</span><span class="content">tcp://localhost:61616</span><span class="delimiter">&quot;</span></span>;
<span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> ORDER_QUEUE = <span class="string"><span class="delimiter">&quot;</span><span class="content">words-queue</span><span class="delimiter">&quot;</span></span>;

<span class="annotation">@Bean</span>
<span class="directive">public</span> ActiveMQConnectionFactory connectionFactory(){
    ActiveMQConnectionFactory connectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory();
    connectionFactory.setBrokerURL(DEFAULT_BROKER_URL);
    connectionFactory.setTrustAllPackages(<span class="predefined-constant">true</span>);
    <span class="keyword">return</span> connectionFactory;
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> JmsTemplate jmsTemplate(ConnectionFactory cf){
    JmsTemplate template = <span class="keyword">new</span> JmsTemplate();
    template.setConnectionFactory(cf);
    template.setDefaultDestinationName(ORDER_QUEUE);
    <span class="keyword">return</span> template;
}</code></pre></div></div></section><section id="slide_configuration_2"><h2>Configuration</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> DEFAULT_BROKER_URL = <span class="string"><span class="delimiter">&quot;</span><span class="content">tcp://localhost:61616</span><span class="delimiter">&quot;</span></span>;

<span class="annotation">@Bean</span>
<span class="directive">public</span> DefaultJmsListenerContainerFactory jmsListenerContainerFactory(ConnectionFactory cf) {
    DefaultJmsListenerContainerFactory factory = <span class="keyword">new</span> DefaultJmsListenerContainerFactory();
    factory.setConnectionFactory(cf);
    factory.setConcurrency(<span class="string"><span class="delimiter">&quot;</span><span class="content">1-1</span><span class="delimiter">&quot;</span></span>);
    <span class="keyword">return</span> factory;
}</code></pre></div></div></section><section id="slide_message_producer"><h2>Message Producer</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="predefined-type">Connection</span> connection = connectionFactory.createConnection();
Session session = connection.createSession(<span class="predefined-constant">false</span>, Session.AUTO_ACKNOWLEDGE);
<span class="predefined-type">Queue</span> queue = session.createQueue(<span class="string"><span class="delimiter">&quot;</span><span class="content">words-queue</span><span class="delimiter">&quot;</span></span>);
MessageProducer producer = session.createProducer(queue);
TextMessage message = session.createTextMessage(word);

producer.send(message);</code></pre></div></div></section><section id="slide_message_producer_2"><h2>Message Producer</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">private</span> JmsTemplate jmsTemplate;
<span class="directive">private</span> <span class="predefined-type">Queue</span> queue;

<span class="directive">public</span> <span class="type">void</span> setConnectionFactory(ConnectionFactory cf) {
    <span class="local-variable">this</span>.jmsTemplate = <span class="keyword">new</span> JmsTemplate(cf);
}

<span class="directive">public</span> <span class="type">void</span> simpleSend() {
    <span class="local-variable">this</span>.jmsTemplate.send(getQueueName(), <span class="keyword">new</span> MessageCreator() {
        <span class="directive">public</span> Message createMessage(Session session) <span class="directive">throws</span> JMSException {
            <span class="keyword">return</span> session.createTextMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello queue world</span><span class="delimiter">&quot;</span></span>);
        }
    });
}</code></pre></div></div></section><section id="slide_message_listener"><h2>Message Listener</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="predefined-type">Connection</span> connection = cf.createConnection();
Session session = connection.createSession(<span class="predefined-constant">false</span>, Session.AUTO_ACKNOWLEDGE);
<span class="predefined-type">Queue</span> queue = session.createQueue(QUEUE);
MessageConsumer consumer = session.createConsumer(queue);
connection.start();

<span class="keyword">for</span> (;;) {
    Message receivedMessage = consumer.receiveNoWait();
    <span class="keyword">if</span> (receivedMessage != <span class="predefined-constant">null</span>) {
        LOG.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">JMS message received with {} </span><span class="char">\n</span><span class="content">{}</span><span class="delimiter">&quot;</span></span>, receivedMessage.getJMSMessageID(), ((ObjectMessage)receivedMessage).getObject());
    }
    <span class="predefined-type">Thread</span>.sleep(<span class="integer">1000</span>);
}</code></pre></div></div></section><section id="slide_message_listener_2"><h2>Message Listener</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MessageReceiver</span> {

    <span class="annotation">@JmsListener</span>(destination = <span class="string"><span class="delimiter">&quot;</span><span class="content">queue-name</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> receiveMessage(<span class="directive">final</span> Message&lt;<span class="predefined-type">String</span>&gt; message) <span class="directive">throws</span> JMSException {
        MessageHeaders headers =  message.getHeaders();
        <span class="predefined-type">String</span> response = message.getPayload();
    }
}</code></pre></div></div></section></section>
<section><section id="slide_servlet_api" data-background-image="images/background.jpg" data-background-size="cover"><h2>Servlet API</h2></section><section id="slide_co_to_jest_strong_java_servlet_strong"><h2>Co to jest <strong>Java Servlet</strong></h2><div class="ulist"><ul><li><p>Technologia do generowania dynamicznych stron WWW (tak jak PHP, ASP, ASP.NET, &#8230;&#8203;)</p></li><li><p>Protokół i niezależne od platformy komponenty serwerowe, napisane w Javie, które rozszerzają standardowe serwery WWW (takie jak Apache)</p></li><li><p>Klasa HttpServlet</p><div class="ulist"><ul><li><p>Umożliwia dynamiczne generowanie zawartości strony (HTML, XML, …)</p></li></ul></div></li></ul></div></section><section id="slide_co_to_jest_strong_java_servlet_strong_2"><h2>Co to jest <strong>Java Servlet</strong></h2><div class="ulist"><ul><li><p>Framework umożliwiający budowanie aplikacji w oparciu o paradygmat żądanie – odpowiedź (request-response paradigm)</p></li><li><p>Działają na każdym serwerze aplikacji Javy</p></li><li><p>Siłą rzeczy mogą wykorzystywać szerokie i powszechne API JavaEE</p><div class="ulist"><ul><li><p>JDBC, Persistence, EJB, JMS, JAX-WS, JTA, JTS, RMI, JNDI, JAXP, &#8230;&#8203;</p></li></ul></div></li><li><p>Podstawa wielu frameworków webowych w świecie Javy (JSP, JSF, &#8230;&#8203;)</p></li></ul></div></section><section id="slide_servlet_services"><h2>Servlet Services</h2><div class="ulist"><div class="title">Java Servlets umożliwiają</div><ul><li><p>Niskopoziomowe API do budowania aplikacji internetowych</p></li><li><p>Podstawe dla innych frameworków i narzędzi: JavaServer Pages (JSP) oraz JavaServer Faces (JSF)</p></li><li><p>Może dostaraczać różne typy danych dla dowolnego klienta</p><div class="ulist"><ul><li><p>XML, HTML, WML, GIF, etc&#8230;&#8203;</p></li></ul></div></li><li><p>Może działać jako kontroler w aplikacjach JSP (w rozumieniu wzorca MVC)</p></li></ul></div></section><section id="slide_servlets_architecture"><h2>Servlets Architecture</h2><div class="dlist"><dl><dt class="hdlist1">Klasa HttpServlet</dt><dd><div class="ulist"><ul><li><p>Obsługuje żądania HTTP</p></li><li><p>Dla każdej metody HTTP (GET, POST, i inne) jest adekwatna metoda w klasie HttpServlet:</p><div class="ulist"><ul><li><p><code>doGet(…)</code> – HTTP GET requests</p></li><li><p><code>doPost(…)</code> – HTTP POST requests</p></li><li><p><code>doPut(…)</code>, <code>doHead(…)</code>, <code>doDelete(…)</code>, <code>doTrace(…)</code>, <code>doOptions(…)</code></p></li></ul></div></li><li><p>Servlet musi implementować jedną z powyższych metod albo metodę <code>service(…)</code></p></li></ul></div></dd></dl></div></section><section id="slide_servlets_architecture_2"><h2>Servlets Architecture (2)</h2><div class="dlist"><dl><dt class="hdlist1">Obiekt HttpServletRequest</dt><dd><div class="ulist"><ul><li><p>Zawiera informacje z żądania od klienta</p><div class="ulist"><ul><li><p>Nagłówki HTTP</p></li><li><p>Zawartość formularza oraz parametry</p></li><li><p>Inne dane od klienta (ciastka, ścieżki, etc.)</p></li></ul></div></li></ul></div></dd><dt class="hdlist1">Obiekt HttpServletResponse</dt><dd><div class="ulist"><ul><li><p>Enkapsuluje dane przesyłane do klienta</p><div class="ulist"><ul><li><p>Nagłówki odpowiedzi HTTP (content type, cookies, etc.)</p></li><li><p>Response body (jako OutputStream)</p></li></ul></div></li></ul></div></dd></dl></div></section><section id="slide_servlets_architecture_3"><h2>Servlets Architecture (3)</h2><div class="dlist"><dl><dt class="hdlist1">HTTP GET używamy gdy</dt><dd><div class="ulist"><ul><li><p>Żądanie nie zmienia stanu serwera</p></li><li><p>Operujemy na niewielkiej ilości danych (max query string 64kb w IE)</p></li><li><p>Request (ścieżka) jest ‘bookmarkowalna’</p></li></ul></div></dd><dt class="hdlist1">HTTP POST używamy gdy</dt><dd><div class="ulist"><ul><li><p>Żądanie zmienia stan serwera, aplikacji (np. Zapisujemy dane w bazie danych)</p></li><li><p>Przesyłamy dużą ilość danych</p></li><li><p>Przesyłane dane niekoniecznie powinny być widoczne w URL</p></li></ul></div></dd></dl></div></section><section id="slide_servlets_api"><h2>Servlets API</h2><div class="ulist"><div class="title">Najważniejsze elementy API</div><ul><li><p>Pobiera zawartość parametrów formularza (zarówno dla GET jak i POST)<br></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code>HttpServletRequest.getParameter(String)</code></pre></div></div>
<div class="ulist"><ul><li><p>Parametry inicjalizacyjne servleta<br></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code>ServletConfig.getInitParameter()</code></pre></div></div>
<div class="ulist"><ul><li><p>Nagłówki HTTP<br></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code>HttpServletRequest.getHeader(String)</code></pre></div></div></section><section id="slide_servlets_api_2"><h2>Servlets API (2)</h2><div class="ulist"><div class="title">Najważniejsze elementy API</div><ul><li><p>Ustawienie HTTP response header / content type<br></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code>HttpServletResponse.setHeader(&lt;name&gt;, &lt;value&gt;)
HttpServletResponse.setContentType(String)</code></pre></div></div>
<div class="ulist"><ul><li><p>Pobranie strumienia (tekstowego / binarnego) do wysłania odpowiedzi<br></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code>HttpServletResponse.getWriter()
HttpServletResponse.getOutputStream()</code></pre></div></div>
<div class="ulist"><ul><li><p>Przekierowanie żądania HTTP na inny adres URL<br></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code>HttpServletResponse.sendRedirect()</code></pre></div></div></section><section id="slide_servlets_life_cycle"><h2>Servlets Life-Cycle</h2><div class="ulist"><ul><li><p>Kontener Webowy zarządza cyklem życia serwletów</p></li><li><p>Metody cyklu życia nie powinny być wywoływane z kodu aplikacji</p></li><li><p>Metody cyklu życia można jednak nadpisywać</p></li></ul></div>
<div class="imageblock" style=""><img src="http://www.developer.com/imagesvr_ce/1254/Cycle2.jpg" alt="Servlet lifecycle" width="500"></div></section><section id="slide_metoda_strong_init_strong"><h2>Metoda <strong>init()</strong></h2><div class="ulist"><ul><li><p>Metoda wywoływana przez kontener w momencie utworzenia instancji serwletu</p></li><li><p>Specyfikacja serwletów gwarantuje że inicjalizacja zostanie zakończona przed przetworzeniem pierwszego żądania</p></li><li><p>Nadpisanie metody <code>init()</code> zaleca się gdy:</p><div class="ulist"><ul><li><p>Należy utworzyć lub połączyć się z zasobami które są wymagane podczas przetwarzania żądania</p></li><li><p>Należy zainicjować stan serweltu (np. otworzyć połączenie do zewnętrznych zasobów)</p></li></ul></div></li></ul></div></section><section id="slide_metoda_strong_service_strong"><h2>Metoda <strong>service()</strong></h2><div class="ulist"><ul><li><p>Metoda wywoływana przez kontener webowy w momencie przetważania żądania użytkownika</p></li><li><p>Deleguje HTTP requests do metod <code>doGet(…)</code>, <code>doPost(…)</code>, etc. zależnie od metody HTTP (GET, POST, itd)</p><div class="ulist"><ul><li><p>Zwraca rezultat działania poprzez obiekt HTTP response</p></li></ul></div></li><li><p>Zasadniczo nie powinno być potrzeby nadpisywania tej metody</p></li></ul></div></section><section id="slide_metoda_strong_destroy_strong"><h2>Metoda <strong>destroy()</strong></h2><div class="ulist"><ul><li><p>Metoda wywoływana przez kontener w momencie usuwania instancji serwletu</p></li><li><p>Specyfikacja serwletów gwarantuje że wywołania wszystkich metod zostaną zakończone przez wywołaniem tej metody</p></li><li><p>Nadpisanie metody <code>destroy()</code> zaleca się gdy:</p><div class="ulist"><ul><li><p>Należy zamknąć dostęp do zasobów zainicjowanych (otwartych) w metodzie <code>init()</code></p></li><li><p>Należy zapisać stan serwletu (np. serializować)</p></li></ul></div></li></ul></div></section><section id="slide_parametry_hello_servlet"><h2>Parametry – Hello Servlet</h2><div class="ulist"><div class="title">Serwlet Hello World</div><ul><li><p>Formularz przesyłający dane<br></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code>&lt;form method="GET or POST" action="the servlet"&gt;
    &lt;input type="text" name="user_name"&gt;
&lt;/form&gt;</code></pre></div></div>
<div class="ulist"><ul><li><p>Serwlet odbierając dane<br></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code>String name = request.getParameter("user_name");</code></pre></div></div></section><section id="slide_hello_servlet_example"><h2>Hello Servlet – Example</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="html language-html"><span class="tag">&lt;html&gt;</span>
  <span class="tag">&lt;body&gt;</span>
   <span class="tag">&lt;form</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloServlet</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    Please enter your name: <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">user_name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;/form&gt;</span>
  <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre></div></div></section><section id="slide_hello_servlet_example_2"><h2>Hello Servlet – Example</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">void</span> doGet(HttpServletRequest request, HttpServletResponse response)
    <span class="directive">throws</span> ServletException, <span class="exception">IOException</span> {
         <span class="predefined-type">String</span> userName = request.getParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">user_name</span><span class="delimiter">&quot;</span></span>);

         response.setContentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html</span><span class="delimiter">&quot;</span></span>);
         ServetOutputStream out = response.getOutputStream();
         out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;html&gt;&lt;head&gt;</span><span class="delimiter">&quot;</span></span>);
         out.println(<span class="string"><span class="delimiter">&quot;</span><span class="char">\t</span><span class="content">&lt;title&gt;Hello Servlet&lt;/title&gt;</span><span class="delimiter">&quot;</span></span>);
         out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/head&gt;&lt;body&gt;</span><span class="delimiter">&quot;</span></span>);
         out.println(<span class="string"><span class="delimiter">&quot;</span><span class="char">\t</span><span class="content">&lt;h1&gt;Hello, </span><span class="delimiter">&quot;</span></span> + userName + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/h1&gt;</span><span class="delimiter">&quot;</span></span>);
         out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/body&gt;&lt;/html&gt;</span><span class="delimiter">&quot;</span></span>);
}</code></pre></div></div></section><section id="slide_filtry"><h2>Filtry</h2><div class="ulist"><ul><li><p>Kod które będzie wykonany przed Servletem (stroną JSP)</p><div class="ulist"><ul><li><p>W ramach pre-procesowania <code>ServletRequest</code> lub post-procesowania <code>ServletResponse</code></p></li></ul></div></li><li><p>Preprocess</p><div class="ulist"><ul><li><p>Uwierzytelnianie</p></li><li><p>Logowanie</p></li><li><p>Zmiana danych w requestcie</p></li></ul></div></li><li><p>Postprocess</p><div class="ulist"><ul><li><p>Szyfrowanie odpowiedzi</p></li><li><p>Kompresja odpowiedzi</p></li></ul></div></li></ul></div></section><section id="slide_filtry_przykady"><h2>Filtry - przykłady</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@WebFilter</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/*</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyFilter</span> <span class="directive">implements</span> <span class="predefined-type">Filter</span> {
    <span class="comment">// implements Filter's methods here...</span>
}</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@WebFilter</span>(servletNames = {<span class="string"><span class="delimiter">&quot;</span><span class="content">MyOwnServlet</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">UploadServlet</span><span class="delimiter">&quot;</span></span>})
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyFilter</span> <span class="directive">implements</span> <span class="predefined-type">Filter</span> {
    <span class="comment">// implements Filter's methods here...</span>
}</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@WebFilter</span>(
        urlPatterns = <span class="string"><span class="delimiter">&quot;</span><span class="content">/uploadFilter</span><span class="delimiter">&quot;</span></span>,
        initParams = <span class="annotation">@WebInitParam</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">fileTypes</span><span class="delimiter">&quot;</span></span>, value = <span class="string"><span class="delimiter">&quot;</span><span class="content">doc;xls;zip;txt;jpg;png;gif</span><span class="delimiter">&quot;</span></span>)
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">UploadFilter</span> <span class="directive">implements</span> <span class="predefined-type">Filter</span> {
    <span class="comment">// implements Filter's methods here...</span>
}</code></pre></div></div></section><section id="slide_event_listeners"><h2>Event Listeners</h2><div class="ulist"><ul><li><p>Zdarzenia wynikające z cyklu życia serwera WWW</p><div class="ulist"><ul><li><p>Mogą wynikać z pojedynczego requestu, sesji albo działania samej aplikacji</p></li></ul></div></li><li><p>Utworzenie kontekstu (aplikacji): <code>ServletContextListener</code> oraz jej atrybutów: <code>ServletContextAttributeListener</code></p></li><li><p>Sesja: utworzenie (<code>HttpSessionListener</code>) oraz modyfikacje atrybutów (<code>HttpSessionAttributeListener</code>)</p></li><li><p>Request: utworzenie (<code>ServletRequestListener</code>) oraz modyfikacje atrybutów (<code>ServletRequestAttributeListener</code>)</p></li></ul></div></section></section>
<section><section id="slide_modu_8_warstwa_web" data-background-image="images/background.jpg" data-background-size="cover"><h2>Moduł 8: Warstwa web</h2></section><section id="slide_wprowadzenie_do_spring_web"><h2>Wprowadzenie do Spring Web</h2><div class="ulist"><ul><li><p>Spring Web a Spring WebMVC</p></li><li><p>Komponenty Spring w aplikacji www</p></li><li><p>Budowa Spring WebMVC</p><div class="ulist"><ul><li><p>Pojęcie FrontControllera i zasada działania aplikacji Spring MVC</p></li><li><p>Kontrolery i widoki</p></li><li><p>Odpowiedzi inne niż HTML (REST services)</p></li><li><p>Testowanie aplikacji Spring WebMVC</p></li></ul></div></li></ul></div></section><section id="slide_spring_web"><h2>Spring Web</h2><div class="ulist"><ul><li><p>Umożliwia wykorzystanie komponentów Spring w kontekście aplikacji WWW</p></li><li><p>Nie wymaga korzystanie ze Spring WebMVC</p><div class="ulist"><ul><li><p>Współpracuje z dowolnym frameworkiem MVC opartym o Java Servlets</p></li></ul></div></li><li><p>Integracja nie wymaga dodatkowych plugin&#8217;ów po stronie frameworka</p><div class="ulist"><ul><li><p>Z punktu widzenia warstwy WWW kontekst Spring jest biblioteką wykorzystywaną w aplikacji</p></li><li><p><code>ApplicationContext</code> stanowi wejście do 'ekosystemu' Spring&#8217;a</p></li><li><p>Używając <code>ContextLoaderListener</code> możliwe jest użycie Springa (zarządzania komponentami) bez konieczności korzystania <code>DispatcherServlet</code> (Spring MVC)</p></li><li><p>Odczytany kontekst dostępny jest poprzez statyczne metody komponentu <code>WebApplicationContextUtils</code>.</p></li></ul></div></li></ul></div></section><section id="slide_konfiguracja_spring_web"><h2>Konfiguracja Spring Web</h2><div class="listingblock"><div class="content"><pre class="CodeRay nowrap"><code class="xml language-xml"><span class="tag">&lt;context-param&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tag">&lt;param-name&gt;</span>contextClass<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>org.springframework.web.context.support.AnnotationConfigWebApplicationContext<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span>

<span class="tag">&lt;context-param&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tag">&lt;param-name&gt;</span>contextConfigLocation<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>com.example.App<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span>

<span class="tag">&lt;listener&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="tag">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/listener-class&gt;</span>
<span class="tag">&lt;/listener&gt;</span></code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Implementacja klasy inicjalizującej kontekst (na podstawie konfiguracji <code>coontextConfigLocation</code>). Domyślnie konfiguracji XML</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Lokalizacja konfiguracji kontekstu Spring, domyślnie <code>/WEB-INF/applicationContext.xml</code></td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>Klasa związana z cyklem życia kontenera serwletów (<code>ServletContextListener</code>) - inicjalizująca kontekst w momencie startu serwera</td></tr></table></div></section><section id="slide_konfiguracja_spring_web_2"><h2>Konfiguracja Spring Web</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyWebAppInitializer</span> <span class="directive">implements</span> WebApplicationInitializer {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onStartup(ServletContext container) {
        <span class="comment">// Create the 'root' Spring application context</span>
        AnnotationConfigWebApplicationContext rootContext =
                <span class="keyword">new</span> AnnotationConfigWebApplicationContext();
        rootContext.register(AppConfiguration.class, SpringRequestHandler.class);

        <span class="comment">// Manage the lifecycle of the root application context</span>
        container.addListener(<span class="keyword">new</span> ContextLoaderListener(rootContext));

        ServletRegistration.Dynamic dispatcher =
                container.addServlet(<span class="string"><span class="delimiter">&quot;</span><span class="content">myRequestHandler</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> AppServlet());
        dispatcher.addMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>);
    }

}</code></pre></div></div></section><section id="slide_wykorzystanie_spring_web"><h2>Wykorzystanie Spring Web</h2><div class="listingblock"><div class="content"><pre class="CodeRay nowrap"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AppServlet</span> <span class="directive">extends</span> javax.servlet.http.HttpServlet {

    WebApplicationContext webApplicationContext;

    <span class="directive">public</span> <span class="type">void</span> init(ServletConfig config) <span class="directive">throws</span> ServletException {
        <span class="local-variable">super</span>.init(config);
        webApplicationContext = WebApplicationContextUtils
                .getRequiredWebApplicationContext(config.getServletContext());
    }

    <span class="directive">protected</span> <span class="type">void</span> doGet(HttpServletRequest req, HttpServletResponse resp) <span class="directive">throws</span> javax.servlet.ServletException, <span class="exception">IOException</span> {
        MyBean bean = webApplicationContext.getBean(MyBean.class);
        <span class="comment">//..</span>
    }
}</code></pre></div></div></section><section id="slide_wykorzystanie_spring_web_2"><h2>Wykorzystanie Spring Web</h2><div class="ulist"><div class="title">Wykorzystywanie <code>webApplicationContext.getBean(MyBean.class);</code> jest problematyczne, ponieważ:</div><ul><li><p>jest nienaturalne z punktu widzenia wstrzykiwania zależności</p></li><li><p>tworzymy sprzężenia pomiędzy frameworkiem i aplikacją webową, uniemożliwiając testowanie.</p></li></ul></div>
<div class="ulist"><div class="title">Spring dostarcza klasę <code>HttpRequestHandlerServlet</code> ułatwiającą taką konstrukcję</div><ul><li><p>Tworzymy komponent implemntujący <code>HttpRequestHandler</code> do którego delegujemy obsługę zapytania</p><div class="ulist"><ul><li><p>Komponent jest komponentem Springa, obsługuje wstrzykiwanie zależności</p></li></ul></div></li><li><p>Tworzymy Servlet rozszerzającą klasę Spring <code>HttpRequestHandlerServlet</code> która deleguje zapytanie do utworzonego przez nas komponentu</p></li></ul></div></section><section id="slide_wykorzystanie_spring_web_3"><h2>Wykorzystanie Spring Web</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Component</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">myComponentName</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SpringRequestHandler</span> <span class="directive">implements</span> HttpRequestHandler {

    <span class="annotation">@Autowired</span> MyBean bean;

    <span class="directive">public</span> <span class="type">void</span> handleRequest(HttpServletRequest req,
        HttpServletResponse resp) <span class="directive">throws</span> <span class="exception">Exception</span> {
      <span class="comment">//... servlet logic</span>
    }
}</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@WebServlet</span>(urlPatterns = <span class="string"><span class="delimiter">&quot;</span><span class="content">/spring</span><span class="delimiter">&quot;</span></span>, name = <span class="string"><span class="delimiter">&quot;</span><span class="content">myComponentName</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SpringAppServlet</span> <span class="directive">extends</span> HttpRequestHandlerServlet {
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Nazwa komponentu i serwletu musi być tożsama</td></tr></table></div></section><section id="slide_spring_webmvc"><h2>Spring WebMVC</h2><div class="imageblock" style=""><img src="images/front-controller.png" alt="Front controller" width="800"></div><div class="title">Implementacja wzorca <em>model-view-controller</em></div></section><section id="slide_dziaanie_dispatcher_servet"><h2>Działanie Dispatcher Servet</h2><div class="ulist"><ul><li><p>Zapytanie trafia do <code>DispatcherServlet</code></p></li><li><p>Spring MVC w oparciu o odpowiedni <code>HandlerMapper</code> wyszukuje kontroler do obsługi zapytania.</p></li><li><p>Kontroler obsługuje żądanie</p></li><li><p>Kontroler zwraca odpowiedź w określonym formacie</p></li><li><p>Na podstawie informacji zwróconych przez kontroler <code>DispatcherServlet</code> wybiera widok w oparciu o konfigurację <code>ViewResolver</code>.</p></li><li><p>Widok tworzy wynikową stronę HTML.</p></li></ul></div></section><section id="slide_web_xml"><h2>web.xml</h2><div class="ulist"><ul><li><p>Konfiguracja DispatcherServlet</p></li><li><p>Spring zarządza cyklem życia żądania – w pełni używamy Spring MVC</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;servlet&gt;</span>
  <span class="tag">&lt;servlet-name&gt;</span>appServlet<span class="tag">&lt;/servlet-name&gt;</span>
  <span class="tag">&lt;servlet-class&gt;</span>
    org.springframework.web.servlet.DispatcherServlet
  <span class="tag">&lt;/servlet-class&gt;</span>
  <span class="tag">&lt;load-on-startup&gt;</span>1<span class="tag">&lt;/load-on-startup&gt;</span>
<span class="tag">&lt;/servlet&gt;</span>

<span class="tag">&lt;servlet-mapping&gt;</span>
  <span class="tag">&lt;servlet-name&gt;</span>appServlet<span class="tag">&lt;/servlet-name&gt;</span>
  <span class="tag">&lt;url-pattern&gt;</span>/<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span></code></pre></div></div></section><section id="slide_servlet_context_xml"><h2>servlet-context.xml</h2><div class="ulist"><ul><li><p>Domyślna konfiguracja poprzez adnotacje</p></li><li><p><code>ViewResolver</code> odpowiada za skierowanie zapytania do odpowiedniego widoku</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;mvc:annotation-driven</span> <span class="tag">/&gt;</span>
<span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.todo</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span>
  <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">o.s.web.servlet.view.InternalResourceViewResolver</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prefix</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/WEB-INF/views/</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">suffix</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">.jsp</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre></div></div></section><section id="slide_spring_mvc_i_servlet_3_0"><h2>Spring MVC i Servlet 3.0</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">WebInitializer</span>
  <span class="directive">implements</span> WebApplicationInitializer {

  <span class="directive">public</span> <span class="type">void</span> onStartup(ServletContext container) {
          <span class="comment">//..</span>
  }

}</code></pre></div></div></section><section id="slide_spring_mvc_i_servlet_3_0_2"><h2>Spring MVC i Servlet 3.0</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">void</span> onStartup(ServletContext container) {
    <span class="comment">// Create the 'root' Spring application context</span>
    AnnotationConfigWebApplicationContext rootContext =
            <span class="keyword">new</span> AnnotationConfigWebApplicationContext();
    rootContext.getEnvironment().setActiveProfiles(<span class="string"><span class="delimiter">&quot;</span><span class="content">jpa</span><span class="delimiter">&quot;</span></span>);
    rootContext.register(AppConfiguration.class, DispatcherConfig.class);

    <span class="comment">// Manage the lifecycle of the root application context</span>
    container.addListener(<span class="keyword">new</span> ContextLoaderListener(rootContext));

    <span class="comment">// Register and map the dispatcher servlet</span>
    ServletRegistration.Dynamic dispatcher =
            container.addServlet(<span class="string"><span class="delimiter">&quot;</span><span class="content">dispatcher</span><span class="delimiter">&quot;</span></span>,
              <span class="keyword">new</span> DispatcherServlet(<span class="keyword">new</span> GenericWebApplicationContext()));
    dispatcher.setLoadOnStartup(<span class="integer">1</span>);
    dispatcher.addMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>);
}</code></pre></div></div></section><section id="slide_spring_mvc_i_servlet_3_0_3"><h2>Spring MVC i Servlet 3.0</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Configuration</span> <span class="annotation">@EnableWebMvc</span>
<span class="annotation">@ComponentScan</span>(basePackages = <span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.web</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">DispatcherConfig</span> <span class="directive">extends</span> WebMvcConfigurerAdapter {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> InternalResourceViewResolver getInternalResourceViewResolver() {
        InternalResourceViewResolver resolver = <span class="keyword">new</span> InternalResourceViewResolver();
        resolver.setPrefix(<span class="string"><span class="delimiter">&quot;</span><span class="content">/WEB-INF/views/</span><span class="delimiter">&quot;</span></span>);
        resolver.setSuffix(<span class="string"><span class="delimiter">&quot;</span><span class="content">.jsp</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">return</span> resolver;
    }
}</code></pre></div></div></section><section id="slide_kontroler"><h2>Kontroler</h2><div class="ulist"><ul><li><p>Rola programisty Spring MVC ogranicza się do implementacji kontrolera oraz utworzenia widoku.</p></li><li><p>Dobry kontroler nie powinien zawierać logiki biznesowej</p><div class="ulist"><ul><li><p>po wstępnym przygotowaniu danych powinien wywołać komponenty z warstwy logiki biznesowej,</p></li><li><p>po zakończeniu przetwarzanie – przekazać generacje strony do widoków.</p></li></ul></div></li></ul></div></section><section id="slide_kontroler_2"><h2>Kontroler</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Controller</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HomeController</span> {

        <span class="comment">//..</span>

        <span class="annotation">@RequestMapping</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>, method = RequestMethod.GET)
        <span class="directive">public</span> <span class="predefined-type">String</span> home(<span class="predefined-type">Locale</span> locale, Model model) {
                <span class="comment">//..</span>
                model.addAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">serverTime</span><span class="delimiter">&quot;</span></span>, formattedDate );
                <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">home</span><span class="delimiter">&quot;</span></span>;
        }

}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Począwszy od Spring 2.5 możemy budować kontrolery wyłącznie z użyciem adnotacji</td></tr></table></div></section><section id="slide_kontroler_3"><h2>Kontroler</h2><div class="ulist"><ul><li><p>Adnotacją <code>@Controller</code> jest uszczegółowieniem adnotacji <code>@Component</code> – dla Spring MVC</p></li><li><p>Za pomocą <code>@RequestMapping</code> odbywa się mapowanie kontrolera na metodą HTTP oraz URL</p></li><li><p>Poprzez <code>@RequestParam</code> definiujemy parametry przekazane w żądaniu</p></li><li><p>Kontroler może zwrócić obiekty typu:</p><div class="ulist"><ul><li><p>String (nazwa widoku)</p></li><li><p>Obiekt typu Model (nazwa widoku jest wtedy zgodna z nazwą metody kontroler)</p></li><li><p>ModelAndView</p></li></ul></div></li></ul></div></section><section id="slide_widok"><h2>Widok</h2><div class="ulist"><ul><li><p>W najprostszym przypadku – jest to plik JSP</p></li><li><p>Atrybuty modelu dodawane są do kontekstu strony (servlet.PageContext)</p></li><li><p>Obsługa znaczników JSP, JSTL i innych</p></li><li><p>Dodatkowe znaczniki Spring MVC przeznaczone do obsługi formularzy (o czym za chwilę)</p></li></ul></div></section><section id="slide_widok_2"><h2>Widok (2)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="html language-html"><span class="error">&lt;</span>%@ page pageEncoding=&quot;UTF-8&quot; %<span class="error">&gt;</span>
<span class="tag">&lt;html&gt;</span>
<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;title&gt;</span>Home<span class="tag">&lt;/title&gt;</span>
<span class="tag">&lt;/head&gt;</span>
<span class="tag">&lt;body&gt;</span>
  <span class="tag">&lt;h1&gt;</span>
        Hello world!
  <span class="tag">&lt;/h1&gt;</span>
  <span class="tag">&lt;p&gt;</span>The time on the server is ${serverTime}.<span class="tag">&lt;/p&gt;</span>
<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre></div></div></section><section id="slide_nie_tylko_html"><h2>Nie tylko HTML</h2><div class="ulist"><ul><li><p>Spring 3.1 wprowadził możliwość ‘negocjacji’ zawartości strony (ang. <em>content negotiations</em>)</p></li><li><p>Klient wskazuje typ zawartości poprzez URL (rozszerzenie) lub nagłówki (<code>Accept: application/json</code>)</p></li><li><p>Kontener deleguje zapytania do odpowiednich widoków</p></li></ul></div></section><section id="slide_nie_tylko_html_2"><h2>Nie tylko HTML (2)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@RequestMapping</span>(value=<span class="string"><span class="delimiter">&quot;</span><span class="content">/tasks</span><span class="delimiter">&quot;</span></span>, method=RequestMethod.GET,
        produces=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@ResponseBody</span>
<span class="directive">public</span> <span class="predefined-type">List</span>&lt;Task&gt; restTasks(Model model) {
        <span class="predefined-type">List</span>&lt;Task&gt; tasks = service.getTasks();
        <span class="keyword">return</span> tasks;
}

<span class="annotation">@RequestMapping</span>(value=<span class="string"><span class="delimiter">&quot;</span><span class="content">/tasks</span><span class="delimiter">&quot;</span></span>, method=RequestMethod.GET)
<span class="directive">public</span> <span class="predefined-type">String</span> tasks(Model model) {
        <span class="predefined-type">List</span>&lt;Task&gt; tasks = service.getTasks();
        model.addAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">tasks</span><span class="delimiter">&quot;</span></span>, tasks);
        model.addAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">task</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> Task());
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">tasks</span><span class="delimiter">&quot;</span></span>;
}</code></pre></div></div></section><section id="slide_nie_tylko_html_4"><h2>Nie tylko HTML (4)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebMvc</span>
<span class="annotation">@ComponentScan</span>(basePackages = <span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.web</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">DispatcherConfig</span> <span class="directive">extends</span> WebMvcConfigurerAdapter {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> configureContentNegotiation(<span class="directive">final</span> ContentNegotiationConfigurer configurer) {
        configurer
                .favorPathExtension(<span class="predefined-constant">true</span>)
                .favorParameter(<span class="predefined-constant">false</span>).useJaf(<span class="predefined-constant">false</span>)
                .ignoreAcceptHeader(<span class="predefined-constant">false</span>)
                .defaultContentType(MediaType.APPLICATION_JSON)
                .mediaType(<span class="string"><span class="delimiter">&quot;</span><span class="content">xml</span><span class="delimiter">&quot;</span></span>, MediaType.APPLICATION_XML)
                .mediaType(<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span>, MediaType.APPLICATION_JSON);
    }

}</code></pre></div></div></section><section id="slide_nie_tylko_html_3"><h2>Nie tylko HTML (3)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jackson-core<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.8.5<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jackson-databind<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.8.5<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.8.5<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre></div></div></section><section id="slide_obsuga_wyjtkw"><h2>Obsługa wyjątków</h2><div class="ulist"><ul><li><p>Kontener serwletów umożliwia obsługę sytuacji wyjątkowych</p></li><li><p>Odpowiedni wpis w web.xml pozwala wyświetlić własną stronę błędu</p></li><li><p>Atrybuty dotyczące błędu dołączone są do kontekstu żądania przez Servlet API</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;error-page&gt;</span>
        <span class="tag">&lt;error-code&gt;</span>404<span class="tag">&lt;/error-code&gt;</span>
        <span class="tag">&lt;location&gt;</span>/WEB-INF/views/errors/404.jsp<span class="tag">&lt;/location&gt;</span>
<span class="tag">&lt;/error-page&gt;</span>

<span class="tag">&lt;error-page&gt;</span>
        <span class="tag">&lt;exception-type&gt;</span>java.lang.Exception<span class="tag">&lt;/exception-type&gt;</span>
        <span class="tag">&lt;location&gt;</span>/WEB-INF/views/errors/500.jsp<span class="tag">&lt;/location&gt;</span>
<span class="tag">&lt;/error-page&gt;</span></code></pre></div></div></section><section id="slide_obsuga_wyjtkw_2"><h2>Obsługa wyjątków (2)</h2><div class="ulist"><ul><li><p>Strona błędu wyświetlana jest bezpośrednio – z pominięciem filtrów</p></li><li><p>Brak możliwości dodania dynamicznych danych – kontener wyświetla stronę taką jaka jest</p><div class="ulist"><ul><li><p>Brak dostępu do warstwy logiki aplikacji</p></li><li><p>Pominięcie interceptorów zdefiniowanych w aplikacji (logowanie, auditing)</p></li></ul></div></li></ul></div></section><section id="slide_obsuga_wyjtkw_globalnie"><h2>Obsługa wyjątków - globalnie</h2><div class="ulist"><ul><li><p>Spring umożliwia dodanie własnego mechanizmu obsługującego wyjątki</p></li><li><p>Ma on wyższy priorytet niż obsługa wyjątków zapisana w web.xml</p></li><li><p>Wyjątek jest dostępny w widoku poprzez atrybut <code>${exception}</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;bean</span>
  <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">o.s.web.servlet.handler.SimpleMappingExceptionResolver</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exceptionMappings</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;props&gt;</span>
        <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Exception</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>error_generic<span class="tag">&lt;/prop&gt;</span>
      <span class="tag">&lt;/props&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre></div></div></section><section id="slide_obsuga_wyjtkw_lokalnie"><h2>Obsługa wyjątków - lokalnie</h2><div class="ulist"><ul><li><p>Od wersji Spring 3 możliwe jest zdefiniowanie własnej obsługi wyjątków na poziomie kontrolera</p></li><li><p>Obsługa dotyczy tylko i wyłącznie metod zdefiniowanych w kontrolerze</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@ExceptionHandler</span>(<span class="exception">BindException</span>.class)
<span class="directive">public</span> ModelAndView validationErrorHandler(<span class="exception">Exception</span> ex) {
        ModelAndView mv = <span class="keyword">new</span> ModelAndView();
        mv.setViewName(<span class="string"><span class="delimiter">&quot;</span><span class="content">error_validation</span><span class="delimiter">&quot;</span></span>);
        mv.addObject(<span class="string"><span class="delimiter">&quot;</span><span class="content">exception</span><span class="delimiter">&quot;</span></span>, ex);
        <span class="keyword">return</span> mv;
}</code></pre></div></div></section></section>
<section><section id="slide_testowanie_aplikacji_webowych" data-background-image="images/background.jpg" data-background-size="cover"><h2>Testowanie aplikacji webowych</h2></section><section id="slide_testy_jednostkowe_2"><h2>Testy jednostkowe</h2><div class="ulist"><ul><li><p>Spring umożliwia testy jednostkowe kontrolerów (<em>POJOs</em>)</p><div class="ulist"><ul><li><p>dostarcza namiastek (ang. Mock Objects) ułatwiających tworzenie testów na pograniczu aplikacji i np. serwera aplikacji</p></li><li><p><code>MockHttpServletRequest</code>, <code>MockHttpServletResponse</code>, <code>MockHttpSession</code> umożliwiają testowanie kontrolerów bez konieczności uruchamiania kontenera</p></li><li><p><code>ModelAndViewAssert</code> upraszcza scenariusze testowe</p></li></ul></div></li><li><p>Testujemy pojedyncze kontrolery, w izolacji, bez konieczności uruchamiania kontekstu</p><div class="ulist"><ul><li><p>Weryfikujemy dane przekazywanie do obiektów <code>ModelAndView</code></p></li><li><p>To podejście nie nadaje się do testowanie kontrolerów REST</p></li></ul></div></li></ul></div></section><section id="slide_testy_httprequesthandler"><h2>Testy HttpRequestHandler</h2><div class="paragraph"><p>Jeżeli nie korzystamy ze Spring WebMVC (z <code>DispatcherServet</code>) to wciąż możemy testować komponenty obsługujące żądania HTTP</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java">SpringRequestHandler handler = <span class="keyword">new</span> SpringRequestHandler(); <i class="conum" data-value="1"></i><b>(1)</b>

MockHttpServletRequest request = <span class="keyword">new</span> MockHttpServletRequest();
request.addParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">word</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">dom</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="2"></i><b>(2)</b>
MockHttpServletResponse response = <span class="keyword">new</span> MockHttpServletResponse();
handler.handleRequest(request, response); <i class="conum" data-value="3"></i><b>(3)</b>

assertThat(request.getAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">translations</span><span class="delimiter">&quot;</span></span>), notNullValue()); <i class="conum" data-value="4"></i><b>(4)</b></code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Inicjalizacja komponenty robiona jest ręcznie</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Klasa <em>mock</em> może być dowolnie spreparowana</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>Wykonujemy żądanie</td></tr><tr><td><i class="conum" data-value="4"></i><b>4</b></td><td>Weryfikacja czy operacje w komponencie przebiegły zgodnie z oczekiwaniami</td></tr></table></div></section><section id="slide_testy_kontrolera"><h2>Testy kontrolera</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.test.web.ModelAndViewAssert</span>.*;

<span class="directive">public</span> <span class="type">class</span> <span class="class">WordsControllerTest</span> {
    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> should_return_words_view() {
        <span class="comment">//... pominięto przygotowanie kontrolera</span>
        ModelAndView mav = controller.htmlOutputSearch(<span class="string"><span class="delimiter">&quot;</span><span class="content">dom</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="1"></i><b>(1)</b>

        assertViewName(mav, <span class="string"><span class="delimiter">&quot;</span><span class="content">words</span><span class="delimiter">&quot;</span></span>);
        assertModelAttributeAvailable(mav, <span class="string"><span class="delimiter">&quot;</span><span class="content">translations</span><span class="delimiter">&quot;</span></span>);
        assertModelAttributeValue(mav, <span class="string"><span class="delimiter">&quot;</span><span class="content">translations</span><span class="delimiter">&quot;</span></span>, translations);
    }
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Jeżeli kontroler wymaga przekazania <code>HttpServletRequest</code> to używamy instancji klasy <code>MocktHttpServletRequest</code> (upload plików)</td></tr></table></div></section><section id="slide_testy_kontrolera_2"><h2>Testy kontrolera (2)</h2><div class="paragraph"><p>Do utworzenia kontrolera możemy użyć <em>Mockito</em> - jest to działanie niezależne od samych asercji.</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="comment">//given</span>
<span class="directive">final</span> <span class="predefined-type">List</span>&lt;DictionaryWord&gt; translations = <span class="predefined-type">Arrays</span>
        .asList(DictionaryWord
            .fromPolishWord(<span class="string"><span class="delimiter">&quot;</span><span class="content">dom</span><span class="delimiter">&quot;</span></span>)
            .withEnglishWord(<span class="string"><span class="delimiter">&quot;</span><span class="content">house</span><span class="delimiter">&quot;</span></span>).build()); <i class="conum" data-value="1"></i><b>(1)</b>

WordsController controller = <span class="keyword">new</span> WordsController(); <i class="conum" data-value="2"></i><b>(2)</b>
controller.service = mock(TranslationService.class); <i class="conum" data-value="3"></i><b>(3)</b>
when(controller.service.getTranslationsForWord(<span class="string"><span class="delimiter">&quot;</span><span class="content">dom</span><span class="delimiter">&quot;</span></span>))
        .thenReturn(translations);</code></pre></div></div></section><section id="slide_testowanie_integracyjne"><h2>Testowanie integracyjne</h2><div class="ulist"><ul><li><p>Dotychczasowe testy nie wykorzystywały kontenera do działania</p><div class="ulist"><ul><li><p>kontenera serwletów (Servlet API, działanie <em>http</em>)</p></li><li><p>kontenera Spring (mapowania zapytań)</p></li></ul></div></li><li><p>Nasze testy nie testowały widoków, nie weryfikowały kodu JSP</p></li><li><p>Można jest nazwać testami <em>Out-of-Container</em> (w przeciwności do testów <em>End-to-End Integrations</em>)</p></li><li><p>Wykorzystując klasę <code>MockMvcBuilders</code> możemy delegować inicjalizację kontrolerów do klas frameworka - wciąż nie uruchamiając kompletnego kontekstu</p></li></ul></div></section><section id="slide_mockmvcbuilders"><h2>MockMvcBuilders</h2><div class="ulist"><div class="title">Klasa <code>MockMvcBuilders</code> udostępnia dwa rodzaje <em>builderów</em></div><ul><li><p><code>StandaloneMockMvcBuilder</code> umożliwiające zainicjowanie jednego lub więcej kontrolera</p><div class="ulist"><ul><li><p>Spring inicjuje minimalną konfigurację konieczną do uruchomienia <code>DispatcherServlet</code> - przede wszystkim mapowania określone w <code>@RequestMapping</code></p></li></ul></div></li><li><p><code>DefaultMockMvcBuilder</code> uruchamia kompletny kontener <code>WebApplicationContext</code> - wraz ze wszystkimi zależnościami</p><div class="ulist"><ul><li><p>Nie ma potrzeby samodzielnej konfiguracji kontrolerów</p></li><li><p>Inicjowane są wszystkie komponenty (poprzez <code>@ComponentScan</code>) i ich zależności</p></li></ul></div></li></ul></div></section><section id="slide_testy_handlerw"><h2>Testy handlerów</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> test_jsp_output() <span class="directive">throws</span> <span class="exception">Exception</span> {
    InternalResourceViewResolver viewResolver =
        <span class="keyword">new</span> InternalResourceViewResolver();
    viewResolver.setPrefix(<span class="string"><span class="delimiter">&quot;</span><span class="content">/WEB-INF/views/</span><span class="delimiter">&quot;</span></span>);
    viewResolver.setSuffix(<span class="string"><span class="delimiter">&quot;</span><span class="content">.jsp</span><span class="delimiter">&quot;</span></span>);

    standaloneSetup(controller).setViewResolvers(viewResolver).build()
            .perform(get(<span class="string"><span class="delimiter">&quot;</span><span class="content">/search/dom.html</span><span class="delimiter">&quot;</span></span>))
            .andExpect(status().isOk())
            .andExpect(model().size(<span class="integer">1</span>))
            .andExpect(model().attributeExists(<span class="string"><span class="delimiter">&quot;</span><span class="content">translations</span><span class="delimiter">&quot;</span></span>))
            .andExpect(forwardedUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">/WEB-INF/views/words.jsp</span><span class="delimiter">&quot;</span></span>));
}</code></pre></div></div></section><section id="slide_testy_handlerw_2"><h2>Testy handlerów</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> test_json_output() <span class="directive">throws</span> <span class="exception">Exception</span> {
    standaloneSetup(controller).build()
            .perform(get(<span class="string"><span class="delimiter">&quot;</span><span class="content">/search/dom</span><span class="delimiter">&quot;</span></span>)
                .accept(MediaType.APPLICATION_JSON_VALUE))
            .andExpect(status().isOk())
            .andExpect(content().contentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>))
            .andExpect(jsonPath(<span class="string"><span class="delimiter">&quot;</span><span class="content">$[0].polishWord</span><span class="delimiter">&quot;</span></span>).value(<span class="string"><span class="delimiter">&quot;</span><span class="content">dom</span><span class="delimiter">&quot;</span></span>))
            .andExpect(jsonPath(<span class="string"><span class="delimiter">&quot;</span><span class="content">$[0].englishWord</span><span class="delimiter">&quot;</span></span>).value(<span class="string"><span class="delimiter">&quot;</span><span class="content">house</span><span class="delimiter">&quot;</span></span>));
}</code></pre></div></div></section><section id="slide_testy_handlerw_3"><h2>Testy handlerów</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@RunWith</span>(SpringJUnit4ClassRunner.class)
<span class="annotation">@ContextConfiguration</span>(classes = {...})
<span class="annotation">@WebAppConfiguration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WordsControllerIntegrationTest</span> {

    <span class="annotation">@Autowired</span> WebApplicationContext ctx;

    <span class="annotation">@Test</span> <span class="directive">public</span> <span class="type">void</span> test() <span class="directive">throws</span> <span class="exception">Exception</span> {
        webAppContextSetup(ctx).build()
            .perform(get(<span class="string"><span class="delimiter">&quot;</span><span class="content">/search/dom.html</span><span class="delimiter">&quot;</span></span>))
                .andExpect(status().isOk())
                .andExpect(model().size(<span class="integer">1</span>))
                .andExpect(model().attributeExists(<span class="string"><span class="delimiter">&quot;</span><span class="content">translations</span><span class="delimiter">&quot;</span></span>))
                .andExpect(forwardedUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">/WEB-INF/views/words.jsp</span><span class="delimiter">&quot;</span></span>));
    }
}</code></pre></div></div></section><section id="slide_testy_integracyjne_2"><h2>Testy integracyjne</h2><div class="ulist"><ul><li><p>Spring <code>MockMvc</code> można wykorzystać do testowania kontrolerów oraz widoków nie zależących od <em>forwardu żądania</em></p><div class="ulist"><ul><li><p>Nie ma możliwości testowania stron JSP</p></li><li><p>Można testować inne technologie renderujące (Freemaker, Velocity) lub inne formaty danych (JSON, XML - zależnych od adnotacji <code>@ResponseBody</code>)</p></li></ul></div></li><li><p>Spring MVC Test udostępnia kilka opcji od klasycznych testów jednostkowych do pełnych testów integracyjnych</p><div class="ulist"><ul><li><p>Nie są to typowe testy jednostkowe, ale pozwalają na znaczną izolacje poszczególnych warstw</p></li><li><p>Np. warstwy web (tylko <code>DispatcherServlet</code>) z wszystkimi zależnościami (serwisami) w postaci namiastek (obiektów <em>mock</em>)</p></li></ul></div></li></ul></div></section><section id="slide_testy_end_to_end"><h2>Testy end-to-end</h2><div class="ulist"><ul><li><p>Testy <em>End-to-End</em> - weryfikują aplikację z punktu widzenia użytkownika</p><div class="ulist"><ul><li><p>W założeniu test uruchamia docelowe środowisko, wdraża aplikację i następnie przeprowadza testy</p></li><li><p>Typowe frameworki to <code>WebDriver</code>, <code>Geb</code>, <code>HtmlUnit</code></p></li></ul></div></li><li><p>Spring oferuje wsparcie dla takiego testowania aplikacji wykorzystując Spring Boot</p></li><li><p>Należy pamiętać że do testów end-to-end trzeba podchodzić z ostrożnością</p><div class="ulist"><ul><li><p>'Zdrowy' wskaźnik testów w projekcie (piramida testów)</p></li><li><p>Stosunek pokrycia testami do kruchości</p></li><li><p>Koszt utrzymania testu do kosztu jego stworzenia</p></li></ul></div></li></ul></div></section><section id="slide_testy_end_to_end_2"><h2>Testy end-to-end</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@RunWith</span>(SpringJUnit4ClassRunner.class)
<span class="annotation">@SpringApplicationConfiguration</span>(classes =
    {WordControllerApplicationTest.MockConfiguration.class,
     DispatcherConfig.class}) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@WebIntegrationTest</span>(randomPort = <span class="predefined-constant">true</span>)
<span class="annotation">@EnableAutoConfiguration</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WordControllerApplicationTest</span> {
        <span class="comment">//....</span>
    <span class="annotation">@SpringBootApplication</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="annotation">@Import</span>(AppConfiguration.class)
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">MockConfiguration</span> {
    }
}</code></pre></div></div></section><section id="slide_testy_end_to_end_3"><h2>Testy end-to-end</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="comment">//...</span>
<span class="annotation">@WebIntegrationTest</span>(randomPort = <span class="predefined-constant">true</span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WordControllerApplicationTest</span> {

    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${local.server.port}</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">private</span> <span class="type">int</span> port;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> test_application() <span class="directive">throws</span> <span class="exception">IOException</span> {
        <span class="comment">//... test body</span>
    }

}</code></pre></div></div></section><section id="slide_testy_end_to_end_4"><h2>Testy end-to-end</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> test_application() <span class="directive">throws</span> <span class="exception">IOException</span> {
    WebDriver driver = <span class="keyword">new</span> HtmlUnitDriver();
    driver.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:</span><span class="delimiter">&quot;</span></span> + <span class="local-variable">this</span>.port + <span class="string"><span class="delimiter">&quot;</span><span class="content">/search/dom.html</span><span class="delimiter">&quot;</span></span>);
    assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Home</span><span class="delimiter">&quot;</span></span>, driver.getTitle());

    <span class="predefined-type">List</span>&lt;WebElement&gt; li = driver.findElements(By.tagName(<span class="string"><span class="delimiter">&quot;</span><span class="content">li</span><span class="delimiter">&quot;</span></span>));
    assertEquals(<span class="integer">24</span>, li.size());
    assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="content">dom home</span><span class="delimiter">&quot;</span></span>, li.get(<span class="integer">0</span>).getText());
    assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="content">home</span><span class="delimiter">&quot;</span></span>,
      li.get(<span class="integer">0</span>).findElement(By.tagName(<span class="string"><span class="delimiter">&quot;</span><span class="content">blockquote</span><span class="delimiter">&quot;</span></span>)).getText());
}</code></pre></div></div></section></section>
<section><section id="slide_rest_i_javaee" data-background-image="images/background.jpg" data-background-size="cover"><h2>REST i JavaEE</h2></section><section id="slide_konfiguracja_serwera_aplikacji"><h2>Konfiguracja serwera aplikacji </h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">javax.ws.rs.ApplicationPath</span>;
<span class="keyword">import</span> <span class="include">javax.ws.rs.core.Application</span>;

<span class="annotation">@ApplicationPath</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/api</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyRestApplication</span> <span class="directive">extends</span> Application { <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Jest to wystarczające dla serwerów JavaEE aby rozpocząć skanowanie ścieżek oraz inicjalizację komponentów JAX-RS</td></tr></table></div></section><section id="slide_konfiguracja_serwera_aplikacji_2"><h2>Konfiguracja serwera aplikacji (2)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@ApplicationPath</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ProfanityCheckApplication</span> <span class="directive">extends</span> Application {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Class</span>&lt;?&gt;&gt; getClasses() {        <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Class</span>&lt;?&gt;&gt; s = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;&gt;();
        s.add(EndpointLoggingListener.class);
        s.add(ProfanityResource.class);
        <span class="keyword">return</span> s;
    }

}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Użycie Jersey w środowisku serwetów (Tomcat) wymaga zdefiniowania klas <em>explicite</em></td></tr></table></div></section><section id="slide_konfiguracja_serwera_aplikacji_3"><h2>Konfiguracja serwera aplikacji (3)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@ApplicationPath</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ProfanityCheckApplication</span> <span class="directive">extends</span> ResourceConfig { <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="directive">public</span> ProfanityCheckApplication() {
        setApplicationName(<span class="string"><span class="delimiter">&quot;</span><span class="content">profanity-check-application</span><span class="delimiter">&quot;</span></span>);
        register(<span class="keyword">new</span> Binder());
        register(<span class="keyword">new</span> EndpointLoggingListener());
        packages(<span class="string"><span class="delimiter">&quot;</span><span class="content">ws.rest</span><span class="delimiter">&quot;</span></span>);
    }

}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Klasa <code>ResourceConfig</code> jest specyficzna dla implementacji JAX-RS <em>Jersey</em></td></tr></table></div></section><section id="slide_konfiguracja_serwera_aplikacji_4"><h2>Konfiguracja serwera aplikacji (4)</h2><table class="tableblock frame-all grid-all" style=""><caption class="title">Table 1. Przykładowe możliwości konfiguracyjne JAX-RS</caption><colgroup><col><col><col><col></colgroup><thead><tr><th class="tableblock halign-left valign-top">Warunek</th><th class="tableblock halign-left valign-top">Akcja</th><th class="tableblock halign-left valign-top">Nazwa serwletu</th><th class="tableblock halign-left valign-top">web.xml</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Brak klasy implementującej rozszerzającej klasę <code>Application</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>Jersey</em> automatycznie dodaje serwlet</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.ws.rs.core.Application</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Konieczne mapowanie w pliku <em>web.xml</em></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Klasa <code>Application</code> zarządzana przez serwlet</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Nie ma potrzeby</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Zdefiniowane przez serwlet</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Nie ma potrzeby</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Klasa <code>Application</code> <strong>nie</strong> zarządzana przez serwlet</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Tworzy serwlet</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Pełna nazwa podklasy <code>Application</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Konieczne przy braku adnotacji <code>@ApplicationPath</code></p></td></tr></tbody></table></section><section id="slide_konfiguracja_usugi"><h2>Konfiguracja usługi </h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">javax.ejb.Stateless</span>;
<span class="keyword">import</span> <span class="include">javax.ws.rs.GET</span>;
<span class="keyword">import</span> <span class="include">javax.ws.rs.Path</span>;
<span class="keyword">import</span> <span class="include">javax.ws.rs.PathParam</span>;
<span class="keyword">import</span> <span class="include">javax.ws.rs.Produces</span>;
<span class="keyword">import</span> <span class="include">javax.ws.rs.core.MediaType</span>;
<span class="keyword">import</span> <span class="include">java.time.LocalDate</span>;

<span class="annotation">@Stateless</span>  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Service</span> {

    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/{name}</span><span class="delimiter">&quot;</span></span>)    <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="annotation">@GET</span>    <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)   <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="directive">public</span> HelloMessage hello(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name) { <i class="conum" data-value="6"></i><b>(6)</b>
        <span class="keyword">return</span> <span class="keyword">new</span> HelloMessage(generateId(), <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello, </span><span class="delimiter">&quot;</span></span> + name, LocalDate.now());
    }
}</code></pre></div></div></section><section id="slide_konfiguracja_usugi_2"><h2>Konfiguracja usługi (2)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Context</span>
UriInfo ctx; <i class="conum" data-value="1"></i><b>(1)</b>

<span class="annotation">@POST</span>
<span class="annotation">@Consumes</span>({MediaType.APPLICATION_JSON, MediaType.APPLICATION_XML}) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="directive">public</span> Response createNewMessage(<span class="annotation">@Valid</span> HelloMessage message) {  <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="comment">//operacje z wykorzystaniem otrzymanej wiadomości</span>
    <span class="predefined-type">Integer</span> id = service.process(message);

    <span class="keyword">return</span> Response.created(
            ctx.getBaseUriBuilder()
                    .segment(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>)
                    .segment(<span class="string"><span class="delimiter">&quot;</span><span class="content">{id}</span><span class="delimiter">&quot;</span></span>).build(id)) <i class="conum" data-value="4"></i><b>(4)</b>
            .build();
}</code></pre></div></div></section><section id="slide_konfiguracja_zasobu"><h2>Konfiguracja zasobu </h2><div class="ulist"><ul><li><p>JAX-RS dobrze rodzi sobie z konwersją typów prostych</p></li><li><p>Niektóre typy danych (jak <code>LocalDate</code>, <code>LocalDateTime</code>) nie poddają się automatycznej konwersji i wymagają niezależnej deklaracji serializatora / deserializatora bądź implementacja własnego konwertera</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">HelloMessage</span> {
    <span class="directive">private</span> <span class="predefined-type">Integer</span> id;
    <span class="directive">private</span> <span class="predefined-type">String</span> message;
    <span class="directive">private</span> LocalDate whence; <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Błąd</td></tr></table></div></section><section id="slide_konfiguracja_zasobu_2"><h2>Konfiguracja zasobu (2)</h2><div class="listingblock"><div class="title">Konwersja automatyczna (<em>Jackson</em>)</div><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>com.fasterxml.jackson.datatype<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jackson-datatype-jsr310<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">HelloMessage</span> {
    <span class="directive">private</span> <span class="predefined-type">Integer</span> id;

    <span class="annotation">@NotNull</span> <span class="annotation">@Size</span>(min = <span class="integer">5</span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> message;

    <span class="annotation">@JsonSerialize</span>(using = LocalDateSerializer.class)   <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@JsonDeserialize</span>(using = LocalDateDeserializer.class)   <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">private</span> LocalDate whence;
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Implementacja dostarczona przez bibiotekę Jackson</td></tr></table></div></section><section id="slide_konfiguracja_zasobu_3"><h2>Konfiguracja zasobu (3)</h2><div class="listingblock"><div class="title">Własna implementacja serializatora Jackson</div><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LocalDateTimeSerializer</span> <span class="directive">extends</span> JsonSerializer&lt;LocalDateTime&gt; {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> serialize(LocalDateTime dateTime, JsonGenerator jg,
            SerializerProvider sp) <span class="directive">throws</span> <span class="exception">IOException</span>, JsonProcessingException {
        Instant instant = dateTime.toInstant(ZoneOffset.UTC);
        jg.writeString(DateTimeFormatter.ISO_INSTANT.format(instant)); <i class="conum" data-value="1"></i><b>(1)</b>
    }
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Konwersja z obiektu na <code>String</code></td></tr></table></div></section><section id="slide_konfiguracja_zasobu_4"><h2>Konfiguracja zasobu (4)</h2><div class="listingblock"><div class="title">Własna implementacja deserializatora</div><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LocalDateTimeDeserializer</span> <span class="directive">extends</span> JsonDeserializer&lt;LocalDateTime&gt; {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> LocalDateTime deserialize(JsonParser jp,
            DeserializationContext dc) <span class="directive">throws</span> <span class="exception">IOException</span>, JsonProcessingException {

            ObjectCodec oc = jsonParser.getCodec(); <i class="conum" data-value="1"></i><b>(1)</b>
            JsonNode node = oc.readTree(jsonParser);  <i class="conum" data-value="2"></i><b>(2)</b>

            <span class="keyword">return</span> <span class="keyword">new</span> DictionaryWord(node.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">englishWord</span><span class="delimiter">&quot;</span></span>).textValue(),
                    node.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">polishWord</span><span class="delimiter">&quot;</span></span>).textValue());
    }
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td><code>JsonParser</code> to parser strumieniowy (jak StAX). Przemieszcza się węzeł po węźle.</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Przejście z parsera na reader</td></tr></table></div></section><section id="slide_konfiguracja_zasobu_5"><h2>Konfiguracja zasobu (5)</h2><div class="listingblock"><div class="title">Konfiguracja w obrębie obiektu</div><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">HelloMessage</span> { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">private</span> <span class="predefined-type">Integer</span> id;

    <span class="annotation">@NotNull</span> <span class="annotation">@Size</span>(min = <span class="integer">5</span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> message;

    <span class="annotation">@JsonSerialize</span>(using = LocalDateSerializer.class)   <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@JsonDeserialize</span>(using = LocalDateDeserializer.class)   <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">private</span> LocalDate whence;
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Tylko i wyłączenie wtedy gdy jesteśmy właścicielem obiektu - możemy go modyfikować</td></tr></table></div></section><section id="slide_konfiguracja_zasobu_6"><h2>Konfiguracja zasobu (6)</h2><div class="listingblock"><div class="title">Konfiguracja mappera</div><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Provider</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@Consumes</span>(MediaType.APPLICATION_JSON) <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ObjectMapperContextResolver</span> <span class="directive">implements</span> ContextResolver&lt;ObjectMapper&gt; { <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="directive">final</span> ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();

    <span class="directive">public</span> ObjectMapperContextResolver() {
        SimpleModule module = <span class="keyword">new</span> SimpleModule();
        module.addSerializer(LocalDateTime.class, <span class="keyword">new</span> LocalDateTimeSerializer());
        module.addDeserializer(LocalDateTime.class, <span class="keyword">new</span> LocalDateTimeDeserializer());
        mapper.registerModule(module);
    }

    <span class="directive">public</span> ObjectMapper getContext(<span class="predefined-type">Class</span>&lt;?&gt; type) {
        <span class="keyword">return</span> mapper;
    }
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Annotacja <code>@Provider</code> pozwala rozszerzać funkcjonalności JAX-RS</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Rejestracja dodatku bezpośrendio w mapperze</td></tr></table></div></section><section id="slide_konfiguracja_zasobu_7"><h2>Konfiguracja zasobu (7)</h2><div class="listingblock"><div class="title">Konfiguracja poprzez MixIn</div><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">DictionaryWord</span> {
    <span class="directive">public</span> <span class="directive">final</span> <span class="predefined-type">String</span> englishWord;
    <span class="directive">public</span> <span class="directive">final</span> <span class="predefined-type">String</span> polishWord;

    <span class="directive">public</span> DictionaryWord(<span class="predefined-type">String</span> englishWord, <span class="predefined-type">String</span> polishWord) { <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="local-variable">this</span>.englishWord = englishWord;
        <span class="local-variable">this</span>.polishWord = polishWord;
    }
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Brak domyślnego konstruktora</td></tr></table></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">DictionaryWordMixIn</span> {
    <span class="directive">public</span> DictionaryWordMixIn(<span class="annotation">@JsonProperty</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">englishWord</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> english,
                               <span class="annotation">@JsonProperty</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">polishWord</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> polish) {
    }
}</code></pre></div></div></section><section id="slide_konfiguracja_zasobu_8"><h2>Konfiguracja zasobu (8)</h2><div class="listingblock"><div class="title">Konfiguracja mappera</div><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Provider</span>
<span class="annotation">@Consumes</span>(MediaType.APPLICATION_JSON) <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ObjectMapperContextResolver</span> <span class="directive">implements</span> ContextResolver&lt;ObjectMapper&gt; {

    <span class="directive">final</span> ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();

    <span class="directive">public</span> CustomObjectMapper() {
        mapper.addMixIn(DictionaryWord.class, DictionaryWordMixIn.class);
    }

    <span class="directive">public</span> ObjectMapper getContext(<span class="predefined-type">Class</span>&lt;?&gt; type) {
        <span class="keyword">return</span> mapper;
    }
}</code></pre></div></div></section><section id="slide_konfiguracja_zasobu_9"><h2>Konfiguracja zasobu (9)</h2><div class="listingblock"><div class="title">Implementacja <code>XmlAdapter</code></div><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">javax.xml.bind.annotation.adapters.XmlAdapter</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">LocalDateTimeAdapter</span> <span class="directive">extends</span> XmlAdapter&lt;<span class="predefined-type">String</span>, LocalDateTime&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> LocalDateTime unmarshal(<span class="predefined-type">String</span> dateString) <span class="directive">throws</span> <span class="exception">Exception</span> {
        Instant instant = Instant.parse(dateString);
        LocalDateTime dateTime = LocalDateTime.ofInstant(instant, ZoneId.systemDefault());
        <span class="keyword">return</span> dateTime;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> marshal(LocalDateTime dateTime) <span class="directive">throws</span> <span class="exception">Exception</span> {
        Instant instant = dateTime.toInstant(ZoneOffset.UTC);
        <span class="keyword">return</span> DateTimeFormatter.ISO_INSTANT.format(instant);
    }
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Gdzie to możliwe JAX-RS wykorzystuje zgodność z mapowaniami XML i używa tych samych klas do konwersji obiektów do postaci JSON. <strong>Nasz kod nie odwołuje się do klas <em>Jackson</em> - jest przenośny</strong>.</td></tr></table></div></section><section id="slide_konfiguracja_zasobu_10"><h2>Konfiguracja zasobu (10)</h2><div class="listingblock"><div class="title">Konfiguracja obiektu</div><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">HelloMessage</span> {
    <span class="directive">private</span> <span class="predefined-type">Integer</span> id;
    <span class="directive">private</span> <span class="predefined-type">String</span> message;

    <span class="annotation">@XmlJavaTypeAdapter</span>(LocalDateTimeAdapter.class)
    <span class="directive">private</span> LocalDateTime whence;
}</code></pre></div></div></section><section id="slide_konfiguracja_zasobu_11"><h2>Konfiguracja zasobu (11)</h2><div class="listingblock"><div class="title">Konfiguracja dla pakietu poprzez plik <code>package-info.java</code></div><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@XmlJavaTypeAdapters</span>({
    <span class="annotation">@XmlJavaTypeAdapter</span>(type = LocalDateTime.class,
                        value = LocalDateTimeAdapter.class)
})
<span class="keyword">package</span> <span class="namespace">pakiet.z.klasami.naszego.modelu</span>;

<span class="keyword">import</span> <span class="include">java.time.LocalDateTime</span>;
<span class="keyword">import</span> <span class="include">javax.xml.bind.annotation.adapters.XmlJavaTypeAdapter</span>;
<span class="keyword">import</span> <span class="include">javax.xml.bind.annotation.adapters.XmlJavaTypeAdapters</span>;</code></pre></div></div>
<div class="ulist"><div class="title">Plik <code>package-info.java</code></div><ul><li><p>Zawiera dodatkowe informacje dot. dokumentacji pakietu (<em>JavaDoc</em>)</p></li><li><p>Może zawierać dodatkowe annotacje odnoszące się do całego pakietu (<code>ElementType.PACKAGE</code>)</p></li></ul></div></section><section id="slide_konfiguracja_zasobu_12"><h2>Konfiguracja zasobu (12)</h2><div class="listingblock"><div class="title">MessageBodyReader</div><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">DictionaryWordReader</span> <span class="directive">implements</span> MessageBodyReader&lt;DictionaryWord&gt; {

    <span class="directive">public</span> <span class="type">boolean</span> isReadable(<span class="predefined-type">Class</span>&lt;?&gt; aClass, <span class="predefined-type">Type</span> type, <span class="predefined-type">Annotation</span><span class="type">[]</span> annotations,
        MediaType mediaType) {
            <span class="keyword">return</span> type == DictionaryWord.class;
    }

    <span class="directive">public</span> DictionaryWord readFrom(<span class="predefined-type">Class</span>&lt;DictionaryWord&gt; aClass,
        <span class="predefined-type">Type</span> type, <span class="predefined-type">Annotation</span><span class="type">[]</span> annotations,
        MediaType mediaType, MultivaluedMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; multivaluedMap,
        <span class="predefined-type">InputStream</span> inputStream) <span class="directive">throws</span> <span class="exception">IOException</span>, WebApplicationException {
            JsonObject jsonObject = Json.createReader(inputStream).readObject();
            <span class="keyword">return</span> <span class="keyword">new</span> DictionaryWord(jsonObject.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">englishWord</span><span class="delimiter">&quot;</span></span>),
               jsonObject.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">polishWord</span><span class="delimiter">&quot;</span></span>));
    }
}</code></pre></div></div></section><section id="slide_konfiguracja_zasobu_13"><h2>Konfiguracja zasobu (13)</h2><div class="ulist"><ul><li><p>Interfejsy <code>MessageBodyReader</code> i <code>MessageBodyWriter</code> nie są powiązane z jakimikolwiek innymi bibliotekami poza JAX-RS</p><div class="ulist"><ul><li><p>Służą do definiowania reguł serializacji i deserializacji obiektów do Javy</p></li><li><p>Bazują na strumieniu przekazywanym bezpośrednio z / do HTTP (<code>InputStream</code>)</p></li></ul></div></li></ul></div></section><section id="slide_rozszerzenia_jax_rs"><h2>Rozszerzenia JAX-RS </h2><div class="ulist"><ul><li><p>Poza standardowymi funkcjonalnościami, specyfikacja JAX-RS umożliwia tworzenie własnych rozszerzeń</p></li><li><p>Implementacja rozszerzenia musi być jawnie zarejestrowana, bądź oznaczona adnotacją <code>@Provider</code></p><div class="ulist"><ul><li><p>Klasy takie są wyszukiwane przez JAX-RS w fazie skanowania (<em>discoverable</em>)</p></li></ul></div></li><li><p>Rodzaje / klasy <code>@Provider</code></p></li><li><p><strong>Entity providers</strong>: odpowiadają za mapowania (XML, JSON, CSV) na obiekty</p></li><li><p><strong>Context providers</strong>: zarządzanie obiektami dostępnymi w kontekście (adnotacja <code>@Context</code>)</p></li><li><p><strong>Exception providers</strong>: mapowanie wyjątków Java na odpowiednie odpowiedzi JAX-RS (klasy <code>Response</code>)</p></li></ul></div></section><section id="slide_rozszerzenia_jax_rs_2"><h2>Rozszerzenia JAX-RS (2)</h2><div class="ulist"><div class="title">Mapowanie wyjątków</div><ul><li><p><code>WebApplicationException</code> - klasa rozszerzająca <code>RuntimeException</code> i przygotowująca odpowiedni komunikat HTTP (domyślnie kod HTTP 500 - Internal Server Fault)</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomNotFoundException</span> <span class="directive">extends</span> WebApplicationException {

  <span class="directive">public</span> CustomNotFoundException() {
    <span class="local-variable">super</span>(Responses.notFound().build());
  }

  <span class="directive">public</span> CustomNotFoundException(<span class="predefined-type">String</span> message) {
    <span class="local-variable">super</span>(Response.status(Responses.NOT_FOUND).
    entity(message).type(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>).build());
  }
}</code></pre></div></div></section><section id="slide_rozszerzenia_jax_rs_3"><h2>Rozszerzenia JAX-RS (3)</h2><div class="ulist"><ul><li><p>Używanie <code>WebApplicationException</code> nie zawsze jest wygodne i wskazane</p></li><li><p>Klasa <code>ExceptionMapper</code> umożliwia mapowanie dowolnego wyjątku typu <em>runtime</em> na odpowiedni komunikat błędu HTTP</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Provider</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">EntityNotFoundMapper</span> <span class="directive">implements</span> ExceptionMapper&lt;javax.persistence.EntityNotFoundException&gt; {

    <span class="directive">public</span> Response toResponse(javax.persistence.EntityNotFoundException ex) {
        <span class="keyword">return</span> Response.status(<span class="integer">404</span>).
          entity(ex.getMessage()).
          type(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>).
          build();
  }

}</code></pre></div></div></section><section id="slide_klient_rest"><h2>Klient REST</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java">HelloMessage msg = ClientBuilder.newClient()
    .target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/example/api/hello/Jakub</span><span class="delimiter">&quot;</span></span>)
    .request()
        .accept(MediaType.APPLICATION_JSON_TYPE)
        .get(HelloMessage.class);</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java">HelloMessage message = <span class="keyword">new</span> HelloMessage(<span class="integer">5</span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">A message</span><span class="delimiter">&quot;</span></span>,
    LocalDate.of(<span class="integer">2015</span>, <span class="octal">05</span>, <span class="octal">05</span>));

Response response = ClientBuilder.newClient()
    .target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/example/api/consumes</span><span class="delimiter">&quot;</span></span>)
    .request()
        .post(<span class="predefined-type">Entity</span>.entity(message, MediaType.APPLICATION_JSON_TYPE));</code></pre></div></div></section><section id="slide_klient_rest_2"><h2>Klient REST</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">final</span> <span class="predefined-type">String</span> word = <span class="string"><span class="delimiter">&quot;</span><span class="content">computer</span><span class="delimiter">&quot;</span></span>;

DictionaryWord dictionaryWord = ClientBuilder.newClient()
        .register(CustomObjectMapper.class) <i class="conum" data-value="1"></i><b>(1)</b>
        .target(url.toURI()).path(<span class="string"><span class="delimiter">&quot;</span><span class="content">translate</span><span class="delimiter">&quot;</span></span>).path(word).path(<span class="string"><span class="delimiter">&quot;</span><span class="content">first</span><span class="delimiter">&quot;</span></span>)
        .request().header(<span class="string"><span class="delimiter">&quot;</span><span class="content">X-Dictionary</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">dict</span><span class="delimiter">&quot;</span></span>).get(DictionaryWord.class);

assertThat(dictionaryWord.englishWord, equalTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">computer</span><span class="delimiter">&quot;</span></span>));
assertThat(dictionaryWord.polishWord, equalTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">komputer</span><span class="delimiter">&quot;</span></span>));</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Klient REST umożliwia manualną rejestrację rozszerzeń - jeżeli nie działa automatyczne <em>discovery</em></td></tr></table></div></section><section id="slide_testy_rest"><h2>Testy REST </h2><div class="ulist"><ul><li><p>Testy integracyjne wymagają działającego serwera aplikacji lub dedykowanego frameworka testowego</p><div class="ulist"><ul><li><p>Framework testowy zależny jest on implementacji JAX-RS (Apache CXF, Jersey, RestEASY itp)</p></li><li><p>Jest najlepiej zintegrowany i najszybszy</p></li></ul></div></li><li><p>Testy z wykorzystaniem serwera wymagają dodatkowych konfiguracja</p><div class="ulist"><ul><li><p>Działają o rząd wielkości wolniej</p></li></ul></div></li></ul></div></section><section id="slide_testy_rest_2"><h2>Testy REST (2)</h2><div class="listingblock"><div class="title">Test jednostkowy</div><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">private</span> Service s = <span class="keyword">new</span> Service();

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> should_create_HelloMessage() {
    HelloMessage message = s.hello(<span class="string"><span class="delimiter">&quot;</span><span class="content">Jakub</span><span class="delimiter">&quot;</span></span>);

    assertThat(message.getMessage(), is(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello, Jakub</span><span class="delimiter">&quot;</span></span>));
    assertThat(message.getWhence(), is(LocalDate.now()));

}</code></pre></div></div></section><section id="slide_testy_rest_3"><h2>Testy REST (3)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.glassfish.jersey.test-framework<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jersey-test-framework-core<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.glassfish.jersey.test-framework.providers<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jersey-test-framework-provider-inmemory<span class="tag">&lt;/artifactId&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Najprostsza, lecz ograniczona implementacja JAX-RS</td></tr></table></div>
<div class="paragraph"><p> </p></div>
<div class="ulist"><ul><li><p>Testowy JAX-RS provider może występować także w kilku innych wariantach</p><div class="ulist"><ul><li><p><code>grizzly2</code>, <code>jdk-http</code>, <code>jetty</code> itp</p></li></ul></div></li></ul></div></section><section id="slide_testy_rest_4"><h2>Testy REST (4)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ProfanityResourceTest</span> <span class="directive">extends</span> JerseyTest { <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> Application configure() {
        <span class="keyword">return</span> <span class="keyword">new</span> MyRestApplication();
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> should_return_escaped_phrase() {
        <span class="comment">//.. test code</span>
    }
}</code></pre></div></div></section><section id="slide_testy_rest_5"><h2>Testy REST (5)</h2><div class="ulist"><ul><li><p>Uruchamiamy serwer jako Arquillian Managed container (<code>wildfly-arquillian-container-managed</code>)</p><div class="ulist"><ul><li><p>Arquillian samodzielnie uruchamia serwer jako element cyklu życia (element testów)</p></li><li><p>Lokalizacja serwera określona jest w pliku <code>arquillian.xml</code> w zmiennej <code>jbossHome</code></p></li></ul></div></li></ul></div></section><section id="slide_testy_rest_6"><h2>Testy REST (6)</h2><div class="ulist"><ul><li><p>Uruchomienie testów na zdalnym (istniejącym) serwerze aplikacji (<code>wildfly-arquillian-container-remote</code>)</p><div class="ulist"><ul><li><p>Serwera uruchomiony poprzez Docker</p></li><li><p>Serwera uruchomiony poprzez Mavena (<code>mvn wildfly:start</code> i później <code>mvn wildfly:shutdown</code>)</p></li></ul></div></li><li><p>Wykorzystuje się do tego dwa rozszerzenia Maven&#8217;a: <code>maven-surefire-plugin</code> oraz <code>maven-failsafe-plugin</code></p><div class="ulist"><ul><li><p>Rozróżniają one sposób uruchamiania testów; fazy <code>test</code> oraz <code>integration-test</code> i <code>verify</code></p></li><li><p>W trakcie procesu budowania, Maven może samodzielnie uruchomić serwer w fazie <code>pre-integration-test</code></p></li></ul></div></li></ul></div></section><section id="slide_testy_rest_7_testy_integracyjne"><h2>Testy REST (7) - testy integracyjne</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@RunWith</span>(Arquillian.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">RestEndpointIT</span> { <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="comment">// definicja WARa</span>

  <span class="comment">// metoda testowa</span>

}</code></pre></div></div></section><section><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Deployment</span>
<span class="directive">public</span> <span class="directive">static</span> WebArchive createDeployment() {
    <span class="predefined-type">File</span><span class="type">[]</span> deps = Maven.resolver()
            .resolve(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.fasterxml.jackson.datatype:jackson-datatype-jsr310:2.5.4</span><span class="delimiter">&quot;</span></span>)
            .withTransitivity().asFile();

    <span class="keyword">return</span> ShrinkWrap.create(WebArchive.class)
            .addAsLibraries(deps)
            .addClass(MyRestApplication.class)
            .addClasses(HelloMessage.class, ConsumerResource.class);
}</code></pre></div></div></section><section><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java">    <span class="annotation">@ArquillianResource</span> <span class="predefined-type">URL</span> baseUrl; <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@Test</span>
    <span class="annotation">@RunAsClient</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> <span class="type">void</span> should_create_record() <span class="directive">throws</span> <span class="exception">URISyntaxException</span> {
        HelloMessage message = <span class="keyword">new</span> HelloMessage(<span class="integer">5</span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">A message</span><span class="delimiter">&quot;</span></span>,
                LocalDate.of(<span class="integer">2015</span>, <span class="octal">05</span>, <span class="octal">05</span>));

        <span class="predefined-type">URI</span> uri = UriBuilder
                .fromUri(baseUrl.toURI()).segment(<span class="string"><span class="delimiter">&quot;</span><span class="content">api</span><span class="delimiter">&quot;</span></span>).segment(<span class="string"><span class="delimiter">&quot;</span><span class="content">consumes</span><span class="delimiter">&quot;</span></span>)
                .build();
        Response response = ClientBuilder.newClient()
                .target(uri)
                .request()
                .post(<span class="predefined-type">Entity</span>.json(message));

        assertThat(response.getStatus(), is(<span class="integer">201</span>));
    }

}</code></pre></div></div></section></section>
<section><section id="slide_restafarianizm" data-background-image="images/background.jpg" data-background-size="cover"><h2>RESTafarianizm</h2></section><section id="slide_rest"><h2>REST </h2><div class="dlist"><dl><dt class="hdlist1">Bazując na protokole HTTP, REST zakłada</dt><dd><div class="ulist"><ul><li><p>Komunikację klient - serwer</p><div class="ulist"><ul><li><p>SOAP można było wykorzystywać także przy innych protokołach komunikacyjnych</p></li></ul></div></li><li><p>Brak stanu (bezstanwość) serwera</p></li><li><p>Cache</p></li><li><p>Jednolity interfejs</p><div class="ulist"><ul><li><p>Jednoznaczna identyfikacja zasobu (poprzez URI)</p></li><li><p>Manipulacja zasobami poprzez ich reprezentację</p></li><li><p>Samoopisujące się wiadomości</p></li></ul></div></li></ul></div></dd></dl></div></section><section id="slide_rest_2"><h2>REST (2)</h2><div class="ulist"><ul><li><p>Komunikacja następuje w oparciu o metody HTTP</p><div class="ulist"><ul><li><p>GET, POST, PUT, DELETE</p></li></ul></div></li><li><p>Informacja zwrotna to status HTTP</p><div class="ulist"><ul><li><p>200 OK, 201 Created, 204 No Content, 400 Bad Request, 404 Not Found</p></li></ul></div></li><li><p>Dodatkowe (meta) informacje poprzez nagłówki</p><div class="ulist"><ul><li><p>Accept: application/json; charset=utf-8</p></li><li><p>Accept-encoding: gzip</p></li><li><p>Content-type: application/json; charset=utf-8</p></li></ul></div></li></ul></div></section><section id="slide_rest_3"><h2>REST (3)</h2><div class="ulist"><div class="title">REST prowadzi do ograniczeń</div><ul><li><p>Podział klient-serwer</p></li><li><p>Bezstanowość serwera</p></li><li><p>Cache</p></li><li><p>Jednolity interfejs</p><div class="ulist"><ul><li><p>Identyfikacja zasobów</p></li><li><p>Manipulacja zasobami przez reprezentacje</p></li><li><p>Samoopisujące się wiadomości</p></li><li><p>HATEOAS</p></li></ul></div></li><li><p>Podział na warstwy</p></li></ul></div></section><section id="slide_rest_4"><h2>REST (4)</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:66.6667%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Data Element</th><th class="tableblock halign-left valign-top">Modern Web Examples</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">resource</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">the intended conceptual target of a hypertext reference</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">resource identifier</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">URL, URN</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">representation</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">HTML document, JPEG image</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">representation metadata</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">media type, last-modified time</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">resource metadata</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">source link, alternates, vary</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">control data</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">if-modified-since, cache-control</p></td></tr></tbody></table></section><section id="slide_integracja_systemw_to_take_api"><h2>Integracja systemów to także API</h2><div class="dlist"><dl><dt class="hdlist1">Zasady projektowania API nadal pozostają "w cenie"</dt><dd><div class="ulist"><ul><li><p>Klientami twojego API są programiści</p></li><li><p>Pomimo tego że API działa z wykorzystaniem HTTP - nadal musi być czytelne</p><div class="ulist"><ul><li><p>zwłaszcza w wypadku błędów</p></li></ul></div></li><li><p>Wykorzystuj standardy</p></li><li><p>Zachowuj kompatybilność wsteczną i zaplanuj długie cykle życia wersji</p></li><li><p>Planuj strukturę reprezentacji zasobów</p></li></ul></div></dd></dl></div></section><section id="slide_richardson_maturity_model"><h2>Richardson Maturity Model</h2><div class="ulist"><ul><li><p>Model dojrzałości API webowego</p><div class="ulist"><ul><li><p>Na podstawie analizy istniejących interfejsów</p></li><li><p>Wykonany przez Leonard Richardson w 2008 roku</p></li></ul></div></li><li><p>Definiuje 4 poziomy dojrzałości</p></li><li><p><strong>Level 0</strong> - pojedynczy URL, jedna metoda HTTP</p><div class="ulist"><ul><li><p>Głównie serwisy SOAP XML (jak strona we Flashu)</p></li></ul></div></li><li><p><strong>Level 1</strong> - wiele adresów URL - wszystkie wykorzystujące jedną metodę HTTP</p></li><li><p><strong>Level 2</strong> - wiele adresów URL wykorzystujących metody HTTP</p></li><li><p><strong>Level 3</strong> - zasoby deklarują zależności i połączenia (linki)</p></li></ul></div></section><section id="slide_level_0"><h2>Level 0</h2><div class="imageblock white-background" style=""><img src="images/rest-integration-e114b.png" alt="rest integration e114b"></div></section><section id="slide_level_0_request"><h2>Level 0 - request</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="txt language-txt">POST /auctionServiceAPIEndpoint HTTP/1.1</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;query&gt;</span>
  <span class="tag">&lt;params&gt;</span>
    <span class="tag">&lt;name&gt;</span>Macbook Air<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;price_from&gt;</span>0<span class="tag">&lt;/price_from&gt;</span>
    <span class="tag">&lt;price_to&gt;</span>1000<span class="tag">&lt;/price_to&gt;</span>
  <span class="tag">&lt;/params&gt;</span>
<span class="tag">&lt;/query&gt;</span></code></pre></div></div></section><section id="slide_level_0_response"><h2>Level 0 - response</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="txt language-txt">HTTP/1.1 200 OK</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;items&gt;</span>
  <span class="tag">&lt;item&gt;</span>
    <span class="tag">&lt;id&gt;</span>123<span class="tag">&lt;/id&gt;</span>
    <span class="tag">&lt;name&gt;</span>Macbook Air<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;price&gt;</span>499<span class="tag">&lt;/price&gt;</span>
    <span class="tag">&lt;condition&gt;</span>NEW<span class="tag">&lt;/condition&gt;</span>
  <span class="tag">&lt;/item&gt;</span>
<span class="tag">&lt;/items&gt;</span></code></pre></div></div></section><section id="slide_level_0_request_2"><h2>Level 0 - request</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code>POST /appointmentService HTTP/1.1</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;appointmentRequest&gt;</span>
  <span class="tag">&lt;slot</span> <span class="attribute-name">doctor</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">mjones</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">start</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">1400</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">end</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">1450</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;patient</span> <span class="attribute-name">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">jsmith</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/appointmentRequest&gt;</span></code></pre></div></div></section><section id="slide_level_0_request_3"><h2>Level 0 - request</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code>POST http://svcs.ebay.com/services/search/FindingService/v1</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;findItemsByKeywordsRequest</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.ebay.com/marketplace/search/v1/services</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;affiliate&gt;</span>
    <span class="tag">&lt;networkId&gt;</span>9<span class="tag">&lt;/networkId&gt;</span>
    <span class="tag">&lt;trackingId&gt;</span>1234567890<span class="tag">&lt;/trackingId&gt;</span>
    <span class="tag">&lt;customId&gt;</span>k-man<span class="tag">&lt;/customId&gt;</span>
  <span class="tag">&lt;/affiliate&gt;</span>
  <span class="tag">&lt;sortOrder&gt;</span>EndTime<span class="tag">&lt;/sortOrder&gt;</span>
  <span class="tag">&lt;paginationInput&gt;</span>
    <span class="tag">&lt;entriesPerPage&gt;</span>2<span class="tag">&lt;/entriesPerPage&gt;</span>
  <span class="tag">&lt;/paginationInput&gt;</span>
  <span class="tag">&lt;keywords&gt;</span>camalots<span class="tag">&lt;/keywords&gt;</span>
<span class="tag">&lt;/findItemsByKeywordsRequest&gt;</span></code></pre></div></div></section><section id="slide_level_1"><h2>Level 1</h2><div class="imageblock white-background" style=""><img src="images/rest-integration-bd0cb.png" alt="rest integration bd0cb"></div></section><section id="slide_level_1_uris"><h2>Level 1 - URIs</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code>POST /slots/1234/create HTTP/1.1 <i class="conum" data-value="1"></i><b>(1)</b></code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Akcja w URL</td></tr></table></div>
<div class="paragraph"><p>&#8203;</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;appointmentRequest&gt;</span>
  <span class="tag">&lt;patient</span> <span class="attribute-name">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">jsmith</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/appointmentRequest&gt;</span></code></pre></div></div></section><section id="slide_level_2"><h2>Level 2</h2><div class="imageblock white-background" style=""><img src="images/rest-integration-e937d.png" alt="rest integration e937d"></div></section><section id="slide_level_2_http"><h2>Level 2 - HTTP</h2><div class="listingblock"><div class="title">Request</div><div class="content"><pre class="CodeRay"><code>GET /doctors/mjones/slots?date=20100104&amp;status=open HTTP/1.1
Host: royalhope.nhs.uk</code></pre></div></div>
<div class="listingblock"><div class="title">Response</div><div class="content"><pre class="CodeRay"><code>HTTP/1.1 200 OK <i class="conum" data-value="1"></i><b>(1)</b></code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Poprawne kody odpowiedzi HTTP</td></tr></table></div>
<div class="paragraph"><p>&#8203;</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;openSlotList&gt;</span>
  <span class="tag">&lt;slot</span> <span class="attribute-name">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">1234” start = </span><span class="delimiter">&quot;</span></span><span class="attribute-name">1400</span><span class="error">&quot;</span> <span class="attribute-name">end</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">1450</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;slot</span> <span class="attribute-name">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">5678” start = </span><span class="delimiter">&quot;</span></span><span class="attribute-name">1600</span><span class="error">&quot;</span> <span class="attribute-name">end</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">1650</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/openSlotList&gt;</span></code></pre></div></div></section><section id="slide_level_2_metody_http"><h2>Level 2  - metody HTTP</h2><div class="ulist"><div class="title">GET (Safe and Idempotent)</div><ul><li><p><code>GET /auctions</code></p><div class="ulist"><ul><li><p>&#8594; <code>HTTP/1.1 200 OK</code></p></li></ul></div></li><li><p><code>GET /auctions/1234</code></p></li><li><p><code>GET /auctions?search=Macbook+Air</code></p></li></ul></div>
<div class="ulist"><div class="title">DELETE (<strong>Not</strong> safe and Idempotent)</div><ul><li><p><code>DELETE /auctions/1234</code></p><div class="ulist"><ul><li><p>&#8594; <code>HTTP/1.1 204 No Content</code></p></li></ul></div></li></ul></div></section><section id="slide_level_2_metody_http_2"><h2>Level 2 - metody HTTP</h2><div class="listingblock"><div class="title">Request</div><div class="content"><pre class="CodeRay"><code class="json language-json">{
 <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Macbook Air 2010</span><span class="delimiter">&quot;</span></span>,
 <span class="key"><span class="delimiter">&quot;</span><span class="content">condition</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">NEW</span><span class="delimiter">&quot;</span></span>,
 <span class="key"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span> : <span class="integer">499</span>
}</code></pre></div></div>
<div class="ulist"><div class="title">POST (<strong>Not</strong> safe and <strong>not</strong> Idempotent)</div><ul><li><p><code>POST /items</code></p><div class="ulist"><ul><li><p>&#8594; <code>HTTP/1.1 201 Created</code><br>
<code>Location: <a href="http://api.example.com/items/1235" class="bare">http://api.example.com/items/1235</a></code></p></li><li><p><strong>Serwer nadaje identyfikator</strong></p></li></ul></div></li></ul></div></section><section id="slide_level_2_metody_http_3"><h2>Level 2 - metody HTTP</h2><div class="listingblock"><div class="title">Request</div><div class="content"><pre class="CodeRay"><code class="json language-json">{
 <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Macbook Air 2010</span><span class="delimiter">&quot;</span></span>,
 <span class="key"><span class="delimiter">&quot;</span><span class="content">condition</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">LIKE_NEW</span><span class="delimiter">&quot;</span></span>,
 <span class="key"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span> : <span class="integer">498</span>
}</code></pre></div></div>
<div class="ulist"><div class="title">PUT (<strong>Not</strong> safe and Idempotent)</div><ul><li><p><code>PUT /items/1235</code></p></li><li><p><code>PUT /users/joe</code></p><div class="ulist"><ul><li><p>&#8594; <code>HTTP/1.1 204 No Content</code></p></li><li><p><strong>Klient przekazuje identyfikator</strong></p></li></ul></div></li></ul></div></section><section id="slide_level_2_metody_http_4"><h2>Level 2 - metody HTTP</h2><table class="tableblock frame-all grid-all" style=""><colgroup><col><col><col></colgroup><thead><tr><th class="tableblock halign-left valign-top">&#8203;</th><th class="tableblock halign-left valign-top"><code>/users</code></th><th class="tableblock halign-left valign-top"><code>/users/456</code></th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>GET</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Get All</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Get a user</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>POST</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">New user</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>PUT</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Update</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>DELETE</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Delete All</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Delete a user</p></td></tr></tbody></table></section><section id="slide_level_2_http_responses"><h2>Level 2 - http responses</h2><div class="ulist"><ul><li><p><code>2xx</code>: here you go</p></li><li><p><code>3xx</code>: go away</p></li><li><p><code>4xx</code>: you fucked up</p></li><li><p><code>5xx</code>: I fucked up</p></li></ul></div></section><section id="slide_level_2_http_responses_2"><h2>Level 2 - http responses</h2><div class="dlist"><dl><dt class="hdlist1">Success</dt><dd><div class="ulist"><ul><li><p>200 OK</p></li><li><p>201 CREATED</p></li><li><p>202 ACCEPTED</p></li><li><p>204 NO CONTENT</p></li></ul></div></dd><dt class="hdlist1">Redirect</dt><dd><div class="ulist"><ul><li><p>301 MOVED PERMANENTLY</p></li><li><p>303 SEE OTHER</p></li><li><p>304 NOT MODIFIED</p></li><li><p>307 TEMPORARY REDIRECT</p></li></ul></div></dd></dl></div></section><section id="slide_level_2_http_responses_3"><h2>Level 2 - http responses</h2><div class="dlist"><dl><dt class="hdlist1">User error</dt><dd><div class="ulist"><ul><li><p>400 BAD REQUEST</p></li><li><p>401 UNAUTHORIZED</p></li><li><p>403 FORBIDDEN</p></li><li><p>404 NOT FOUND</p></li><li><p>405 METHOD NOT ALLOWED</p></li><li><p>410 GONE</p></li></ul></div></dd><dt class="hdlist1">Server error</dt><dd><div class="ulist"><ul><li><p>500 INTERNAL SERVER ERROR</p></li><li><p>503 SERVICE UNAVAILABLE</p></li></ul></div></dd></dl></div></section><section id="slide_level_2_http_responses_4"><h2>Level 2 - http responses</h2><div class="paragraph center"><p><strong>Kody błędu są dla błędów</strong></p></div>
<div class="listingblock"><div class="title">Request</div><div class="content"><pre class="CodeRay"><code>http://api.flickr.com/services/rest?
  method=flickr.photos.people.add
  &amp;api_key=xxx&amp;photo_id=yyy&amp;user_id=zzz</code></pre></div></div>
<div class="listingblock"><div class="title">Response</div><div class="content"><pre class="CodeRay"><code>HTTP/200 OK</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>
<span class="tag">&lt;rsp</span> <span class="attribute-name">stat</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fail</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;err</span> <span class="attribute-name">code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">msg</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid API Key (Key has invalid format)</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/rsp&gt;</span></code></pre></div></div></section><section id="slide_level_2_2"><h2>Level 2</h2><div class="ulist"><div class="title">Kiedy jest to wystarczające?</div><ul><li><p>Małe API</p></li><li><p>CRUD</p></li><li><p>Brak wyraźnego <em>flow</em> (procesu) w obrębie aplikacji</p></li></ul></div></section><section id="slide_level_3"><h2>Level 3</h2><div class="imageblock white-background" style=""><img src="images/rest-integration-62a4c.png" alt="rest integration 62a4c"></div></section><section id="slide_level_3_2"><h2>Level 3</h2><div class="imageblock white-background" style=""><img src="images/rest-integration-37e21.png" alt="rest integration 37e21"></div></section><section id="slide_level_3_3"><h2>Level 3</h2><div class="ulist"><div class="title">Zalety</div><ul><li><p>Sterowanie przepływem danych w aplikacji</p></li><li><p>Sterowanie dostępnymi podzasobami</p></li><li><p>Luźniejsze związanie serwera i klienta</p></li><li><p>Dodatkowa dokumentacja API (jednak niewystarczająca)</p></li></ul></div>
<div class="ulist"><div class="title">Wady</div><ul><li><p>Więcej pracy</p></li><li><p>Więcej transferu</p></li><li><p>Tworzenie API dla nieistniejącego klienta</p></li><li><p>Brak wyraźnego standardu (JSON API)</p></li></ul></div></section><section id="slide_level_3_response"><h2>Level 3 - response</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;appointment&gt;</span>
  <span class="tag">&lt;slot</span> <span class="attribute-name">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">1234</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">doctor</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">mjones</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">start</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">1400</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">end</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">1450</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;patient</span> <span class="attribute-name">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">jsmith</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;link</span> <span class="attribute-name">rel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">/linkrels/appointment/addTest</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">uri</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">/slots/1234/appointment/tests</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;link</span> <span class="attribute-name">rel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">/linkrels/appointment/updateContactInfo</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">uri</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">/patients/jsmith/contactInfo</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/appointment&gt;</span></code></pre></div></div></section><section id="slide_level_3_response_2"><h2>Level 3 - response</h2><div class="listingblock"><div class="title">Hypertext Application Language</div><div class="content"><pre class="CodeRay"><code>{
    "name": "Luke Skywalker",
    "height": "1.72 m",
    "mass": "77 Kg",
    "hair_color": "Blond",
    "_links": {
        "self": {
            "href": "http://swapi.co/api/people/1/",
            "title": "Luke Skywalker"
        },
        "http://swapi.co/api/rels/species": {
            "href": "http://swapi.co/api/species/1/",
            "title": "Human"
        }
    }
}</code></pre></div></div></section><section id="slide_wersjonowanie_3_szkoy_wersjonowania"><h2>Wersjonowanie (3 szkoły wersjonowania) </h2><div class="listingblock"><div class="title">Media-type, bezpośrednio poprzez nazwę</div><div class="content"><pre class="CodeRay"><code>Request:
GET /opengov/garbageschedule?location=Main%20Street HTTP/1.1
Accept: application/vnd.opengov.org.garbageschedule-v2+json <i class="conum" data-value="1"></i><b>(1)</b>

Response:
HTTP/1.1 200 OK
Content-Type: application/vnd.opengov.org.garbageschedule-v2+json
  {
    "schedule"
    "self": "schedule-2423",
    "dayOfWeek": "Monday",
    "oddOrEvenWeeks": "Odd"
  }</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Najbardziej RESTful z RESTful; wiele różnych media-type do ślednienia</td></tr></table></div></section><section id="slide_wersjonowanie_2"><h2>Wersjonowanie (2)</h2><div class="listingblock"><div class="title">Media-type, poprzez <em>qualifier</em></div><div class="content"><pre class="CodeRay"><code>Request:
GET /opengov/garbageschedule?location=Main%20Street HTTP/1.1
Accept: application/vnd.opengov.org.garbageschedule+json;v=1 <i class="conum" data-value="1"></i><b>(1)</b>

Response:
HTTP/1.1 200 OK
Content-Type: application/vnd.opengov.org.garbageschedule+json;v=1
  {
    "schedule"
    "self": "schedule-2423",
    "dayOfWeek": "Monday",
    "oddOrEvenWeeks": "Odd"
  }</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td><em>Qualifier</em> wydaje się być łatwiejszy do implementacji</td></tr></table></div></section><section id="slide_wersjonowanie_3"><h2>Wersjonowanie (3)</h2><div class="listingblock"><div class="title">Wersja dodawana jest do URLa (domeny)</div><div class="content"><pre class="CodeRay"><code>Request:
GET /opengov/v1/garbageschedule?location=Main%20Street HTTP/1.1 <i class="conum" data-value="1"></i><b>(1)</b>
Accept: application/vnd.opengov.org.garbageschedule+json

Response:
HTTP/1.1 200 OK
Content-Type: application/vnd.opengov.org.garbageschedule+json
  {
    "schedule"
    "self": "schedule-2423",
    "dayOfWeek": "Monday",
    "oddOrEvenWeeks": "Odd"
  }</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Zło - nie używać. Potencjalnie wiele URI (uniform resource <strong>identifier</strong>) kierujących do tego samego zasobu</td></tr></table></div></section><section id="slide_ze_urle"><h2>Złe URLe</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code>• http://www.acme.com/product/
• http://www.acme.com/product/filter/cats/desc
• http://www.acme.com/product/1234
• http://www.acme.com/photos/product/1234
• http://www.acme.com/photos/product/1234/new <i class="conum" data-value="1"></i><b>(1)</b>
• http://www.acme.com/photos/product/1234/5678 <i class="conum" data-value="2"></i><b>(2)</b></code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td><code>new</code> what?</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>PhotoID? ProductID?</td></tr></table></div></section><section id="slide_dobre_urle"><h2>Dobre URLe</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code>• http://www.acme.com/products/  <i class="conum" data-value="1"></i><b>(1)</b>
• http://www.acme.com/products/?filter=cats&amp;sort=desc <i class="conum" data-value="2"></i><b>(2)</b>
• http://www.acme.com/products/1234 <i class="conum" data-value="3"></i><b>(3)</b>
• http://www.acme.com/products/1234/photos/ <i class="conum" data-value="4"></i><b>(4)</b>
• http://www.acme.com/products/1234/photos/?sort=latest
• http://www.acme.com/products/1234/photos/5678</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Lista produktów</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Filtrowania</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>Pojedynczy produkt</td></tr><tr><td><i class="conum" data-value="4"></i><b>4</b></td><td>Wszystkie zdjęcie</td></tr></table></div></section><section id="slide_przykad_z_ycia_twitter_api"><h2>Przykład z życia - Twitter API </h2><div class="ulist"><div class="title">Status Show</div><ul><li><p>GET <code><a href="http://api.twitter.com/1/statuses/show/12345.json" class="bare">http://api.twitter.com/1/statuses/show/12345.json</a></code></p></li><li><p>Problemy:</p><div class="ulist"><ul><li><p>Akcja <em>show</em> jest elementem URLa</p></li></ul></div></li><li><p>Lepiej: GET <code><a href="http://twitter.com/statuses/12345" class="bare">http://twitter.com/statuses/12345</a></code> z odpowiednim <strong>Accept</strong> header</p></li></ul></div></section><section id="slide_przykad_z_ycia_twitter_api_2"><h2>Przykład z życia - Twitter API (2)</h2><div class="ulist"><div class="title">Status Update</div><ul><li><p>POST <code><a href="http://api.twitter.com/1/statuses/update.json" class="bare">http://api.twitter.com/1/statuses/update.json</a></code></p></li><li><p>Problemy:</p><div class="ulist"><ul><li><p>Akcja <em>update</em> jest elementem URLa</p></li><li><p>Użytkownik jest <em>implicite</em> jako wynik uwierzytelnienia</p></li></ul></div></li><li><p>Lepiej: POST <code><a href="http://twitter.com/users/fabpot/statuses/" class="bare">http://twitter.com/users/fabpot/statuses/</a></code></p></li></ul></div></section><section id="slide_przykad_z_ycia_twitter_api_3"><h2>Przykład z życia - Twitter API (3)</h2><div class="ulist"><div class="title">Status destroy</div><ul><li><p>POST <code><a href="http://api.twitter.com/1/statuses/destroy/12345.json" class="bare">http://api.twitter.com/1/statuses/destroy/12345.json</a></code></p></li><li><p>Problemy:</p><div class="ulist"><ul><li><p>Akcja <em>destroy</em> jest elementem URLa</p></li><li><p>Dziwna hierarchia, do czego odnosi się ID 12345?</p></li><li><p>Umożliwia zarówno akcję POST jak i DELETE</p></li></ul></div></li><li><p>Lepiej: DELETE <code><a href="http://twitter.com/statuses/12345" class="bare">http://twitter.com/statuses/12345</a></code></p></li></ul></div></section><section id="slide_przykad_z_ycia_twitter_api_4"><h2>Przykład z życia - Twitter API (4)</h2><div class="ulist"><div class="title">Status retweets</div><ul><li><p>GET <code><a href="http://api.twitter.com/1/statuses/retweets/12345.json" class="bare">http://api.twitter.com/1/statuses/retweets/12345.json</a></code></p></li><li><p>Problemy:</p><div class="ulist"><ul><li><p>Znowu dziwne hierarchia</p></li></ul></div></li><li><p>Lepiej: GET <code><a href="http://twitter.com/statuses/12345/retweets/" class="bare">http://twitter.com/statuses/12345/retweets/</a></code></p></li></ul></div></section><section id="slide_przykad_z_ycia_twitter_api_5"><h2>Przykład z życia - Twitter API (5)</h2><div class="ulist"><div class="title">Retweet</div><ul><li><p>PUT <code><a href="http://api.twitter.com/1/statuses/retweet/12345.format" class="bare">http://api.twitter.com/1/statuses/retweet/12345.format</a></code></p></li><li><p>Problemy:</p><div class="ulist"><ul><li><p>Akcja <em>retweet</em> jest elementem URLa</p></li><li><p>Umożliwia zarówno akcję POST jak i PUT</p></li></ul></div></li><li><p>Lepiej: POST <code><a href="http://twitter.com/statuses/12345/retweets/" class="bare">http://twitter.com/statuses/12345/retweets/</a></code></p></li></ul></div></section></section>
<section><section id="slide_bezpieczestwo_aplikacji_webowych" data-background-image="images/background.jpg" data-background-size="cover"><h2>Bezpieczeństwo aplikacji webowych</h2></section><section id="slide_nomenklatura"><h2>Nomenklatura</h2><div class="dlist"><dl><dt class="hdlist1">Service Provider (Resource Server)</dt><dd><p>Serwer udostępniający zasoby</p></dd><dt class="hdlist1">Client</dt><dd><p>Użytkownik korzystający z <strong>Service Provider</strong></p></dd><dt class="hdlist1">Identity Provider (Authorization Server)</dt><dd><p>Przechowuje torżsamość użytkownika (klienta)</p></dd></dl></div></section><section id="slide_saml_2"><div class="imageblock" style=""><img src="https://d9s067m9cf0lb.cloudfront.net/assets/2013/04/09/saml2-flow-b931b212fbd9ba9819e72688dc69117fd5eb20e6a1adf1da3a28e441c789c862.png" alt="saml2 flow b931b212fbd9ba9819e72688dc69117fd5eb20e6a1adf1da3a28e441c789c862"></div></section><section id="slide_problemy_z_saml"><h2>Problemy z SAML</h2><div class="ulist"><ul><li><p>XML SAML:Assertions</p></li><li><p>Zorientowane na typowe strony WWW (formulerz, przekierowanie)</p></li><li><p>Bindings: HTTP Redirect i HTTP POST</p><div class="quoteblock"><blockquote>Longer messages (e.g., those containing signed SAML assertions) should be transmitted via other bindings such as the HTTP POST Binding.</blockquote></div></li><li><p>HTTP POST jest problemowe (lub niemożliwe do implementacji) w przypadku aplikacji mobilnych</p></li></ul></div></section><section id="slide_oauth2"><div class="imageblock" style=""><img src="https://d9s067m9cf0lb.cloudfront.net/assets/2013/04/09/oauth2-flow-582c313da600c1cc19b5076e86ed70a49b91f9cfc641af0d1c408e5760d12cba.png" alt="oauth2 flow 582c313da600c1cc19b5076e86ed70a49b91f9cfc641af0d1c408e5760d12cba"></div></section><section id="slide_oauth2_2"><h2>OAuth2</h2><div class="ulist"><ul><li><p>Całość komunikacji opiera się na HTTP Redirect</p></li><li><p>Token przekazywany jest jako parametr (<em>query param</em>)</p></li><li><p>Nie ma jakichkolwiek założeń co do natury klienta (strona www)</p></li><li><p>Służy tylko do uwierzytelnienia (<em>authentication</em>)</p></li></ul></div></section><section id="slide_jwt"><h2>JWT</h2><div class="ulist"><ul><li><p>Self-contained - zawierają wszystkie potrzebne informacje</p></li><li><p>Działają pomiędzy różnymi środowiskami (językami programowania)</p></li><li><p>Łatwe do przesyłania jako element URL lub nagłówek</p></li></ul></div></section><section><div class="imageblock" style=""><img src="https://cdn.auth0.com/content/jwt/jwt-diagram.png" alt="jwt diagram"></div></section><section id="slide_jwt_2"><h2>JWT (2)</h2><div class="ulist"><ul><li><p>header (base64)</p><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="json language-json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">typ</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">JWT</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">alg</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">HS256</span><span class="delimiter">&quot;</span></span>
}</code></pre></div></div></li><li><p>payload (JWT Claims: registered, public and private)</p><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="json language-json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">iss</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">scotch.io</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="key"><span class="delimiter">&quot;</span><span class="content">exp</span><span class="delimiter">&quot;</span></span>: <span class="integer">1300819380</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Jakub</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>  <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre></div></div></li></ul></div></section><section id="slide_jwt_3"><h2>JWT (3)</h2><div class="ulist"><ul><li><p>signature</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="javascript language-javascript"><span class="keyword">var</span> encodedString = base64UrlEncode(header)
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">.</span><span class="delimiter">&quot;</span></span>
                + base64UrlEncode(payload);

HMACSHA256(encodedString, <span class="string"><span class="delimiter">'</span><span class="content">secret</span><span class="delimiter">'</span></span>);</code></pre></div></div></section><section id="slide_bezpieczestwo_i_csrf"><h2>Bezpieczeństwo i CSRF</h2><div class="olist arabic"><div class="title">Double Submit Cookies Method</div><ol class="arabic"><li><p>Token przechowywany jest po stronie client i narażony jest na wykradnięcie</p><div class="ulist"><ul><li><p>LocalStorage może być odczytany przez XSS</p></li><li><p>Cookie może być wykorzystane w CSRF (impersonalizacja)</p></li></ul></div></li><li><p>Z punktu widzenia serwera musimy się upewnić że token pochodzi od właściciela</p><div class="ulist"><ul><li><p>Przechowujemy JWT w ciastku <code>HttpOnly</code> i przesyłamy tylko przez HTTPS</p></li><li><p>Weryfikujemy <code>origin</code> oraz <code>referrer</code> - ponieważ ataki z reguły z innej domeny</p></li><li><p>Poza standardowych ciastkiem przechowujemy dodatkowe ciastko JS (<code>X-XSRF-TOKEN</code>) będące np. tylko sygnaturą JWT</p></li></ul></div></li><li><p>Klient przesyła oba elementy i weryfikujemy czy są poprawne (tzw. czy pochodzą z tego samego miejsca oraz czy payload nie został zmodyfikowany)</p></li></ol></div></section></section>
<section><section id="slide_modu_9_web_security" data-background-image="images/background.jpg" data-background-size="cover"><h2>Moduł 9: Web security</h2></section><section id="slide_konfiguracja"><h2>Konfiguracja</h2><div class="ulist"><ul><li><p>Domyślna konfiguracja <code>WebSecurityConfiguration</code></p><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java">rootContext.register(WebSecurityConfiguration.class);</code></pre></div></div></li><li><p>Konfiguracja reguł bezpieczeństwa, klasa implementująca <code>WebSecurityConfigurerAdapter</code></p><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java">rootContext.register(BasicAuthSecurityConfig.class);</code></pre></div></div></li><li><p>Filtr <code>springSecurityFilterChain</code></p><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="comment">//Register secrity filter</span>
FilterRegistration.Dynamic springSecurityFilterChain =
        container.addFilter(<span class="string"><span class="delimiter">&quot;</span><span class="content">springSecurityFilterChain</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> DelegatingFilterProxy());
springSecurityFilterChain.addMappingForUrlPatterns(<span class="predefined-constant">null</span>, <span class="predefined-constant">false</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/*</span><span class="delimiter">&quot;</span></span>);</code></pre></div></div></li></ul></div></section><section><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebSecurity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BasicAuthSecurityConfig</span> <span class="directive">extends</span> WebSecurityConfigurerAdapter {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> configure(HttpSecurity http) <span class="directive">throws</span> <span class="exception">Exception</span> {
        http.authorizeRequests()
                .antMatchers(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/index.html</span><span class="delimiter">&quot;</span></span>).permitAll()
                .anyRequest().authenticated()
                .and().formLogin()
                .and().httpBasic();
    }

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> <span class="type">void</span> configureGlobal(AuthenticationManagerBuilder auth) <span class="directive">throws</span> <span class="exception">Exception</span> {
        auth.inMemoryAuthentication()
                .withUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>).password(<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>).roles(<span class="string"><span class="delimiter">&quot;</span><span class="content">USER</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre></div></div></section><section><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebSecurity</span>
<span class="annotation">@ComponentScan</span>(basePackageClasses = KeycloakSecurityComponents.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">KeycloakAuthSecurityConfig</span> <span class="directive">extends</span> KeycloakWebSecurityConfigurerAdapter {

  <span class="directive">protected</span> <span class="type">void</span> configure(HttpSecurity http) <span class="directive">throws</span> <span class="exception">Exception</span> {
      <span class="local-variable">super</span>.configure(http);
      http.authorizeRequests()
              .antMatchers(<span class="string"><span class="delimiter">&quot;</span><span class="content">/**/*.html</span><span class="delimiter">&quot;</span></span>).permitAll()
              .anyRequest().authenticated();
  }

  <span class="annotation">@Autowired</span>
  <span class="directive">public</span> <span class="type">void</span> configureGlobal(AuthenticationManagerBuilder auth) <span class="directive">throws</span> <span class="exception">Exception</span> {
      auth.authenticationProvider(keycloakAuthenticationProvider());
  }

  <span class="annotation">@Override</span>
  <span class="directive">protected</span> SessionAuthenticationStrategy sessionAuthenticationStrategy() {
      <span class="keyword">return</span> <span class="keyword">new</span> RegisterSessionAuthenticationStrategy(<span class="keyword">new</span> SessionRegistryImpl());
  }
}</code></pre></div></div></section></section>
<section id="slide_ankieta"><h2>Ankieta</h2><h3>http://bit.ly/2nGKGfB</h3></section></div></div><script src="reveal.js/lib/js/head.min.js"></script><script src="reveal.js/js/reveal.js"></script><script>// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display controls in the bottom right corner
  controls: false,
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: false,
  // Push each slide change to the browser history
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: false,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  previewLinks: false,
  // Theme (e.g., beige, black, league, night, serif, simple, sky, solarized, white)
  // NOTE setting the theme in the config no longer works in reveal.js 3.x
  //theme: Reveal.getQueryHash().theme || 'black',
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: Reveal.getQueryHash().transition || 'fade',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 1280,
  height: 720,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      
      { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
      { src: 'reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },
      { src: 'reveal.js/plugin/menu/menu.js' }
  ]
});</script></body></html>